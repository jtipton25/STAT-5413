<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13 Day 13 | Notes for STAT 5413 - Spatial Statistics</title>
  <meta name="description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="13 Day 13 | Notes for STAT 5413 - Spatial Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13 Day 13 | Notes for STAT 5413 - Spatial Statistics" />
  
  <meta name="twitter:description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  

<meta name="author" content="John Tipton" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="day-12.html"/>
<link rel="next" href="day-14.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<script src="libs/elevate-section-attrs-2.0/elevate-section-attrs.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.10/datatables.js"></script>
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.19/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.9.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.49.4/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.49.4/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">STAT 5413 Spatial Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="day-1.html"><a href="day-1.html"><i class="fa fa-check"></i><b>1</b> Day 1</a>
<ul>
<li class="chapter" data-level="1.1" data-path="day-1.html"><a href="day-1.html#notation"><i class="fa fa-check"></i><b>1.1</b> Notation</a></li>
<li class="chapter" data-level="1.2" data-path="day-1.html"><a href="day-1.html#probability-distributions"><i class="fa fa-check"></i><b>1.2</b> Probability Distributions</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="day-1.html"><a href="day-1.html#example-linear-regression"><i class="fa fa-check"></i><b>1.2.1</b> Example: linear regression</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="day-1.html"><a href="day-1.html#hierarchical-modeling"><i class="fa fa-check"></i><b>1.3</b> Hierarchical modeling</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="day-1.html"><a href="day-1.html#bayesian-hierarchical-models-bhms"><i class="fa fa-check"></i><b>1.3.1</b> Bayesian Hierarchical models (BHMs)</a></li>
<li class="chapter" data-level="1.3.2" data-path="day-1.html"><a href="day-1.html#empirical-hierarchical-models-ehms"><i class="fa fa-check"></i><b>1.3.2</b> Empirical Hierarchical models (EHMs)</a></li>
<li class="chapter" data-level="1.3.3" data-path="day-1.html"><a href="day-1.html#data-model"><i class="fa fa-check"></i><b>1.3.3</b> Data Model</a></li>
<li class="chapter" data-level="1.3.4" data-path="day-1.html"><a href="day-1.html#process-model"><i class="fa fa-check"></i><b>1.3.4</b> Process Model</a></li>
<li class="chapter" data-level="1.3.5" data-path="day-1.html"><a href="day-1.html#parameter-prior-model-bmhs-only"><i class="fa fa-check"></i><b>1.3.5</b> Parameter (Prior) Model (BMHs only)</a></li>
<li class="chapter" data-level="1.3.6" data-path="day-1.html"><a href="day-1.html#posterior-distribution"><i class="fa fa-check"></i><b>1.3.6</b> Posterior Distribution</a></li>
<li class="chapter" data-level="1.3.7" data-path="day-1.html"><a href="day-1.html#scientifically-motivated-statistical-modeling"><i class="fa fa-check"></i><b>1.3.7</b> Scientifically Motivated Statistical Modeling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="day-2.html"><a href="day-2.html"><i class="fa fa-check"></i><b>2</b> Day 2</a>
<ul>
<li class="chapter" data-level="2.1" data-path="day-2.html"><a href="day-2.html#spatial-data"><i class="fa fa-check"></i><b>2.1</b> Spatial Data</a></li>
<li class="chapter" data-level="2.2" data-path="day-2.html"><a href="day-2.html#types-of-spatial-data"><i class="fa fa-check"></i><b>2.2</b> Types of spatial data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="day-2.html"><a href="day-2.html#geostatistical-data"><i class="fa fa-check"></i><b>2.2.1</b> Geostatistical data</a></li>
<li class="chapter" data-level="2.2.2" data-path="day-2.html"><a href="day-2.html#areal-data"><i class="fa fa-check"></i><b>2.2.2</b> Areal data</a></li>
<li class="chapter" data-level="2.2.3" data-path="day-2.html"><a href="day-2.html#point-process-data"><i class="fa fa-check"></i><b>2.2.3</b> Point process data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="day-3.html"><a href="day-3.html"><i class="fa fa-check"></i><b>3</b> Day 3</a>
<ul>
<li class="chapter" data-level="3.1" data-path="day-3.html"><a href="day-3.html#anouncements"><i class="fa fa-check"></i><b>3.1</b> Anouncements</a></li>
<li class="chapter" data-level="3.2" data-path="day-3.html"><a href="day-3.html#files-for-spatial-data"><i class="fa fa-check"></i><b>3.2</b> Files for spatial data</a></li>
<li class="chapter" data-level="3.3" data-path="day-3.html"><a href="day-3.html#textbook-package"><i class="fa fa-check"></i><b>3.3</b> Textbook package</a></li>
<li class="chapter" data-level="3.4" data-path="day-3.html"><a href="day-3.html#spatial-visualization"><i class="fa fa-check"></i><b>3.4</b> Spatial Visualization</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="day-3.html"><a href="day-3.html#spatial-visualization-using-fields"><i class="fa fa-check"></i><b>3.4.1</b> Spatial visualization using <em>fields</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="day-4.html"><a href="day-4.html"><i class="fa fa-check"></i><b>4</b> Day 4</a>
<ul>
<li class="chapter" data-level="4.1" data-path="day-4.html"><a href="day-4.html#announcements"><i class="fa fa-check"></i><b>4.1</b> Announcements</a></li>
<li class="chapter" data-level="4.2" data-path="day-4.html"><a href="day-4.html#visualization-continued"><i class="fa fa-check"></i><b>4.2</b> Visualization (continued)</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="day-4.html"><a href="day-4.html#spatial-visualization-using-fields-1"><i class="fa fa-check"></i><b>4.2.1</b> Spatial visualization using <em>fields</em></a></li>
<li class="chapter" data-level="4.2.2" data-path="day-4.html"><a href="day-4.html#in-class-activity"><i class="fa fa-check"></i><b>4.2.2</b> In Class Activity:</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="day-4.html"><a href="day-4.html#interactive-visualization-interactive-with-html-format-only"><i class="fa fa-check"></i><b>4.3</b> Interactive visualization (Interactive with HTML format only)</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="day-4.html"><a href="day-4.html#interactive-display-of-data"><i class="fa fa-check"></i><b>4.3.1</b> Interactive display of data</a></li>
<li class="chapter" data-level="4.3.2" data-path="day-4.html"><a href="day-4.html#animations"><i class="fa fa-check"></i><b>4.3.2</b> Animations</a></li>
<li class="chapter" data-level="4.3.3" data-path="day-4.html"><a href="day-4.html#interactive-plotting-using-plotly"><i class="fa fa-check"></i><b>4.3.3</b> Interactive plotting using <em>plotly</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="day-5.html"><a href="day-5.html"><i class="fa fa-check"></i><b>5</b> Day 5</a>
<ul>
<li class="chapter" data-level="5.1" data-path="day-5.html"><a href="day-5.html#announcements-1"><i class="fa fa-check"></i><b>5.1</b> Announcements</a></li>
<li class="chapter" data-level="5.2" data-path="day-5.html"><a href="day-5.html#spatial-means-and-covariances"><i class="fa fa-check"></i><b>5.2</b> Spatial means and covariances</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="day-5.html"><a href="day-5.html#gaussian-processes"><i class="fa fa-check"></i><b>5.2.1</b> Gaussian processes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="day-6.html"><a href="day-6.html"><i class="fa fa-check"></i><b>6</b> Day 6</a>
<ul>
<li class="chapter" data-level="6.1" data-path="day-6.html"><a href="day-6.html#announcements-2"><i class="fa fa-check"></i><b>6.1</b> Announcements</a></li>
<li class="chapter" data-level="6.2" data-path="day-6.html"><a href="day-6.html#gaussian-process-assumptions"><i class="fa fa-check"></i><b>6.2</b> Gaussian process assumptions</a></li>
<li class="chapter" data-level="6.3" data-path="day-6.html"><a href="day-6.html#recall-hierachical-modeling"><i class="fa fa-check"></i><b>6.3</b> Recall Hierachical modeling</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="day-6.html"><a href="day-6.html#data-model-1"><i class="fa fa-check"></i><b>6.3.1</b> Data Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="day-7.html"><a href="day-7.html"><i class="fa fa-check"></i><b>7</b> Day 7</a>
<ul>
<li class="chapter" data-level="7.1" data-path="day-7.html"><a href="day-7.html#common-isotropic-correlation-functions"><i class="fa fa-check"></i><b>7.1</b> Common isotropic correlation functions</a></li>
<li class="chapter" data-level="7.2" data-path="day-7.html"><a href="day-7.html#covariograms-and-semivariograms"><i class="fa fa-check"></i><b>7.2</b> Covariograms and semivariograms</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="day-7.html"><a href="day-7.html#semivariograms-and-variograms"><i class="fa fa-check"></i><b>7.2.1</b> Semivariograms and variograms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="day-8.html"><a href="day-8.html"><i class="fa fa-check"></i><b>8</b> Day 8</a>
<ul>
<li class="chapter" data-level="8.1" data-path="day-8.html"><a href="day-8.html#announcements-3"><i class="fa fa-check"></i><b>8.1</b> Announcements</a></li>
<li class="chapter" data-level="8.2" data-path="day-8.html"><a href="day-8.html#estimation-of-the-spatial-process"><i class="fa fa-check"></i><b>8.2</b> Estimation of the spatial process</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="day-8.html"><a href="day-8.html#estimation-of-the-spatial-process-using-variograms"><i class="fa fa-check"></i><b>8.2.1</b> Estimation of the spatial process using variograms</a></li>
<li class="chapter" data-level="8.2.2" data-path="day-8.html"><a href="day-8.html#maximum-likelihood"><i class="fa fa-check"></i><b>8.2.2</b> Maximum Likelihood</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="day-8.html"><a href="day-8.html#maximum-likelihood-1"><i class="fa fa-check"></i><b>8.3</b> Maximum likelihood</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="day-9.html"><a href="day-9.html"><i class="fa fa-check"></i><b>9</b> Day 9</a>
<ul>
<li class="chapter" data-level="9.1" data-path="day-9.html"><a href="day-9.html#announcements-4"><i class="fa fa-check"></i><b>9.1</b> Announcements</a></li>
<li class="chapter" data-level="9.2" data-path="day-9.html"><a href="day-9.html#asymptotic-properties-of-the-mle"><i class="fa fa-check"></i><b>9.2</b> Asymptotic properties of the MLE</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="day-10.html"><a href="day-10.html"><i class="fa fa-check"></i><b>10</b> Day 10</a>
<ul>
<li class="chapter" data-level="10.1" data-path="day-10.html"><a href="day-10.html#announcements-5"><i class="fa fa-check"></i><b>10.1</b> Announcements</a></li>
<li class="chapter" data-level="10.2" data-path="day-10.html"><a href="day-10.html#asymptotic-properties-of-the-mle-1"><i class="fa fa-check"></i><b>10.2</b> Asymptotic properties of the MLE</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="day-11.html"><a href="day-11.html"><i class="fa fa-check"></i><b>11</b> Day 11</a>
<ul>
<li class="chapter" data-level="11.1" data-path="day-11.html"><a href="day-11.html#announcements-6"><i class="fa fa-check"></i><b>11.1</b> Announcements</a></li>
<li class="chapter" data-level="11.2" data-path="day-11.html"><a href="day-11.html#example-spatial-analysis"><i class="fa fa-check"></i><b>11.2</b> Example spatial analysis</a></li>
<li class="chapter" data-level="11.3" data-path="day-11.html"><a href="day-11.html#spatial-model-fitting"><i class="fa fa-check"></i><b>11.3</b> Spatial model fitting</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="day-11.html"><a href="day-11.html#fit-the-maximum-likelihood-estimate-using-the-geor-package"><i class="fa fa-check"></i><b>11.3.1</b> Fit the maximum likelihood estimate using the <em>geoR</em> package</a></li>
<li class="chapter" data-level="11.3.2" data-path="day-11.html"><a href="day-11.html#fitting-a-spatial-model-using-the-nlme-package"><i class="fa fa-check"></i><b>11.3.2</b> Fitting a spatial model using the <em>nlme</em> package</a></li>
<li class="chapter" data-level="11.3.3" data-path="day-11.html"><a href="day-11.html#model-fitting-with-autokrige-function"><i class="fa fa-check"></i><b>11.3.3</b> model fitting with <em>autokrige</em> function</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="day-11.html"><a href="day-11.html#kriging"><i class="fa fa-check"></i><b>11.4</b> Kriging</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="day-11.html"><a href="day-11.html#kriging-equations-with-mean-mu-0"><i class="fa fa-check"></i><b>11.4.1</b> Kriging Equations with mean <span class="math inline">\(\mu = 0\)</span></a></li>
<li class="chapter" data-level="11.4.2" data-path="day-11.html"><a href="day-11.html#kriging-equations-with-unknown-mean"><i class="fa fa-check"></i><b>11.4.2</b> Kriging Equations with unknown mean</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="day-12.html"><a href="day-12.html"><i class="fa fa-check"></i><b>12</b> Day 12</a>
<ul>
<li class="chapter" data-level="12.1" data-path="day-12.html"><a href="day-12.html#announcements-7"><i class="fa fa-check"></i><b>12.1</b> Announcements</a></li>
<li class="chapter" data-level="12.2" data-path="day-12.html"><a href="day-12.html#introduction-to-mcmc"><i class="fa fa-check"></i><b>12.2</b> Introduction to MCMC</a></li>
<li class="chapter" data-level="12.3" data-path="day-12.html"><a href="day-12.html#example-simple-linear-regression"><i class="fa fa-check"></i><b>12.3</b> Example: Simple linear regression</a></li>
<li class="chapter" data-level="12.4" data-path="day-12.html"><a href="day-12.html#the-posterior-distribution"><i class="fa fa-check"></i><b>12.4</b> The posterior distribution</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="day-12.html"><a href="day-12.html#full-conditional-distribution-of-mu"><i class="fa fa-check"></i><b>12.4.1</b> Full conditional distribution of <span class="math inline">\(\mu\)</span></a></li>
<li class="chapter" data-level="12.4.2" data-path="day-12.html"><a href="day-12.html#full-conditional-distribution-for-beta"><i class="fa fa-check"></i><b>12.4.2</b> Full conditional distribution for <span class="math inline">\(\beta\)</span></a></li>
<li class="chapter" data-level="12.4.3" data-path="day-12.html"><a href="day-12.html#full-conditional-distribution-for-sigma2"><i class="fa fa-check"></i><b>12.4.3</b> Full conditional distribution for <span class="math inline">\(\sigma^2\)</span></a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="day-12.html"><a href="day-12.html#fitting-the-model"><i class="fa fa-check"></i><b>12.5</b> Fitting the model</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="day-12.html"><a href="day-12.html#general-recommendations-for-writing-mcmc-software"><i class="fa fa-check"></i><b>12.5.1</b> General recommendations for writing MCMC software</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="day-13.html"><a href="day-13.html"><i class="fa fa-check"></i><b>13</b> Day 13</a>
<ul>
<li class="chapter" data-level="13.1" data-path="day-13.html"><a href="day-13.html#announcements-8"><i class="fa fa-check"></i><b>13.1</b> Announcements</a></li>
<li class="chapter" data-level="13.2" data-path="day-13.html"><a href="day-13.html#the-metropolis-algorithm"><i class="fa fa-check"></i><b>13.2</b> The Metropolis Algorithm</a></li>
<li class="chapter" data-level="13.3" data-path="day-13.html"><a href="day-13.html#the-proposal-distribution"><i class="fa fa-check"></i><b>13.3</b> The proposal distribution</a></li>
<li class="chapter" data-level="13.4" data-path="day-13.html"><a href="day-13.html#the-metropolis-update"><i class="fa fa-check"></i><b>13.4</b> The Metropolis update</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="day-14.html"><a href="day-14.html"><i class="fa fa-check"></i><b>14</b> Day 14</a>
<ul>
<li class="chapter" data-level="14.1" data-path="day-14.html"><a href="day-14.html#announcements-9"><i class="fa fa-check"></i><b>14.1</b> Announcements</a></li>
<li class="chapter" data-level="14.2" data-path="day-14.html"><a href="day-14.html#the-metropolis-hastings-algorithm"><i class="fa fa-check"></i><b>14.2</b> The Metropolis-Hastings Algorithm</a></li>
<li class="chapter" data-level="14.3" data-path="day-14.html"><a href="day-14.html#the-metropolis-hastings-algorithm-1"><i class="fa fa-check"></i><b>14.3</b> The Metropolis-Hastings algorithm</a></li>
<li class="chapter" data-level="14.4" data-path="day-14.html"><a href="day-14.html#example-1"><i class="fa fa-check"></i><b>14.4</b> Example</a></li>
<li class="chapter" data-level="14.5" data-path="day-14.html"><a href="day-14.html#posterior"><i class="fa fa-check"></i><b>14.5</b> Posterior</a></li>
<li class="chapter" data-level="14.6" data-path="day-14.html"><a href="day-14.html#conditional-posterior-for-phi"><i class="fa fa-check"></i><b>14.6</b> Conditional posterior for <span class="math inline">\(\phi\)</span></a></li>
<li class="chapter" data-level="14.7" data-path="day-14.html"><a href="day-14.html#conditional-posterior-for-sigma2"><i class="fa fa-check"></i><b>14.7</b> Conditional posterior for <span class="math inline">\(\sigma^2\)</span></a></li>
<li class="chapter" data-level="14.8" data-path="day-14.html"><a href="day-14.html#mcmc-using-a-symmetric-proposal-metropolis"><i class="fa fa-check"></i><b>14.8</b> MCMC using a symmetric proposal (Metropolis)</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="day-15.html"><a href="day-15.html"><i class="fa fa-check"></i><b>15</b> Day 15</a>
<ul>
<li class="chapter" data-level="15.1" data-path="day-15.html"><a href="day-15.html#announcements-10"><i class="fa fa-check"></i><b>15.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="day-16.html"><a href="day-16.html"><i class="fa fa-check"></i><b>16</b> Day 16</a>
<ul>
<li class="chapter" data-level="16.1" data-path="day-16.html"><a href="day-16.html#announcements-11"><i class="fa fa-check"></i><b>16.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="day-17.html"><a href="day-17.html"><i class="fa fa-check"></i><b>17</b> Day 17</a>
<ul>
<li class="chapter" data-level="17.1" data-path="day-17.html"><a href="day-17.html#announcements-12"><i class="fa fa-check"></i><b>17.1</b> Announcements</a></li>
<li class="chapter" data-level="17.2" data-path="day-17.html"><a href="day-17.html#gaussian-process-representations"><i class="fa fa-check"></i><b>17.2</b> Gaussian process representations</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="day-18.html"><a href="day-18.html"><i class="fa fa-check"></i><b>18</b> Day 18</a>
<ul>
<li class="chapter" data-level="18.1" data-path="day-18.html"><a href="day-18.html#announcements-13"><i class="fa fa-check"></i><b>18.1</b> Announcements</a></li>
<li class="chapter" data-level="18.2" data-path="day-18.html"><a href="day-18.html#gaussian-process-representations-continued"><i class="fa fa-check"></i><b>18.2</b> Gaussian process representations continued</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="day-19.html"><a href="day-19.html"><i class="fa fa-check"></i><b>19</b> Day 19</a>
<ul>
<li class="chapter" data-level="19.1" data-path="day-19.html"><a href="day-19.html#announcements-14"><i class="fa fa-check"></i><b>19.1</b> Announcements</a></li>
<li class="chapter" data-level="19.2" data-path="day-19.html"><a href="day-19.html#stochastic-integration"><i class="fa fa-check"></i><b>19.2</b> Stochastic Integration</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="day-20.html"><a href="day-20.html"><i class="fa fa-check"></i><b>20</b> Day 20</a>
<ul>
<li class="chapter" data-level="20.1" data-path="day-20.html"><a href="day-20.html#announcements-15"><i class="fa fa-check"></i><b>20.1</b> Announcements</a></li>
<li class="chapter" data-level="20.2" data-path="day-20.html"><a href="day-20.html#spbayes-example"><i class="fa fa-check"></i><b>20.2</b> spBayes example</a></li>
<li class="chapter" data-level="20.3" data-path="day-20.html"><a href="day-20.html#global-vs.-local-basis-function"><i class="fa fa-check"></i><b>20.3</b> Global vs. Local Basis function</a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="day-20.html"><a href="day-20.html#an-example-global-basis-fourier-basis"><i class="fa fa-check"></i><b>20.3.1</b> An example global basis: Fourier Basis</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="day-20.html"><a href="day-20.html#example-local-basis"><i class="fa fa-check"></i><b>20.4</b> example local basis</a></li>
<li class="chapter" data-level="20.5" data-path="day-20.html"><a href="day-20.html#fitting-spatial-models-many-ways"><i class="fa fa-check"></i><b>20.5</b> Fitting spatial models many ways</a></li>
<li class="chapter" data-level="20.6" data-path="day-20.html"><a href="day-20.html#empirical-orthogonal-functions"><i class="fa fa-check"></i><b>20.6</b> Empirical Orthogonal Functions</a></li>
<li class="chapter" data-level="20.7" data-path="day-20.html"><a href="day-20.html#spatial-modeling-with-mgcv-package"><i class="fa fa-check"></i><b>20.7</b> Spatial modeling with <code>mgcv</code> package</a></li>
<li class="chapter" data-level="20.8" data-path="day-20.html"><a href="day-20.html#spatial-modeling-with-kernels"><i class="fa fa-check"></i><b>20.8</b> Spatial modeling with Kernels</a>
<ul>
<li class="chapter" data-level="20.8.1" data-path="day-20.html"><a href="day-20.html#kernel-regression-with-a-ridge-penalty"><i class="fa fa-check"></i><b>20.8.1</b> Kernel regression with a ridge penalty</a></li>
<li class="chapter" data-level="20.8.2" data-path="day-20.html"><a href="day-20.html#kernel-regression-with-a-lasso-penalty"><i class="fa fa-check"></i><b>20.8.2</b> Kernel regression with a lasso penalty</a></li>
<li class="chapter" data-level="20.8.3" data-path="day-20.html"><a href="day-20.html#truncated-kernels---local-support"><i class="fa fa-check"></i><b>20.8.3</b> Truncated Kernels - local support</a></li>
</ul></li>
<li class="chapter" data-level="20.9" data-path="day-20.html"><a href="day-20.html#sparse-vs.-dense-matrix-computation"><i class="fa fa-check"></i><b>20.9</b> Sparse vs. Dense matrix computation</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="day-21.html"><a href="day-21.html"><i class="fa fa-check"></i><b>21</b> Day 21</a>
<ul>
<li class="chapter" data-level="21.1" data-path="day-21.html"><a href="day-21.html#announcements-16"><i class="fa fa-check"></i><b>21.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="day-22.html"><a href="day-22.html"><i class="fa fa-check"></i><b>22</b> Day 22</a>
<ul>
<li class="chapter" data-level="22.1" data-path="day-22.html"><a href="day-22.html#announcements-17"><i class="fa fa-check"></i><b>22.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="day-23.html"><a href="day-23.html"><i class="fa fa-check"></i><b>23</b> Day 23</a>
<ul>
<li class="chapter" data-level="23.1" data-path="day-23.html"><a href="day-23.html#announcements-18"><i class="fa fa-check"></i><b>23.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="day-24-scaling-gps-for-large-data.html"><a href="day-24-scaling-gps-for-large-data.html"><i class="fa fa-check"></i><b>24</b> Day 24 – Scaling GPs for large data</a>
<ul>
<li class="chapter" data-level="24.1" data-path="day-24-scaling-gps-for-large-data.html"><a href="day-24-scaling-gps-for-large-data.html#announcements-19"><i class="fa fa-check"></i><b>24.1</b> Announcements</a></li>
<li class="chapter" data-level="24.2" data-path="day-24-scaling-gps-for-large-data.html"><a href="day-24-scaling-gps-for-large-data.html#local-analysis"><i class="fa fa-check"></i><b>24.2</b> Local analysis</a></li>
<li class="chapter" data-level="24.3" data-path="day-24-scaling-gps-for-large-data.html"><a href="day-24-scaling-gps-for-large-data.html#low-rank-approimxations"><i class="fa fa-check"></i><b>24.3</b> Low rank approimxations</a></li>
<li class="chapter" data-level="24.4" data-path="day-24-scaling-gps-for-large-data.html"><a href="day-24-scaling-gps-for-large-data.html#spectral-basis-functions"><i class="fa fa-check"></i><b>24.4</b> Spectral basis functions</a></li>
<li class="chapter" data-level="24.5" data-path="day-24-scaling-gps-for-large-data.html"><a href="day-24-scaling-gps-for-large-data.html#kernel-convolutions"><i class="fa fa-check"></i><b>24.5</b> Kernel convolutions</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html"><i class="fa fa-check"></i><b>25</b> Day 25 – Scaling GPs for large data</a>
<ul>
<li class="chapter" data-level="25.1" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html#announcements-20"><i class="fa fa-check"></i><b>25.1</b> Announcements</a></li>
<li class="chapter" data-level="25.2" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html#gaussian-predictive-process-spbayes-package"><i class="fa fa-check"></i><b>25.2</b> Gaussian Predictive Process (spBayes package)</a></li>
<li class="chapter" data-level="25.3" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html#sparse-matrix-routines"><i class="fa fa-check"></i><b>25.3</b> Sparse matrix routines</a></li>
<li class="chapter" data-level="25.4" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html#the-stochastic-pde-approach"><i class="fa fa-check"></i><b>25.4</b> The stochastic PDE approach</a></li>
<li class="chapter" data-level="25.5" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html#approximate-likelihood-methods"><i class="fa fa-check"></i><b>25.5</b> Approximate likelihood methods</a></li>
<li class="chapter" data-level="25.6" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html#vecchia-approximations"><i class="fa fa-check"></i><b>25.6</b> Vecchia Approximations</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="day-26.html"><a href="day-26.html"><i class="fa fa-check"></i><b>26</b> Day 26</a>
<ul>
<li class="chapter" data-level="26.1" data-path="day-26.html"><a href="day-26.html#announcements-21"><i class="fa fa-check"></i><b>26.1</b> Announcements</a></li>
<li class="chapter" data-level="26.2" data-path="day-26.html"><a href="day-26.html#multivariate-data"><i class="fa fa-check"></i><b>26.2</b> Multivariate Data</a></li>
<li class="chapter" data-level="26.3" data-path="day-26.html"><a href="day-26.html#classical-multivariate-geostatistics"><i class="fa fa-check"></i><b>26.3</b> Classical Multivariate Geostatistics</a>
<ul>
<li class="chapter" data-level="26.3.1" data-path="day-26.html"><a href="day-26.html#cross-variograms-and-cross-covariance-functions"><i class="fa fa-check"></i><b>26.3.1</b> cross-variograms and cross-covariance functions</a></li>
<li class="chapter" data-level="26.3.2" data-path="day-26.html"><a href="day-26.html#cokriging"><i class="fa fa-check"></i><b>26.3.2</b> Cokriging</a></li>
<li class="chapter" data-level="26.3.3" data-path="day-26.html"><a href="day-26.html#linear-model-of-coregionalization"><i class="fa fa-check"></i><b>26.3.3</b> Linear Model of Coregionalization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="27" data-path="day-27.html"><a href="day-27.html"><i class="fa fa-check"></i><b>27</b> Day 27</a>
<ul>
<li class="chapter" data-level="27.1" data-path="day-27.html"><a href="day-27.html#announcements-22"><i class="fa fa-check"></i><b>27.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="day-28.html"><a href="day-28.html"><i class="fa fa-check"></i><b>28</b> Day 28</a>
<ul>
<li class="chapter" data-level="28.1" data-path="day-28.html"><a href="day-28.html#announcements-23"><i class="fa fa-check"></i><b>28.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="day-29.html"><a href="day-29.html"><i class="fa fa-check"></i><b>29</b> Day 29</a>
<ul>
<li class="chapter" data-level="29.1" data-path="day-29.html"><a href="day-29.html#announcements-24"><i class="fa fa-check"></i><b>29.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="day-30.html"><a href="day-30.html"><i class="fa fa-check"></i><b>30</b> Day 30</a>
<ul>
<li class="chapter" data-level="30.1" data-path="day-30.html"><a href="day-30.html#announcements-25"><i class="fa fa-check"></i><b>30.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="day-31.html"><a href="day-31.html"><i class="fa fa-check"></i><b>31</b> Day 31</a>
<ul>
<li class="chapter" data-level="31.1" data-path="day-31.html"><a href="day-31.html#announcements-26"><i class="fa fa-check"></i><b>31.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="day-32.html"><a href="day-32.html"><i class="fa fa-check"></i><b>32</b> Day 32</a>
<ul>
<li class="chapter" data-level="32.1" data-path="day-32.html"><a href="day-32.html#announcements-27"><i class="fa fa-check"></i><b>32.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="33" data-path="day-33.html"><a href="day-33.html"><i class="fa fa-check"></i><b>33</b> Day 33</a>
<ul>
<li class="chapter" data-level="33.1" data-path="day-33.html"><a href="day-33.html#announcements-28"><i class="fa fa-check"></i><b>33.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="day-34.html"><a href="day-34.html"><i class="fa fa-check"></i><b>34</b> Day 34</a>
<ul>
<li class="chapter" data-level="34.1" data-path="day-34.html"><a href="day-34.html#announcements-29"><i class="fa fa-check"></i><b>34.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="35" data-path="day-35.html"><a href="day-35.html"><i class="fa fa-check"></i><b>35</b> Day 35</a>
<ul>
<li class="chapter" data-level="35.1" data-path="day-35.html"><a href="day-35.html#announcements-30"><i class="fa fa-check"></i><b>35.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="36" data-path="day-36.html"><a href="day-36.html"><i class="fa fa-check"></i><b>36</b> Day 36</a>
<ul>
<li class="chapter" data-level="36.1" data-path="day-36.html"><a href="day-36.html#announcements-31"><i class="fa fa-check"></i><b>36.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="37" data-path="day-37.html"><a href="day-37.html"><i class="fa fa-check"></i><b>37</b> Day 37</a>
<ul>
<li class="chapter" data-level="37.1" data-path="day-37.html"><a href="day-37.html#announcements-32"><i class="fa fa-check"></i><b>37.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="38" data-path="day-38.html"><a href="day-38.html"><i class="fa fa-check"></i><b>38</b> Day 38</a>
<ul>
<li class="chapter" data-level="38.1" data-path="day-38.html"><a href="day-38.html#announcements-33"><i class="fa fa-check"></i><b>38.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="39" data-path="day-39.html"><a href="day-39.html"><i class="fa fa-check"></i><b>39</b> Day 39</a>
<ul>
<li class="chapter" data-level="39.1" data-path="day-39.html"><a href="day-39.html#announcements-34"><i class="fa fa-check"></i><b>39.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="40" data-path="day-40.html"><a href="day-40.html"><i class="fa fa-check"></i><b>40</b> Day 40</a>
<ul>
<li class="chapter" data-level="40.1" data-path="day-40.html"><a href="day-40.html#announcements-35"><i class="fa fa-check"></i><b>40.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="41" data-path="day-41.html"><a href="day-41.html"><i class="fa fa-check"></i><b>41</b> Day 41</a>
<ul>
<li class="chapter" data-level="41.1" data-path="day-41.html"><a href="day-41.html#announcements-36"><i class="fa fa-check"></i><b>41.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="42" data-path="day-42.html"><a href="day-42.html"><i class="fa fa-check"></i><b>42</b> Day 42</a>
<ul>
<li class="chapter" data-level="42.1" data-path="day-42.html"><a href="day-42.html#announcements-37"><i class="fa fa-check"></i><b>42.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="43" data-path="day-43.html"><a href="day-43.html"><i class="fa fa-check"></i><b>43</b> Day 43</a>
<ul>
<li class="chapter" data-level="43.1" data-path="day-43.html"><a href="day-43.html#announcements-38"><i class="fa fa-check"></i><b>43.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes for STAT 5413 - Spatial Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="day-13" class="section level1" number="13">
<h1 number="13"><span class="header-section-number">13</span> Day 13</h1>
<div id="announcements-8" class="section level2" number="13.1">
<h2 number="13.1"><span class="header-section-number">13.1</span> Announcements</h2>
</div>
<div id="the-metropolis-algorithm" class="section level2" number="13.2">
<h2 number="13.2"><span class="header-section-number">13.2</span> The Metropolis Algorithm</h2>
<!-- Set some knitr options -->
<p>Previously we discussed how to sample from a Bayesian Hierarchical model when the conditional posterior distributions are known analytic distributions. Often, the conditional posterior distribution is not available in closed form. There are numerous methods to sample from the conditional posterior in this setting, including <a href="https://en.wikipedia.org/wiki/Importance_sampling">importance sampling</a>, <a href="https://en.wikipedia.org/wiki/Slice_sampling">slice sampling</a>, and <a href="https://arxiv.org/pdf/1206.1901.pdf">hybrid/Hamiltonian sampling</a>, among others. Today we will introduce the <a href="http://bayes.wustl.edu/Manual/EquationOfState.pdf">Metropolis algorithm</a>, one of the most widely used and most effective methods for sampling from a conditional posterior without an analytically known distribution.</p>
Recall the algorithm for the Gibbs sampler:
The Metropolis algorithm requires two components: the full conditional distribution (known up to a proportionality constant) and a proposal distribution <span class="math inline">\([ \theta^\star]\)</span> that generates possible values <span class="math inline">\(\theta^{\star}\)</span> for the Markov chain given the value <span class="math inline">\(\theta^{(k-1)}\)</span> of the parameter at iteration <span class="math inline">\(k-1\)</span>. The algorithm is
</div>
<div id="the-proposal-distribution" class="section level2" number="13.3">
<h2 number="13.3"><span class="header-section-number">13.3</span> The proposal distribution</h2>
<p>The proposal distribution can either be independent of the current state of the Markov chain <span class="math inline">\([ \theta^\star]\)</span> or dependent on the current state <span class="math inline">\([ \theta^\star | \theta^{(k-1)} ]\)</span>. Dependent proposal distributions are the most common, with the random walk proposal the most commonly used proposal.</p>
<p>The random walk proposal distribution <span class="math inline">\([ \theta^\star | \theta^{(k-1)} ]\)</span> is
<span class="math display">\[\begin{align*}
\theta^{\star} &amp; \sim \operatorname{N} (\theta^{(k-1)}, \sigma^2_{\mbox{tune}}),
\end{align*}\]</span>
where the mean of the random walk is the previous value of the parameter <span class="math inline">\(\theta^{(k-1)}\)</span> and the variance <span class="math inline">\(\sigma^2_{\mbox{tune}}\)</span> is a tuning parameter that is chosen to “tune” the performance of the MCMC sampler. A small choice of <span class="math inline">\(\sigma^2_{\mbox{tune}}\)</span> will increase the acceptance rate of the Metropolis sampler because the proposed value will be relatively “close” to the previously accepted value <span class="math inline">\(\theta^{(k-1)}\)</span> while a larger <span class="math inline">\(\sigma^2_{\mbox{tune}}\)</span> will allow the Markov chain to make bigger transitions and explore the range of the posterior distribution. Hence, there is a balance between generating proposals that will be accepted relative to faster exploration of the range of the posterior.</p>
<p>A very important property of the proposal distribution is symmetry. A proposal distribution is symmetric if <span class="math inline">\([ \theta^\star | \theta^{(k-1)} ] = [ \theta^{(k-1)} | \theta^\star ]\)</span> which means that the conditional probability of <span class="math inline">\(\theta^{\star}\)</span> given <span class="math inline">\(\theta^{(k-1)}\)</span> is equal to the conditional probability of <span class="math inline">\(\theta^{(k-1)}\)</span> given <span class="math inline">\(\theta^{\star}\)</span>. The random walk distribution is a symmetric proposal but a log-normal random walk is not symmetric.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="day-13.html#cb248-1"></a>theta_k &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb248-2"><a href="day-13.html#cb248-2"></a>theta_star &lt;-<span class="st"> </span><span class="dv">6</span></span>
<span id="cb248-3"><a href="day-13.html#cb248-3"></a>sigma2_tune &lt;-<span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb248-4"><a href="day-13.html#cb248-4"></a></span>
<span id="cb248-5"><a href="day-13.html#cb248-5"></a><span class="co">##  check the symmetry condition for the random walk</span></span>
<span id="cb248-6"><a href="day-13.html#cb248-6"></a><span class="kw">all.equal</span>(<span class="kw">dnorm</span>(theta_k, theta_star, <span class="kw">sqrt</span>(sigma2_tune)),</span>
<span id="cb248-7"><a href="day-13.html#cb248-7"></a>          <span class="kw">dnorm</span>(theta_star, theta_k, <span class="kw">sqrt</span>(sigma2_tune)))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="day-13.html#cb250-1"></a><span class="co">##  check the symmetry condition for the log-normal random walk</span></span>
<span id="cb250-2"><a href="day-13.html#cb250-2"></a><span class="kw">all.equal</span>(<span class="kw">dlnorm</span>(<span class="kw">log</span>(theta_k), <span class="kw">log</span>(theta_star), <span class="kw">sqrt</span>(sigma2_tune)),</span>
<span id="cb250-3"><a href="day-13.html#cb250-3"></a>          <span class="kw">dlnorm</span>(<span class="kw">log</span>(theta_star), <span class="kw">log</span>(theta_k), <span class="kw">sqrt</span>(sigma2_tune)))</span></code></pre></div>
<pre><code>## [1] &quot;Mean relative difference: 0.7701&quot;</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="day-13.html#cb252-1"></a><span class="kw">library</span>(latex2exp)</span>
<span id="cb252-2"><a href="day-13.html#cb252-2"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="fl">2.75</span>,<span class="fl">2.75</span>) <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span>)</span>
<span id="cb252-3"><a href="day-13.html#cb252-3"></a></span>
<span id="cb252-4"><a href="day-13.html#cb252-4"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb252-5"><a href="day-13.html#cb252-5"></a><span class="co">## normal proposal</span></span>
<span id="cb252-6"><a href="day-13.html#cb252-6"></a><span class="kw">curve</span>(<span class="kw">dnorm</span>(x, theta_k, <span class="kw">sqrt</span>(sigma2_tune)), <span class="dt">from=</span><span class="dv">2</span>, <span class="dt">to=</span><span class="dv">8</span>, </span>
<span id="cb252-7"><a href="day-13.html#cb252-7"></a>      <span class="dt">main=</span><span class="st">&quot;Normal Proposal&quot;</span>, </span>
<span id="cb252-8"><a href="day-13.html#cb252-8"></a>      <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;[&quot;</span>, theta<span class="op">^</span>(k<span class="dv">-1</span>), <span class="st">&quot;|&quot;</span>, theta<span class="op">^</span>{<span class="st">&quot;*&quot;</span>}, <span class="st">&quot;]&quot;</span>)),</span>
<span id="cb252-9"><a href="day-13.html#cb252-9"></a>      <span class="dt">xlab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(theta<span class="op">^</span>{<span class="st">&quot;*&quot;</span>})))</span>
<span id="cb252-10"><a href="day-13.html#cb252-10"></a><span class="kw">abline</span>(<span class="dt">v=</span>theta_k, <span class="dt">lty=</span><span class="dv">2</span>)</span>
<span id="cb252-11"><a href="day-13.html#cb252-11"></a><span class="kw">text</span>(<span class="fl">5.65</span>, <span class="fl">0.575</span>, <span class="kw">expression</span>(theta<span class="op">^</span>{(k<span class="dv">-1</span>)}))</span>
<span id="cb252-12"><a href="day-13.html#cb252-12"></a><span class="co">## reverse of normal proposal</span></span>
<span id="cb252-13"><a href="day-13.html#cb252-13"></a><span class="kw">curve</span>(<span class="kw">dnorm</span>(theta_star, x, <span class="kw">sqrt</span>(sigma2_tune)), <span class="dt">from=</span><span class="dv">3</span>, <span class="dt">to=</span><span class="dv">9</span>, </span>
<span id="cb252-14"><a href="day-13.html#cb252-14"></a>      <span class="dt">main=</span><span class="st">&quot;Reverse of Normal Proposal&quot;</span>, </span>
<span id="cb252-15"><a href="day-13.html#cb252-15"></a>      <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;[&quot;</span>, theta<span class="op">^</span>{<span class="st">&quot;*&quot;</span>}, <span class="st">&quot;|&quot;</span>, theta<span class="op">^</span>{(k<span class="dv">-1</span>)}, <span class="st">&quot;]&quot;</span>)),</span>
<span id="cb252-16"><a href="day-13.html#cb252-16"></a>      <span class="dt">xlab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(theta<span class="op">^</span>{(k<span class="dv">-1</span>)})))</span>
<span id="cb252-17"><a href="day-13.html#cb252-17"></a><span class="kw">abline</span>(<span class="dt">v=</span>theta_star, <span class="dt">lty=</span><span class="dv">2</span>)</span>
<span id="cb252-18"><a href="day-13.html#cb252-18"></a><span class="kw">text</span>(<span class="fl">6.35</span>, <span class="fl">0.575</span>, <span class="kw">expression</span>(theta<span class="op">^</span>{<span class="st">&quot;*&quot;</span>}))</span>
<span id="cb252-19"><a href="day-13.html#cb252-19"></a></span>
<span id="cb252-20"><a href="day-13.html#cb252-20"></a><span class="co">## log-Normal proposal</span></span>
<span id="cb252-21"><a href="day-13.html#cb252-21"></a><span class="kw">curve</span>(<span class="kw">dlnorm</span>(x, <span class="kw">log</span>(theta_k), <span class="kw">sqrt</span>(sigma2_tune)), <span class="dt">from=</span><span class="dv">1</span>, <span class="dt">to=</span><span class="dv">10</span>, </span>
<span id="cb252-22"><a href="day-13.html#cb252-22"></a>      <span class="dt">main=</span><span class="st">&quot;log-Normal Proposal&quot;</span>, </span>
<span id="cb252-23"><a href="day-13.html#cb252-23"></a>      <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;[&quot;</span>, theta<span class="op">^</span>(k<span class="dv">-1</span>), <span class="st">&quot;|&quot;</span>, theta<span class="op">^</span>{<span class="st">&quot;*&quot;</span>}, <span class="st">&quot;]&quot;</span>)),</span>
<span id="cb252-24"><a href="day-13.html#cb252-24"></a>      <span class="dt">xlab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(theta<span class="op">^</span>{<span class="st">&quot;*&quot;</span>})))</span>
<span id="cb252-25"><a href="day-13.html#cb252-25"></a><span class="kw">abline</span>(<span class="dt">v=</span>theta_k, <span class="dt">lty=</span><span class="dv">2</span>)</span>
<span id="cb252-26"><a href="day-13.html#cb252-26"></a><span class="kw">text</span>(<span class="fl">5.75</span>, <span class="fl">0.14</span>, <span class="kw">expression</span>(theta<span class="op">^</span>{(k)}))</span>
<span id="cb252-27"><a href="day-13.html#cb252-27"></a><span class="co">## reverse of log-Normal proposal</span></span>
<span id="cb252-28"><a href="day-13.html#cb252-28"></a><span class="kw">curve</span>(<span class="kw">dlnorm</span>(theta_star, x, <span class="kw">sqrt</span>(sigma2_tune)), <span class="dt">from=</span><span class="op">-</span><span class="dv">2</span>, <span class="dt">to=</span><span class="dv">4</span>, </span>
<span id="cb252-29"><a href="day-13.html#cb252-29"></a>      <span class="dt">main=</span><span class="st">&quot;Reverse of log-Normal Proposal&quot;</span>, </span>
<span id="cb252-30"><a href="day-13.html#cb252-30"></a>      <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;[&quot;</span>, theta<span class="op">^</span>{<span class="st">&quot;*&quot;</span>}, <span class="st">&quot;|&quot;</span>, theta<span class="op">^</span>{(k<span class="dv">-1</span>)}, <span class="st">&quot;]&quot;</span>)),</span>
<span id="cb252-31"><a href="day-13.html#cb252-31"></a>      <span class="dt">xlab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">log</span>(theta<span class="op">^</span>{(k<span class="dv">-1</span>)}))))</span>
<span id="cb252-32"><a href="day-13.html#cb252-32"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="kw">log</span>(theta_star), <span class="dt">lty=</span><span class="dv">2</span>)</span>
<span id="cb252-33"><a href="day-13.html#cb252-33"></a><span class="kw">text</span>(<span class="fl">0.75</span>, <span class="fl">0.095</span>, <span class="kw">expression</span>(<span class="kw">log</span>(theta<span class="op">^</span>{<span class="st">&quot;*&quot;</span>})))</span></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-131-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Note that the bottom right figure shows a symmetric looking distribution. Symmetry only implies that the conditional probabilities can be interchanged, not that the probability distribution is itself symmetric. The two most commonly used proposal distributions, the normal and the uniform distribution, are symmetric.</p>
</div>
<div id="the-metropolis-update" class="section level2" number="13.4">
<h2 number="13.4"><span class="header-section-number">13.4</span> The Metropolis update</h2>
<p>The Metropolis update is only valid for symmetric proposal distributions. The more general Metropolis-Hastings update is used for assymetric proposal distributions and will be introduced later.</p>
<p>If the value of <span class="math inline">\(\theta\)</span> at iteration <span class="math inline">\(k-1\)</span> is <span class="math inline">\(\theta^{(k-1)}\)</span>, then the conditional density for <span class="math inline">\(\theta\)</span> is
<span class="math display">\[\begin{align*}
[ \theta^{(k-1)} | \cdot ] &amp; = \frac{[\mathbf{y} | \theta^{(k-1)}] [\theta^{(k-1)}]}{[ \mathbf{y} ]},
\end{align*}\]</span>
and the conditional density of the proposed value <span class="math inline">\(\theta^{\star}\)</span> is
<span class="math display">\[\begin{align*}
[ \theta^{\star} | \cdot ] &amp; =  \frac{[\mathbf{y} | \theta^{\star}] [\theta^{\star}]}{[\mathbf{y}]},
\end{align*}\]</span>
where both of these expressions require the difficult evaluation of the marginal data distribution <span class="math inline">\([\mathbf{y}]\)</span>. However, the ratio <span class="math inline">\(a\)</span> of the two distributions
<span class="math display">\[\begin{align*}
a &amp; = \frac{[ \theta^{\star} | \cdot ]}{[ \theta^{(k-1)} | \cdot ]} \\
a &amp; = \frac{\frac{[\mathbf{y} | \theta^{\star}] [\theta^{\star}]}{[\mathbf{y}]}} {\frac{[\mathbf{y} | \theta^{(k-1)}] [\theta^{(k-1)}]}{[ \mathbf{y} ]}} \\
a &amp; = \frac{[\mathbf{y} | \theta^{\star}] [\theta^{\star}]} { [\mathbf{y} | \theta^{(k-1)}] [\theta^{(k-1)}]}
\end{align*}\]</span>
does not depend on the marginal distribution of the data <span class="math inline">\([\mathbf{y}]\)</span>, eliminating the need to calculate the difficult integral. Given the proposal <span class="math inline">\(\theta^{\star}\)</span> from a symmetric proposal distribution centered on the previous value <span class="math inline">\(\theta^{(k-1)}\)</span>, we accept the new <span class="math inline">\(\theta^\star\)</span> with probability <span class="math inline">\(min(1, a)\)</span> and otherwise reject the proposal and set <span class="math inline">\(\theta^{(k)} = \theta^{(k-1)}\)</span>. The complete Metropolis algorithm is</p>
<p>For example, consider the model
<span class="math display">\[\begin{align*}
y_i &amp; \sim \operatorname{N} (\theta, 1)
\end{align*}\]</span>
where <span class="math inline">\(\theta\)</span> is unknown. Assuming a normal prior <span class="math inline">\(\theta \propto \operatorname{N}(0, 1000)\)</span>, we will sample from the conditional posterior <span class="math inline">\([\theta | \cdot] \propto \prod_{i=1}^N \operatorname{N}(\theta, 1) \times 1\)</span>.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="day-13.html#cb253-1"></a><span class="co">## simulate data according to the model</span></span>
<span id="cb253-2"><a href="day-13.html#cb253-2"></a>N &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb253-3"><a href="day-13.html#cb253-3"></a>theta &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb253-4"><a href="day-13.html#cb253-4"></a>y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(N, theta, <span class="dv">1</span>)</span></code></pre></div>
<p>We will run the Metropolis algorithm for <span class="math inline">\(K=5000\)</span> iterations using a normal proposal dsitribution.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="day-13.html#cb254-1"></a>K &lt;-<span class="st"> </span><span class="dv">5000</span></span>
<span id="cb254-2"><a href="day-13.html#cb254-2"></a>theta_sim &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, K)</span>
<span id="cb254-3"><a href="day-13.html#cb254-3"></a>sigma2_tune &lt;-<span class="st"> </span><span class="fl">0.025</span></span>
<span id="cb254-4"><a href="day-13.html#cb254-4"></a>accept_prob &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb254-5"><a href="day-13.html#cb254-5"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>K) {</span>
<span id="cb254-6"><a href="day-13.html#cb254-6"></a>  theta_star &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, theta_sim[k<span class="dv">-1</span>], <span class="kw">sqrt</span>(sigma2_tune))</span>
<span id="cb254-7"><a href="day-13.html#cb254-7"></a>  a &lt;-<span class="st"> </span><span class="kw">prod</span>(<span class="kw">dnorm</span>(y, theta_star, <span class="dv">1</span>)) <span class="op">*</span><span class="st"> </span><span class="kw">dnorm</span>(theta_star, <span class="dv">0</span>, <span class="kw">sqrt</span>(<span class="dv">1000</span>)) <span class="op">/</span><span class="st"> </span></span>
<span id="cb254-8"><a href="day-13.html#cb254-8"></a><span class="st">    </span><span class="kw">prod</span>(<span class="kw">dnorm</span>(y, theta_sim[k<span class="dv">-1</span>], <span class="dv">1</span>)) <span class="op">*</span><span class="st"> </span><span class="kw">dnorm</span>(theta_sim[k<span class="dv">-1</span>], <span class="dv">0</span>, <span class="kw">sqrt</span>(<span class="dv">1000</span>))</span>
<span id="cb254-9"><a href="day-13.html#cb254-9"></a>  u &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb254-10"><a href="day-13.html#cb254-10"></a>  <span class="cf">if</span> (u <span class="op">&lt;</span><span class="st"> </span>a) {</span>
<span id="cb254-11"><a href="day-13.html#cb254-11"></a>    <span class="co">## accept the proposed theta_star</span></span>
<span id="cb254-12"><a href="day-13.html#cb254-12"></a>    theta_sim[k] &lt;-<span class="st"> </span>theta_star</span>
<span id="cb254-13"><a href="day-13.html#cb254-13"></a>    <span class="co">## keep running total of acceptance rate</span></span>
<span id="cb254-14"><a href="day-13.html#cb254-14"></a>    accept_prob &lt;-<span class="st"> </span>accept_prob <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>K</span>
<span id="cb254-15"><a href="day-13.html#cb254-15"></a>  } <span class="cf">else</span> {</span>
<span id="cb254-16"><a href="day-13.html#cb254-16"></a>    <span class="co">## reject the proposed theta_star</span></span>
<span id="cb254-17"><a href="day-13.html#cb254-17"></a>    theta_sim[k] &lt;-<span class="st"> </span>theta_sim[k<span class="dv">-1</span>]</span>
<span id="cb254-18"><a href="day-13.html#cb254-18"></a>  }</span>
<span id="cb254-19"><a href="day-13.html#cb254-19"></a>}</span></code></pre></div>
<pre><code>## Error in if (u &lt; a) {: missing value where TRUE/FALSE needed</code></pre>
<p>Oops! We get an error! When working with <span class="math inline">\(a\)</span> directly, we get a product of small likelihoods. Instead, let’s work with the logarithm of the probabilities</p>
<p><span class="math display">\[\begin{align*}
a &amp; = \exp \left( \log \left( [\mathbf{y} | \theta^{\star}] [\theta^{\star}] \right) - \log \left( [\mathbf{y} | \theta^{(k-1)}] [\theta^{(k-1)}] \right) \right) \\
&amp; = \exp \left( \log [\mathbf{y} | \theta^{\star}]  + \log [\theta^{\star}] - \log  [\mathbf{y} | \theta^{(k-1)}]  - \log [\theta^{(k-1)}] \right),
\end{align*}\]</span>
where all we did was re-write the likelihood as the exponential of a log (an identity transformation). What this does is reduce the effect of multiplying small values that go to computer zero (numeric underflow) and cause problems. For example</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="day-13.html#cb256-1"></a><span class="kw">prod</span>(<span class="kw">dnorm</span>(y, <span class="dv">8</span>, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] 3.779e-270</code></pre>
<p>is very very small (close to zero) and gets closer to numeric underflow as N increase, whereas</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="day-13.html#cb258-1"></a><span class="kw">sum</span>(<span class="kw">dnorm</span>(y, <span class="dv">8</span>, <span class="dv">1</span>, <span class="dt">log=</span><span class="ot">TRUE</span>))</span>
<span id="cb258-2"><a href="day-13.html#cb258-2"></a><span class="kw">all.equal</span>(<span class="kw">prod</span>(<span class="kw">dnorm</span>(y, <span class="dv">8</span>, <span class="dv">1</span>)), <span class="kw">exp</span>(<span class="kw">sum</span>(<span class="kw">dnorm</span>(y, <span class="dv">8</span>, <span class="dv">1</span>, <span class="dt">log=</span><span class="ot">TRUE</span>))))</span></code></pre></div>
<pre><code>## [1] -620.4
## [1] TRUE</code></pre>
<p>is a more reasonable number (nowhere near computer zero), but produces the same answer when exponentiated.</p>
<p>Writing the Metropolis algorithm on the log-probability scale is</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="day-13.html#cb260-1"></a>K &lt;-<span class="st"> </span><span class="dv">5000</span></span>
<span id="cb260-2"><a href="day-13.html#cb260-2"></a>theta_sim &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, K)</span>
<span id="cb260-3"><a href="day-13.html#cb260-3"></a>sigma2_tune &lt;-<span class="st"> </span><span class="fl">0.025</span></span>
<span id="cb260-4"><a href="day-13.html#cb260-4"></a>accept_prob &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb260-5"><a href="day-13.html#cb260-5"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>K) {</span>
<span id="cb260-6"><a href="day-13.html#cb260-6"></a>  theta_star &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, theta_sim[k<span class="dv">-1</span>], <span class="kw">sqrt</span>(sigma2_tune))</span>
<span id="cb260-7"><a href="day-13.html#cb260-7"></a>  <span class="co">## calcuate the numerator of the ratio</span></span>
<span id="cb260-8"><a href="day-13.html#cb260-8"></a>  mh1 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dnorm</span>(y, theta_star, <span class="dv">1</span>, <span class="dt">log=</span><span class="ot">TRUE</span>)) <span class="op">+</span></span>
<span id="cb260-9"><a href="day-13.html#cb260-9"></a><span class="st">    </span><span class="kw">dnorm</span>(theta_star, <span class="dv">0</span>, <span class="kw">sqrt</span>(<span class="dv">1000</span>), <span class="dt">log=</span><span class="ot">TRUE</span>) </span>
<span id="cb260-10"><a href="day-13.html#cb260-10"></a>  <span class="co">## calcuate the denomiator of the ratio</span></span>
<span id="cb260-11"><a href="day-13.html#cb260-11"></a>  mh2 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dnorm</span>(y, theta_sim[k<span class="dv">-1</span>], <span class="dv">1</span>, <span class="dt">log=</span><span class="ot">TRUE</span>)) <span class="op">+</span></span>
<span id="cb260-12"><a href="day-13.html#cb260-12"></a><span class="st">    </span><span class="kw">dnorm</span>(theta_sim[k<span class="dv">-1</span>], <span class="dv">0</span>, <span class="kw">sqrt</span>(<span class="dv">1000</span>), <span class="dt">log=</span><span class="ot">TRUE</span>)</span>
<span id="cb260-13"><a href="day-13.html#cb260-13"></a>  a &lt;-<span class="st"> </span><span class="kw">exp</span>(mh1 <span class="op">-</span><span class="st"> </span>mh2)</span>
<span id="cb260-14"><a href="day-13.html#cb260-14"></a>  u &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb260-15"><a href="day-13.html#cb260-15"></a>  <span class="cf">if</span> (u <span class="op">&lt;</span><span class="st"> </span>a) {</span>
<span id="cb260-16"><a href="day-13.html#cb260-16"></a>    <span class="co">## accept the proposed theta_star</span></span>
<span id="cb260-17"><a href="day-13.html#cb260-17"></a>    theta_sim[k] &lt;-<span class="st"> </span>theta_star</span>
<span id="cb260-18"><a href="day-13.html#cb260-18"></a>    <span class="co">## keep running total of acceptance rate</span></span>
<span id="cb260-19"><a href="day-13.html#cb260-19"></a>    accept_prob &lt;-<span class="st"> </span>accept_prob <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>K</span>
<span id="cb260-20"><a href="day-13.html#cb260-20"></a>  } <span class="cf">else</span> {</span>
<span id="cb260-21"><a href="day-13.html#cb260-21"></a>    <span class="co">## reject the proposed theta_star</span></span>
<span id="cb260-22"><a href="day-13.html#cb260-22"></a>    theta_sim[k] &lt;-<span class="st"> </span>theta_sim[k<span class="dv">-1</span>]</span>
<span id="cb260-23"><a href="day-13.html#cb260-23"></a>  }</span>
<span id="cb260-24"><a href="day-13.html#cb260-24"></a>}</span></code></pre></div>
<p>Plotting the output below looks much, much better. All thanks to avoiding numeric underflow! The lesson: always evaluate Metropolis ratios on the log scale.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="day-13.html#cb261-1"></a><span class="co">## Plot the output</span></span>
<span id="cb261-2"><a href="day-13.html#cb261-2"></a><span class="kw">plot</span>(theta_sim, <span class="dt">type=</span><span class="st">&#39;l&#39;</span>, </span>
<span id="cb261-3"><a href="day-13.html#cb261-3"></a>     <span class="dt">main=</span><span class="kw">paste0</span>(<span class="st">&quot;acceptance prob = &quot;</span>, <span class="kw">round</span>(accept_prob, <span class="dt">digits=</span><span class="dv">2</span>)), </span>
<span id="cb261-4"><a href="day-13.html#cb261-4"></a>     <span class="dt">xlab=</span><span class="st">&quot;MCMC iteration&quot;</span>, <span class="dt">ylab=</span><span class="kw">expression</span>(theta))</span>
<span id="cb261-5"><a href="day-13.html#cb261-5"></a><span class="kw">abline</span>(<span class="dt">h=</span>theta, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-137-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>We can also explore the effects of the tuning parameter on the behavior of the model</p>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-139-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Let’s examine these plots, throwing away the first 500 samples as “burn-in.”</p>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-140-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Notice that the smallest choice of <span class="math inline">\(\sigma^2_{\mbox{tune}}\)</span> produces a chain with high autocorrelation that doesn’t die off at large lags. The choice of <span class="math inline">\(\sigma^2_{\mbox{tune}} = 0.05\)</span> produces the quickest decay in the ACF plot below, and has an acceptance rate of about 0.46 (0.44 is optimal for a univariate Metropolis update). The trace plots for the larger values of the tuning parameter have low acceptance rates and get “stuck” at certain parameter values for long periods of time.</p>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-141-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="day-13.html#cb262-1"></a><span class="kw">library</span>(coda)</span>
<span id="cb262-2"><a href="day-13.html#cb262-2"></a><span class="kw">effectiveSize</span>(theta_sim1[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>)])</span>
<span id="cb262-3"><a href="day-13.html#cb262-3"></a><span class="kw">effectiveSize</span>(theta_sim2[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>)])</span>
<span id="cb262-4"><a href="day-13.html#cb262-4"></a><span class="kw">effectiveSize</span>(theta_sim3[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>)])</span>
<span id="cb262-5"><a href="day-13.html#cb262-5"></a><span class="kw">effectiveSize</span>(theta_sim4[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>)])</span></code></pre></div>
<pre><code>##  var1 
## 227.2 
## var1 
## 1103 
##  var1 
## 335.6 
##  var1 
## 117.9</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="day-12.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="day-14.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["STAT-5413.pdf", "STAT-5413.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
