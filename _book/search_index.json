[
["day-20.html", "20 Day 20 20.1 Announcements 20.2 Fitting spatial models many ways 20.3 Empirical Orthogonal Functions", " 20 Day 20 library(tidyverse) library(STRbook) 20.1 Announcements 20.2 Fitting spatial models many ways 20.3 Empirical Orthogonal Functions Recall the Karhunen-Loève expansion Analog for PCA for spatio-temporal data Use the sea surface temperature (SST) data in Wikle, Zammit-Mangion, and Cressie (2019) data(&quot;SSTlandmask&quot;, package = &quot;STRbook&quot;) data(&quot;SSTlonlat&quot;, package = &quot;STRbook&quot;) data(&quot;SSTdata&quot;, package = &quot;STRbook&quot;) Delete the values of SST that are over land (e.g. SSTlandmask is 1) delete_rows &lt;- which(SSTlandmask == 1) SSTdata &lt;- SSTdata[-delete_rows, 1:396] The eigen decomposition of the sample covariance of the data is equivalent to the singular value decomposition of the scaled and detrended data \\(\\mathbf{y}\\). \\[\\begin{align*} \\tilde{\\mathbf{y}} &amp; \\equiv \\frac{1}{\\sqrt{T - 1}} \\left( \\right) \\end{align*}\\] To get a spatial EOF, we need to transform the data into space-wide format y &lt;- t(SSTdata) dim(y) ## [1] 396 2261 To use the equation above, we need to calculate the spatial mean and the number of spatial replicates and scale and detrend the data spatial_mean &lt;- apply(SSTdata, 1, mean) nT &lt;- ncol(SSTdata) y_tilde &lt;- 1 / sqrt(nT - 1) * (y - outer(rep(1, nT), spatial_mean)) We carry out the SVD on this scaled and detrended data svd_y &lt;- svd(y_tilde) which returns a list with three elements \\(\\mathbf{U}\\) \\(\\mathbf{D}\\) \\(\\mathbf{V}\\) \\[\\begin{align*} \\tilde{\\mathbf{y}} &amp; = \\mathbf{U} \\mathbf{D} \\mathbf{V} \\end{align*}\\] V &lt;- svd_y$v colnames(V) &lt;- paste0(&quot;EOF&quot;, 1:ncol(SSTdata)) EOFs &lt;- cbind(SSTlonlat[ - delete_rows, ], V) glimpse(EOFs[, 1:6, ]) ## Observations: 2,261 ## Variables: 6 ## $ lon &lt;dbl&gt; 154, 156, 158, 160, 162, 164, 166, 168, 170, 172, 174, 176, 178,… ## $ lat &lt;dbl&gt; -29, -29, -29, -29, -29, -29, -29, -29, -29, -29, -29, -29, -29,… ## $ EOF1 &lt;dbl&gt; -0.004915064, -0.001412275, 0.000245909, 0.001454972, 0.00226577… ## $ EOF2 &lt;dbl&gt; -1.212957e-02, -2.276177e-03, 2.298082e-03, 2.303585e-03, 1.6431… ## $ EOF3 &lt;dbl&gt; -0.02882162, -0.02552841, -0.01933020, -0.01905901, -0.02251571,… ## $ EOF4 &lt;dbl&gt; 8.540892e-05, 6.726077e-03, 8.591251e-03, 1.025538e-02, 1.125295… Plot the EOFs ggplot(data = EOFs, aes(x = lon, y = lat, fill = EOF1)) + geom_raster() + scale_fill_viridis_c(option = &quot;magma&quot;) + coord_fixed(ratio = 1.3) + theme_bw() + xlab(&quot;Longitude (deg)&quot;) + ylab(&quot;Latitude (deg)&quot;) ggplot(data = EOFs, aes(x = lon, y = lat, fill = EOF2)) + geom_raster() + scale_fill_viridis_c(option = &quot;magma&quot;) + coord_fixed(ratio = 1.3) + theme_bw() + xlab(&quot;Longitude (deg)&quot;) + ylab(&quot;Latitude (deg)&quot;) Recall the "]
]
