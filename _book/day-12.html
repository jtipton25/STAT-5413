<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12 Day 12 | Notes for STAT 5413 - Spatial Statistics</title>
  <meta name="description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="12 Day 12 | Notes for STAT 5413 - Spatial Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12 Day 12 | Notes for STAT 5413 - Spatial Statistics" />
  
  <meta name="twitter:description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  

<meta name="author" content="John Tipton" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="day-11.html"/>
<link rel="next" href="day-13.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.12/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.9.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">STAT 5413 Spatial Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="day-1.html"><a href="day-1.html"><i class="fa fa-check"></i><b>1</b> Day 1</a><ul>
<li class="chapter" data-level="1.1" data-path="day-1.html"><a href="day-1.html#notation"><i class="fa fa-check"></i><b>1.1</b> Notation</a></li>
<li class="chapter" data-level="1.2" data-path="day-1.html"><a href="day-1.html#probability-distributions"><i class="fa fa-check"></i><b>1.2</b> Probability Distributions</a><ul>
<li class="chapter" data-level="1.2.1" data-path="day-1.html"><a href="day-1.html#example-linear-regression"><i class="fa fa-check"></i><b>1.2.1</b> Example: linear regression</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="day-1.html"><a href="day-1.html#hierarchical-modeling"><i class="fa fa-check"></i><b>1.3</b> Hierarchical modeling</a><ul>
<li class="chapter" data-level="1.3.1" data-path="day-1.html"><a href="day-1.html#bayesian-hierarchical-models-bhms"><i class="fa fa-check"></i><b>1.3.1</b> Bayesian Hierarchical models (BHMs)</a></li>
<li class="chapter" data-level="1.3.2" data-path="day-1.html"><a href="day-1.html#empirical-hierarchical-models-ehms"><i class="fa fa-check"></i><b>1.3.2</b> Empirical Hierarchical models (EHMs)</a></li>
<li class="chapter" data-level="1.3.3" data-path="day-1.html"><a href="day-1.html#data-model"><i class="fa fa-check"></i><b>1.3.3</b> Data Model</a></li>
<li class="chapter" data-level="1.3.4" data-path="day-1.html"><a href="day-1.html#process-model"><i class="fa fa-check"></i><b>1.3.4</b> Process Model</a></li>
<li class="chapter" data-level="1.3.5" data-path="day-1.html"><a href="day-1.html#parameter-prior-model-bmhs-only"><i class="fa fa-check"></i><b>1.3.5</b> Parameter (Prior) Model (BMHs only)</a></li>
<li class="chapter" data-level="1.3.6" data-path="day-1.html"><a href="day-1.html#posterior-distribution"><i class="fa fa-check"></i><b>1.3.6</b> Posterior Distribution</a></li>
<li class="chapter" data-level="1.3.7" data-path="day-1.html"><a href="day-1.html#scientifically-motivated-statistical-modeling"><i class="fa fa-check"></i><b>1.3.7</b> Scientifically Motivated Statistical Modeling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="day-2.html"><a href="day-2.html"><i class="fa fa-check"></i><b>2</b> Day 2</a><ul>
<li class="chapter" data-level="2.1" data-path="day-2.html"><a href="day-2.html#spatial-data"><i class="fa fa-check"></i><b>2.1</b> Spatial Data</a></li>
<li class="chapter" data-level="2.2" data-path="day-2.html"><a href="day-2.html#types-of-spatial-data"><i class="fa fa-check"></i><b>2.2</b> Types of spatial data</a><ul>
<li class="chapter" data-level="2.2.1" data-path="day-2.html"><a href="day-2.html#geostatistical-data"><i class="fa fa-check"></i><b>2.2.1</b> Geostatistical data</a></li>
<li class="chapter" data-level="2.2.2" data-path="day-2.html"><a href="day-2.html#areal-data"><i class="fa fa-check"></i><b>2.2.2</b> Areal data</a></li>
<li class="chapter" data-level="2.2.3" data-path="day-2.html"><a href="day-2.html#point-process-data"><i class="fa fa-check"></i><b>2.2.3</b> Point process data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="day-3.html"><a href="day-3.html"><i class="fa fa-check"></i><b>3</b> Day 3</a><ul>
<li class="chapter" data-level="3.1" data-path="day-3.html"><a href="day-3.html#anouncements"><i class="fa fa-check"></i><b>3.1</b> Anouncements</a></li>
<li class="chapter" data-level="3.2" data-path="day-3.html"><a href="day-3.html#files-for-spatial-data"><i class="fa fa-check"></i><b>3.2</b> Files for spatial data</a></li>
<li class="chapter" data-level="3.3" data-path="day-3.html"><a href="day-3.html#textbook-package"><i class="fa fa-check"></i><b>3.3</b> Textbook package</a></li>
<li class="chapter" data-level="3.4" data-path="day-3.html"><a href="day-3.html#spatial-visualization"><i class="fa fa-check"></i><b>3.4</b> Spatial Visualization</a><ul>
<li class="chapter" data-level="3.4.1" data-path="day-3.html"><a href="day-3.html#spatial-visualization-using-fields"><i class="fa fa-check"></i><b>3.4.1</b> Spatial visualization using <em>fields</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="day-4.html"><a href="day-4.html"><i class="fa fa-check"></i><b>4</b> Day 4</a><ul>
<li class="chapter" data-level="4.1" data-path="day-4.html"><a href="day-4.html#announcements"><i class="fa fa-check"></i><b>4.1</b> Announcements</a></li>
<li class="chapter" data-level="4.2" data-path="day-4.html"><a href="day-4.html#visualization-continued"><i class="fa fa-check"></i><b>4.2</b> Visualization (continued)</a><ul>
<li class="chapter" data-level="4.2.1" data-path="day-4.html"><a href="day-4.html#spatial-visualization-using-fields-1"><i class="fa fa-check"></i><b>4.2.1</b> Spatial visualization using <em>fields</em></a></li>
<li class="chapter" data-level="4.2.2" data-path="day-4.html"><a href="day-4.html#in-class-activity"><i class="fa fa-check"></i><b>4.2.2</b> In Class Activity:</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="day-4.html"><a href="day-4.html#interactive-visualization-interactive-with-html-format-only"><i class="fa fa-check"></i><b>4.3</b> Interactive visualization (Interactive with HTML format only)</a><ul>
<li class="chapter" data-level="4.3.1" data-path="day-4.html"><a href="day-4.html#interactive-display-of-data"><i class="fa fa-check"></i><b>4.3.1</b> Interactive display of data</a></li>
<li class="chapter" data-level="4.3.2" data-path="day-4.html"><a href="day-4.html#animations"><i class="fa fa-check"></i><b>4.3.2</b> Animations</a></li>
<li class="chapter" data-level="4.3.3" data-path="day-4.html"><a href="day-4.html#interactive-plotting-using-plotly"><i class="fa fa-check"></i><b>4.3.3</b> Interactive plotting using <em>plotly</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="day-5.html"><a href="day-5.html"><i class="fa fa-check"></i><b>5</b> Day 5</a><ul>
<li class="chapter" data-level="5.1" data-path="day-5.html"><a href="day-5.html#announcements-1"><i class="fa fa-check"></i><b>5.1</b> Announcements</a></li>
<li class="chapter" data-level="5.2" data-path="day-5.html"><a href="day-5.html#spatial-means-and-covariances"><i class="fa fa-check"></i><b>5.2</b> Spatial means and covariances</a><ul>
<li class="chapter" data-level="5.2.1" data-path="day-5.html"><a href="day-5.html#gaussian-processes"><i class="fa fa-check"></i><b>5.2.1</b> Gaussian processes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="day-6.html"><a href="day-6.html"><i class="fa fa-check"></i><b>6</b> Day 6</a><ul>
<li class="chapter" data-level="6.1" data-path="day-6.html"><a href="day-6.html#announcements-2"><i class="fa fa-check"></i><b>6.1</b> Announcements</a></li>
<li class="chapter" data-level="6.2" data-path="day-6.html"><a href="day-6.html#gaussian-process-assumptions"><i class="fa fa-check"></i><b>6.2</b> Gaussian process assumptions</a></li>
<li class="chapter" data-level="6.3" data-path="day-6.html"><a href="day-6.html#recall-hierachical-modeling"><i class="fa fa-check"></i><b>6.3</b> Recall Hierachical modeling</a><ul>
<li class="chapter" data-level="6.3.1" data-path="day-6.html"><a href="day-6.html#data-model-1"><i class="fa fa-check"></i><b>6.3.1</b> Data Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="day-7.html"><a href="day-7.html"><i class="fa fa-check"></i><b>7</b> Day 7</a><ul>
<li class="chapter" data-level="7.1" data-path="day-7.html"><a href="day-7.html#common-isotropic-correlation-functions"><i class="fa fa-check"></i><b>7.1</b> Common isotropic correlation functions</a></li>
<li class="chapter" data-level="7.2" data-path="day-7.html"><a href="day-7.html#covariograms-and-semivariograms"><i class="fa fa-check"></i><b>7.2</b> Covariograms and semivariograms</a><ul>
<li class="chapter" data-level="7.2.1" data-path="day-7.html"><a href="day-7.html#semivariograms-and-variograms"><i class="fa fa-check"></i><b>7.2.1</b> Semivariograms and variograms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="day-8.html"><a href="day-8.html"><i class="fa fa-check"></i><b>8</b> Day 8</a><ul>
<li class="chapter" data-level="8.1" data-path="day-8.html"><a href="day-8.html#announcements-3"><i class="fa fa-check"></i><b>8.1</b> Announcements</a></li>
<li class="chapter" data-level="8.2" data-path="day-8.html"><a href="day-8.html#estimation-of-the-spatial-process"><i class="fa fa-check"></i><b>8.2</b> Estimation of the spatial process</a><ul>
<li class="chapter" data-level="8.2.1" data-path="day-8.html"><a href="day-8.html#estimation-of-the-spatial-process-using-variograms"><i class="fa fa-check"></i><b>8.2.1</b> Estimation of the spatial process using variograms</a></li>
<li class="chapter" data-level="8.2.2" data-path="day-8.html"><a href="day-8.html#maximum-likelihood"><i class="fa fa-check"></i><b>8.2.2</b> Maximum Likelihood</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="day-8.html"><a href="day-8.html#maximum-likelihood-1"><i class="fa fa-check"></i><b>8.3</b> Maximum likelihood</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="day-9.html"><a href="day-9.html"><i class="fa fa-check"></i><b>9</b> Day 9</a><ul>
<li class="chapter" data-level="9.1" data-path="day-9.html"><a href="day-9.html#announcements-4"><i class="fa fa-check"></i><b>9.1</b> Announcements</a></li>
<li class="chapter" data-level="9.2" data-path="day-9.html"><a href="day-9.html#asymptotic-properties-of-the-mle"><i class="fa fa-check"></i><b>9.2</b> Asymptotic properties of the MLE</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="day-10.html"><a href="day-10.html"><i class="fa fa-check"></i><b>10</b> Day 10</a><ul>
<li class="chapter" data-level="10.1" data-path="day-10.html"><a href="day-10.html#announcements-5"><i class="fa fa-check"></i><b>10.1</b> Announcements</a></li>
<li class="chapter" data-level="10.2" data-path="day-10.html"><a href="day-10.html#asymptotic-properties-of-the-mle-1"><i class="fa fa-check"></i><b>10.2</b> Asymptotic properties of the MLE</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="day-11.html"><a href="day-11.html"><i class="fa fa-check"></i><b>11</b> Day 11</a><ul>
<li class="chapter" data-level="11.1" data-path="day-11.html"><a href="day-11.html#announcements-6"><i class="fa fa-check"></i><b>11.1</b> Announcements</a></li>
<li class="chapter" data-level="11.2" data-path="day-11.html"><a href="day-11.html#example-spatial-analysis"><i class="fa fa-check"></i><b>11.2</b> Example spatial analysis</a></li>
<li class="chapter" data-level="11.3" data-path="day-11.html"><a href="day-11.html#spatial-model-fitting"><i class="fa fa-check"></i><b>11.3</b> Spatial model fitting</a><ul>
<li class="chapter" data-level="11.3.1" data-path="day-11.html"><a href="day-11.html#fit-the-maximum-likelihood-estimate-using-the-geor-package"><i class="fa fa-check"></i><b>11.3.1</b> Fit the maximum likelihood estimate using the <em>geoR</em> package</a></li>
<li class="chapter" data-level="11.3.2" data-path="day-11.html"><a href="day-11.html#fitting-a-spatial-model-using-the-nlme-package"><i class="fa fa-check"></i><b>11.3.2</b> Fitting a spatial model using the <em>nlme</em> package</a></li>
<li class="chapter" data-level="11.3.3" data-path="day-11.html"><a href="day-11.html#model-fitting-with-autokrige-function"><i class="fa fa-check"></i><b>11.3.3</b> model fitting with <em>autokrige</em> function</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="day-11.html"><a href="day-11.html#kriging"><i class="fa fa-check"></i><b>11.4</b> Kriging</a><ul>
<li class="chapter" data-level="11.4.1" data-path="day-11.html"><a href="day-11.html#kriging-equations-with-mean-mu-0"><i class="fa fa-check"></i><b>11.4.1</b> Kriging Equations with mean <span class="math inline">\(\mu = 0\)</span></a></li>
<li class="chapter" data-level="11.4.2" data-path="day-11.html"><a href="day-11.html#kriging-equations-with-unknown-mean"><i class="fa fa-check"></i><b>11.4.2</b> Kriging Equations with unknown mean</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="day-12.html"><a href="day-12.html"><i class="fa fa-check"></i><b>12</b> Day 12</a><ul>
<li class="chapter" data-level="12.1" data-path="day-12.html"><a href="day-12.html#announcements-7"><i class="fa fa-check"></i><b>12.1</b> Announcements</a></li>
<li class="chapter" data-level="12.2" data-path="day-12.html"><a href="day-12.html#introduction-to-mcmc"><i class="fa fa-check"></i><b>12.2</b> Introduction to MCMC</a></li>
<li class="chapter" data-level="12.3" data-path="day-12.html"><a href="day-12.html#example-simple-linear-regression"><i class="fa fa-check"></i><b>12.3</b> Example: Simple linear regression</a></li>
<li class="chapter" data-level="12.4" data-path="day-12.html"><a href="day-12.html#the-posterior-distribution"><i class="fa fa-check"></i><b>12.4</b> The posterior distribution</a><ul>
<li class="chapter" data-level="12.4.1" data-path="day-12.html"><a href="day-12.html#full-conditional-distribution-of-mu"><i class="fa fa-check"></i><b>12.4.1</b> Full conditional distribution of <span class="math inline">\(\mu\)</span></a></li>
<li class="chapter" data-level="12.4.2" data-path="day-12.html"><a href="day-12.html#full-conditional-distribution-for-beta"><i class="fa fa-check"></i><b>12.4.2</b> Full conditional distribution for <span class="math inline">\(\beta\)</span></a></li>
<li class="chapter" data-level="12.4.3" data-path="day-12.html"><a href="day-12.html#full-conditional-distribution-for-sigma2"><i class="fa fa-check"></i><b>12.4.3</b> Full conditional distribution for <span class="math inline">\(\sigma^2\)</span></a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="day-12.html"><a href="day-12.html#fitting-the-model"><i class="fa fa-check"></i><b>12.5</b> Fitting the model</a><ul>
<li class="chapter" data-level="12.5.1" data-path="day-12.html"><a href="day-12.html#general-recommendations-for-writing-mcmc-software"><i class="fa fa-check"></i><b>12.5.1</b> General recommendations for writing MCMC software</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="day-13.html"><a href="day-13.html"><i class="fa fa-check"></i><b>13</b> Day 13</a><ul>
<li class="chapter" data-level="13.1" data-path="day-13.html"><a href="day-13.html#announcements-8"><i class="fa fa-check"></i><b>13.1</b> Announcements</a></li>
<li class="chapter" data-level="13.2" data-path="day-13.html"><a href="day-13.html#the-metropolis-algorithm"><i class="fa fa-check"></i><b>13.2</b> The Metropolis Algorithm</a></li>
<li class="chapter" data-level="13.3" data-path="day-13.html"><a href="day-13.html#the-proposal-distribution"><i class="fa fa-check"></i><b>13.3</b> The proposal distribution</a></li>
<li class="chapter" data-level="13.4" data-path="day-13.html"><a href="day-13.html#the-metropolis-update"><i class="fa fa-check"></i><b>13.4</b> The Metropolis update</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="day-14.html"><a href="day-14.html"><i class="fa fa-check"></i><b>14</b> Day 14</a><ul>
<li class="chapter" data-level="14.1" data-path="day-14.html"><a href="day-14.html#announcements-9"><i class="fa fa-check"></i><b>14.1</b> Announcements</a></li>
<li class="chapter" data-level="14.2" data-path="day-14.html"><a href="day-14.html#the-metropolis-hastings-algorithm"><i class="fa fa-check"></i><b>14.2</b> The Metropolis-Hastings Algorithm</a></li>
<li class="chapter" data-level="14.3" data-path="day-14.html"><a href="day-14.html#the-metropolis-hastings-algorithm-1"><i class="fa fa-check"></i><b>14.3</b> The Metropolis-Hastings algorithm</a></li>
<li class="chapter" data-level="14.4" data-path="day-14.html"><a href="day-14.html#example-1"><i class="fa fa-check"></i><b>14.4</b> Example</a></li>
<li class="chapter" data-level="14.5" data-path="day-14.html"><a href="day-14.html#posterior"><i class="fa fa-check"></i><b>14.5</b> Posterior</a></li>
<li class="chapter" data-level="14.6" data-path="day-14.html"><a href="day-14.html#conditional-posterior-for-phi"><i class="fa fa-check"></i><b>14.6</b> Conditional posterior for <span class="math inline">\(\phi\)</span></a></li>
<li class="chapter" data-level="14.7" data-path="day-14.html"><a href="day-14.html#conditional-posterior-for-sigma2"><i class="fa fa-check"></i><b>14.7</b> Conditional posterior for <span class="math inline">\(\sigma^2\)</span></a></li>
<li class="chapter" data-level="14.8" data-path="day-14.html"><a href="day-14.html#mcmc-using-a-symmetric-proposal-metropolis"><i class="fa fa-check"></i><b>14.8</b> MCMC using a symmetric proposal (Metropolis)</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="day-15.html"><a href="day-15.html"><i class="fa fa-check"></i><b>15</b> Day 15</a><ul>
<li class="chapter" data-level="15.1" data-path="day-15.html"><a href="day-15.html#announcements-10"><i class="fa fa-check"></i><b>15.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="day-16.html"><a href="day-16.html"><i class="fa fa-check"></i><b>16</b> Day 16</a><ul>
<li class="chapter" data-level="16.1" data-path="day-16.html"><a href="day-16.html#announcements-11"><i class="fa fa-check"></i><b>16.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="day-17.html"><a href="day-17.html"><i class="fa fa-check"></i><b>17</b> Day 17</a><ul>
<li class="chapter" data-level="17.1" data-path="day-17.html"><a href="day-17.html#announcements-12"><i class="fa fa-check"></i><b>17.1</b> Announcements</a></li>
<li class="chapter" data-level="17.2" data-path="day-17.html"><a href="day-17.html#gaussian-process-representations"><i class="fa fa-check"></i><b>17.2</b> Gaussian process representations</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="day-18.html"><a href="day-18.html"><i class="fa fa-check"></i><b>18</b> Day 18</a><ul>
<li class="chapter" data-level="18.1" data-path="day-18.html"><a href="day-18.html#announcements-13"><i class="fa fa-check"></i><b>18.1</b> Announcements</a></li>
<li class="chapter" data-level="18.2" data-path="day-18.html"><a href="day-18.html#gaussian-process-representations-continued"><i class="fa fa-check"></i><b>18.2</b> Gaussian process representations continued</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="day-19.html"><a href="day-19.html"><i class="fa fa-check"></i><b>19</b> Day 19</a><ul>
<li class="chapter" data-level="19.1" data-path="day-19.html"><a href="day-19.html#announcements-14"><i class="fa fa-check"></i><b>19.1</b> Announcements</a></li>
<li class="chapter" data-level="19.2" data-path="day-19.html"><a href="day-19.html#stochastic-integration"><i class="fa fa-check"></i><b>19.2</b> Stochastic Integration</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="day-20.html"><a href="day-20.html"><i class="fa fa-check"></i><b>20</b> Day 20</a><ul>
<li class="chapter" data-level="20.1" data-path="day-20.html"><a href="day-20.html#announcements-15"><i class="fa fa-check"></i><b>20.1</b> Announcements</a></li>
<li class="chapter" data-level="20.2" data-path="day-20.html"><a href="day-20.html#spbayes-example"><i class="fa fa-check"></i><b>20.2</b> spBayes example</a></li>
<li class="chapter" data-level="20.3" data-path="day-20.html"><a href="day-20.html#global-vs.local-basis-function"><i class="fa fa-check"></i><b>20.3</b> Global vs. Local Basis function</a><ul>
<li class="chapter" data-level="20.3.1" data-path="day-20.html"><a href="day-20.html#an-example-global-basis-fourier-basis"><i class="fa fa-check"></i><b>20.3.1</b> An example global basis: Fourier Basis</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="day-20.html"><a href="day-20.html#example-local-basis"><i class="fa fa-check"></i><b>20.4</b> example local basis</a></li>
<li class="chapter" data-level="20.5" data-path="day-20.html"><a href="day-20.html#fitting-spatial-models-many-ways"><i class="fa fa-check"></i><b>20.5</b> Fitting spatial models many ways</a></li>
<li class="chapter" data-level="20.6" data-path="day-20.html"><a href="day-20.html#empirical-orthogonal-functions"><i class="fa fa-check"></i><b>20.6</b> Empirical Orthogonal Functions</a></li>
<li class="chapter" data-level="20.7" data-path="day-20.html"><a href="day-20.html#spatial-modeling-with-mgcv-package"><i class="fa fa-check"></i><b>20.7</b> Spatial modeling with <code>mgcv</code> package</a></li>
<li class="chapter" data-level="20.8" data-path="day-20.html"><a href="day-20.html#spatial-modeling-with-kernels"><i class="fa fa-check"></i><b>20.8</b> Spatial modeling with Kernels</a><ul>
<li class="chapter" data-level="20.8.1" data-path="day-20.html"><a href="day-20.html#kernel-regression-with-a-ridge-penalty"><i class="fa fa-check"></i><b>20.8.1</b> Kernel regression with a ridge penalty</a></li>
<li class="chapter" data-level="20.8.2" data-path="day-20.html"><a href="day-20.html#kernel-regression-with-a-lasso-penalty"><i class="fa fa-check"></i><b>20.8.2</b> Kernel regression with a lasso penalty</a></li>
<li class="chapter" data-level="20.8.3" data-path="day-20.html"><a href="day-20.html#truncated-kernels---local-support"><i class="fa fa-check"></i><b>20.8.3</b> Truncated Kernels - local support</a></li>
</ul></li>
<li class="chapter" data-level="20.9" data-path="day-20.html"><a href="day-20.html#sparse-vs.dense-matrix-computation"><i class="fa fa-check"></i><b>20.9</b> Sparse vs. Dense matrix computation</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="day-21.html"><a href="day-21.html"><i class="fa fa-check"></i><b>21</b> Day 21</a><ul>
<li class="chapter" data-level="21.1" data-path="day-21.html"><a href="day-21.html#announcements-16"><i class="fa fa-check"></i><b>21.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="day-22.html"><a href="day-22.html"><i class="fa fa-check"></i><b>22</b> Day 22</a><ul>
<li class="chapter" data-level="22.1" data-path="day-22.html"><a href="day-22.html#announcements-17"><i class="fa fa-check"></i><b>22.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="day-23.html"><a href="day-23.html"><i class="fa fa-check"></i><b>23</b> Day 23</a><ul>
<li class="chapter" data-level="23.1" data-path="day-23.html"><a href="day-23.html#announcements-18"><i class="fa fa-check"></i><b>23.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="day-24-scaling-gps-for-large-data.html"><a href="day-24-scaling-gps-for-large-data.html"><i class="fa fa-check"></i><b>24</b> Day 24 – Scaling GPs for large data</a><ul>
<li class="chapter" data-level="24.1" data-path="day-24-scaling-gps-for-large-data.html"><a href="day-24-scaling-gps-for-large-data.html#announcements-19"><i class="fa fa-check"></i><b>24.1</b> Announcements</a></li>
<li class="chapter" data-level="24.2" data-path="day-24-scaling-gps-for-large-data.html"><a href="day-24-scaling-gps-for-large-data.html#local-analysis"><i class="fa fa-check"></i><b>24.2</b> Local analysis</a></li>
<li class="chapter" data-level="24.3" data-path="day-24-scaling-gps-for-large-data.html"><a href="day-24-scaling-gps-for-large-data.html#low-rank-approimxations"><i class="fa fa-check"></i><b>24.3</b> Low rank approimxations</a></li>
<li class="chapter" data-level="24.4" data-path="day-24-scaling-gps-for-large-data.html"><a href="day-24-scaling-gps-for-large-data.html#spectral-basis-functions"><i class="fa fa-check"></i><b>24.4</b> Spectral basis functions</a></li>
<li class="chapter" data-level="24.5" data-path="day-24-scaling-gps-for-large-data.html"><a href="day-24-scaling-gps-for-large-data.html#kernel-convolutions"><i class="fa fa-check"></i><b>24.5</b> Kernel convolutions</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html"><i class="fa fa-check"></i><b>25</b> Day 25 – Scaling GPs for large data</a><ul>
<li class="chapter" data-level="25.1" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html#announcements-20"><i class="fa fa-check"></i><b>25.1</b> Announcements</a></li>
<li class="chapter" data-level="25.2" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html#gaussian-predictive-process-spbayes-package"><i class="fa fa-check"></i><b>25.2</b> <span>Gaussian Predictive Process</span> (spBayes package)</a></li>
<li class="chapter" data-level="25.3" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html#sparse-matrix-routines"><i class="fa fa-check"></i><b>25.3</b> Sparse matrix routines</a></li>
<li class="chapter" data-level="25.4" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html#the-stochastic-pde-approach"><i class="fa fa-check"></i><b>25.4</b> The stochastic PDE approach</a></li>
<li class="chapter" data-level="25.5" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html#approximate-likelihood-methods"><i class="fa fa-check"></i><b>25.5</b> Approximate likelihood methods</a></li>
<li class="chapter" data-level="25.6" data-path="day-25-scaling-gps-for-large-data.html"><a href="day-25-scaling-gps-for-large-data.html#vecchia-approximations"><i class="fa fa-check"></i><b>25.6</b> Vecchia Approximations</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="day-26.html"><a href="day-26.html"><i class="fa fa-check"></i><b>26</b> Day 26</a><ul>
<li class="chapter" data-level="26.1" data-path="day-26.html"><a href="day-26.html#announcements-21"><i class="fa fa-check"></i><b>26.1</b> Announcements</a></li>
<li class="chapter" data-level="26.2" data-path="day-26.html"><a href="day-26.html#multivariate-data"><i class="fa fa-check"></i><b>26.2</b> Multivariate Data</a></li>
<li class="chapter" data-level="26.3" data-path="day-26.html"><a href="day-26.html#classical-multivariate-geostatistics"><i class="fa fa-check"></i><b>26.3</b> Classical Multivariate Geostatistics</a><ul>
<li class="chapter" data-level="26.3.1" data-path="day-26.html"><a href="day-26.html#cross-variograms-and-cross-covariance-functions"><i class="fa fa-check"></i><b>26.3.1</b> cross-variograms and cross-covariance functions</a></li>
<li class="chapter" data-level="26.3.2" data-path="day-26.html"><a href="day-26.html#cokriging"><i class="fa fa-check"></i><b>26.3.2</b> Cokriging</a></li>
<li class="chapter" data-level="26.3.3" data-path="day-26.html"><a href="day-26.html#linear-model-of-coregionalization"><i class="fa fa-check"></i><b>26.3.3</b> Linear Model of Coregionalization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="27" data-path="day-27.html"><a href="day-27.html"><i class="fa fa-check"></i><b>27</b> Day 27</a><ul>
<li class="chapter" data-level="27.1" data-path="day-27.html"><a href="day-27.html#announcements-22"><i class="fa fa-check"></i><b>27.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="day-28.html"><a href="day-28.html"><i class="fa fa-check"></i><b>28</b> Day 28</a><ul>
<li class="chapter" data-level="28.1" data-path="day-28.html"><a href="day-28.html#announcements-23"><i class="fa fa-check"></i><b>28.1</b> Announcements</a></li>
<li class="chapter" data-level="28.2" data-path="day-28.html"><a href="day-28.html#intro-to-stan"><i class="fa fa-check"></i><b>28.2</b> Intro to stan</a><ul>
<li class="chapter" data-level="28.2.1" data-path="day-28.html"><a href="day-28.html#example-linear-regression-1"><i class="fa fa-check"></i><b>28.2.1</b> Example: Linear regression</a></li>
<li class="chapter" data-level="28.2.2" data-path="day-28.html"><a href="day-28.html#example-spatial-model-in-stan"><i class="fa fa-check"></i><b>28.2.2</b> Example: Spatial model in stan</a></li>
<li class="chapter" data-level="28.2.3" data-path="day-28.html"><a href="day-28.html#example-predictive-process-model-in-stan"><i class="fa fa-check"></i><b>28.2.3</b> Example: Predictive process model in stan</a></li>
</ul></li>
<li class="chapter" data-level="28.3" data-path="day-28.html"><a href="day-28.html#stan-hints-and-tips"><i class="fa fa-check"></i><b>28.3</b> stan Hints and tips</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="day-29.html"><a href="day-29.html"><i class="fa fa-check"></i><b>29</b> Day 29</a><ul>
<li class="chapter" data-level="29.1" data-path="day-29.html"><a href="day-29.html#announcements-24"><i class="fa fa-check"></i><b>29.1</b> Announcements</a></li>
<li class="chapter" data-level="29.2" data-path="day-29.html"><a href="day-29.html#areal-data-1"><i class="fa fa-check"></i><b>29.2</b> Areal Data</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="day-30.html"><a href="day-30.html"><i class="fa fa-check"></i><b>30</b> Day 30</a><ul>
<li class="chapter" data-level="30.1" data-path="day-30.html"><a href="day-30.html#announcements-25"><i class="fa fa-check"></i><b>30.1</b> Announcements</a></li>
<li class="chapter" data-level="30.2" data-path="day-30.html"><a href="day-30.html#gaussian-markov-random-fields-gmrfs"><i class="fa fa-check"></i><b>30.2</b> Gaussian Markov random fields (GMRFs)</a><ul>
<li class="chapter" data-level="30.2.1" data-path="day-30.html"><a href="day-30.html#example-2"><i class="fa fa-check"></i><b>30.2.1</b> Example:</a></li>
</ul></li>
<li class="chapter" data-level="30.3" data-path="day-30.html"><a href="day-30.html#conditional-autoregressive-models-car-models"><i class="fa fa-check"></i><b>30.3</b> Conditional Autoregressive models (CAR models)</a><ul>
<li class="chapter" data-level="30.3.1" data-path="day-30.html"><a href="day-30.html#models-built-based-on-conditional-distributions-y_i-mathbfy_-i"><i class="fa fa-check"></i><b>30.3.1</b> Models built based on conditional distributions: <span class="math inline">\(y_i | \mathbf{y}_{-i}\)</span></a></li>
<li class="chapter" data-level="30.3.2" data-path="day-30.html"><a href="day-30.html#simultaneous-autoregressive-sar-model"><i class="fa fa-check"></i><b>30.3.2</b> Simultaneous autoregressive (SAR) model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="31" data-path="day-31.html"><a href="day-31.html"><i class="fa fa-check"></i><b>31</b> Day 31</a><ul>
<li class="chapter" data-level="31.1" data-path="day-31.html"><a href="day-31.html#announcements-26"><i class="fa fa-check"></i><b>31.1</b> Announcements</a></li>
<li class="chapter" data-level="31.2" data-path="day-31.html"><a href="day-31.html#change-of-spatial-support"><i class="fa fa-check"></i><b>31.2</b> Change of Spatial Support</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="day-32.html"><a href="day-32.html"><i class="fa fa-check"></i><b>32</b> Day 32</a><ul>
<li class="chapter" data-level="32.1" data-path="day-32.html"><a href="day-32.html#announcements-27"><i class="fa fa-check"></i><b>32.1</b> Announcements</a></li>
<li class="chapter" data-level="32.2" data-path="day-32.html"><a href="day-32.html#generalized-non-gaussian-spatial-models"><i class="fa fa-check"></i><b>32.2</b> Generalized (non-Gaussian) spatial models</a></li>
</ul></li>
<li class="chapter" data-level="33" data-path="day-33.html"><a href="day-33.html"><i class="fa fa-check"></i><b>33</b> Day 33</a><ul>
<li class="chapter" data-level="33.1" data-path="day-33.html"><a href="day-33.html#announcements-28"><i class="fa fa-check"></i><b>33.1</b> Announcements</a></li>
<li class="chapter" data-level="33.2" data-path="day-33.html"><a href="day-33.html#spatio-temporal-data"><i class="fa fa-check"></i><b>33.2</b> Spatio-temporal data</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="day-34.html"><a href="day-34.html"><i class="fa fa-check"></i><b>34</b> Day 34</a><ul>
<li class="chapter" data-level="34.1" data-path="day-34.html"><a href="day-34.html#announcements-29"><i class="fa fa-check"></i><b>34.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="35" data-path="day-35.html"><a href="day-35.html"><i class="fa fa-check"></i><b>35</b> Day 35</a><ul>
<li class="chapter" data-level="35.1" data-path="day-35.html"><a href="day-35.html#announcements-30"><i class="fa fa-check"></i><b>35.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="36" data-path="day-36.html"><a href="day-36.html"><i class="fa fa-check"></i><b>36</b> Day 36</a><ul>
<li class="chapter" data-level="36.1" data-path="day-36.html"><a href="day-36.html#announcements-31"><i class="fa fa-check"></i><b>36.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="37" data-path="day-37.html"><a href="day-37.html"><i class="fa fa-check"></i><b>37</b> Day 37</a><ul>
<li class="chapter" data-level="37.1" data-path="day-37.html"><a href="day-37.html#announcements-32"><i class="fa fa-check"></i><b>37.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="38" data-path="day-38.html"><a href="day-38.html"><i class="fa fa-check"></i><b>38</b> Day 38</a><ul>
<li class="chapter" data-level="38.1" data-path="day-38.html"><a href="day-38.html#announcements-33"><i class="fa fa-check"></i><b>38.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="39" data-path="day-39.html"><a href="day-39.html"><i class="fa fa-check"></i><b>39</b> Day 39</a><ul>
<li class="chapter" data-level="39.1" data-path="day-39.html"><a href="day-39.html#announcements-34"><i class="fa fa-check"></i><b>39.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="40" data-path="day-40.html"><a href="day-40.html"><i class="fa fa-check"></i><b>40</b> Day 40</a><ul>
<li class="chapter" data-level="40.1" data-path="day-40.html"><a href="day-40.html#announcements-35"><i class="fa fa-check"></i><b>40.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="41" data-path="day-41.html"><a href="day-41.html"><i class="fa fa-check"></i><b>41</b> Day 41</a><ul>
<li class="chapter" data-level="41.1" data-path="day-41.html"><a href="day-41.html#announcements-36"><i class="fa fa-check"></i><b>41.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="42" data-path="day-42.html"><a href="day-42.html"><i class="fa fa-check"></i><b>42</b> Day 42</a><ul>
<li class="chapter" data-level="42.1" data-path="day-42.html"><a href="day-42.html#announcements-37"><i class="fa fa-check"></i><b>42.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="43" data-path="day-43.html"><a href="day-43.html"><i class="fa fa-check"></i><b>43</b> Day 43</a><ul>
<li class="chapter" data-level="43.1" data-path="day-43.html"><a href="day-43.html#announcements-38"><i class="fa fa-check"></i><b>43.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes for STAT 5413 - Spatial Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="day-12" class="section level1">
<h1><span class="header-section-number">12</span> Day 12</h1>
<div id="announcements-7" class="section level2">
<h2><span class="header-section-number">12.1</span> Announcements</h2>
</div>
<div id="introduction-to-mcmc" class="section level2">
<h2><span class="header-section-number">12.2</span> Introduction to MCMC</h2>
<p>To estimate models within the Bayesian framework, the most commonly used method is Markov Chain Monte Carlo. Recall that the main difference between a Bayesian posterior distribution and a likelihood function is that the Bayesian posterior distribution integrates to 1 whereas the likelihood function does not. The posterior distribution of <span class="math inline">\(\boldsymbol{\theta}\)</span> given <span class="math inline">\(\mathbf{y}\)</span> is</p>
<p><span class="math display" id="eq:posterior">\[\begin{align*}
[\boldsymbol{\theta} | \mathbf{y} ] &amp; = \frac{[\mathbf{y} | \boldsymbol{\theta}] [\boldsymbol{\theta} ]}{[\mathbf{y}]} \\
\tag{12.1}
&amp; = \frac{[\mathbf{y} | \boldsymbol{\theta}] [\boldsymbol{\theta}]}{ \int_{\boldsymbol{\theta}} [\mathbf{y}|\boldsymbol{\theta}] [\boldsymbol{\theta}] d\boldsymbol{\theta}},
\end{align*}\]</span></p>
<p>where the integral in <a href="day-12.html#eq:posterior">(12.1)</a> guarantees that the posterior distribution integrates to 1. For some models, the integral in <a href="day-12.html#eq:posterior">(12.1)</a> is analytically tractable (e.g. Normal likelihood and Normal prior), but for most interesting models the integral is not available in a closed form solution. Instead, we can approximate the integral numerically using a technique called Markov Chain Monte Carlo (MCMC) (See the seminal paper by <a href="http://wwwf.imperial.ac.uk/~das01/MyWeb/SCBI/Papers/GelfandSmith.pdf">Gelfand and Smith 1990</a> for more details).</p>
<p>Instead of evaluating the probability distribution and calculating the normalizing constant, we can generate samples from the marginal posterior distribution of each parameter in such a way that the joint distribution of the samples from the marginal distributions is equivalent to samples from the posterior, up to Monte Carlo error.</p>
</div>
<div id="example-simple-linear-regression" class="section level2">
<h2><span class="header-section-number">12.3</span> Example: Simple linear regression</h2>
<p>Consider the simple linear regression model for <span class="math inline">\(i=1, \ldots, N\)</span> observations</p>
<p><span class="math display" id="eq:regression">\[\begin{align}
\tag{12.2}
y_i &amp; = \mu + x_i \beta + \varepsilon_i
\end{align}\]</span></p>
<p>where <span class="math inline">\(\varepsilon_i \sim N(0, \sigma^2)\)</span> and <span class="math inline">\(x_i\)</span> are known univariate covariates. If we assume the prior distributions <span class="math inline">\(\mu \sim N(\mu_\mu, \sigma^2_\mu)\)</span> with <span class="math inline">\(\mu_\mu\)</span> and <span class="math inline">\(\sigma^2_\mu\)</span> fixed and known, <span class="math inline">\(\beta \sim N(\mu_\beta, \sigma^2_\beta)\)</span> with <span class="math inline">\(\mu_\beta\)</span> and <span class="math inline">\(\sigma^2_\beta\)</span> fixed and known, and <span class="math inline">\(\sigma^2 \sim \operatorname{inverse-gamma}(\alpha_0, \beta_0)\)</span> with <span class="math inline">\(\alpha_0\)</span> and <span class="math inline">\(\beta_0\)</span> fixed and known. where the <span class="math inline">\(\operatorname{inverse-gamma}(\alpha_0, \beta_0)\)</span> distribution is
<span class="math display">\[\begin{align}
[\sigma^2 | \alpha_0, \beta_0] &amp; = \frac{\beta_0^{\alpha_0}} {\Gamma(\alpha_0)} (\sigma^2)^{-\alpha_0 - 1} \exp\left\{ - \frac{\beta_0}{\sigma^2} \right\}.
\end{align}\]</span></p>
</div>
<div id="the-posterior-distribution" class="section level2">
<h2><span class="header-section-number">12.4</span> The posterior distribution</h2>
<p>Given the model statement, we can write out the posterior distribution on which we want inference. The posterior distribution is</p>
<p><span class="math display">\[\begin{align}
[\mu, \beta, \sigma^2 | \mathbf{y}] &amp; = \frac{\prod_{i=1}^N [y_i | \mu, \beta, \sigma^2 ] [\mu] [\beta] [\sigma^2]}{\int_\mu \int_\beta \int_{\sigma^2} \prod_{i=1}^N [y_i | \mu, \beta, \sigma^2 ] [\mu] [\beta] [\sigma^2] \,d\sigma^2 \,d\beta \,d\mu}.
\end{align}\]</span>
Notice that we don’t include <span class="math inline">\(x_i\)</span> in the above statement because it is assumed fixed and known. For the model we defined in <a href="day-12.html#eq:regression">(12.2)</a>, the posterior distribution is available in closed form because we can evaluate the integrals in the denominator analytically. However, the integrals are challenging and for most interesting models, are not available in closed form.</p>
<p>Given the posterior distribution, the next step is to find the marginal posterior distributions of <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\sigma^2\)</span>.</p>
<div id="full-conditional-distribution-of-mu" class="section level3">
<h3><span class="header-section-number">12.4.1</span> Full conditional distribution of <span class="math inline">\(\mu\)</span></h3>
<p>The full conditional distribution (marginal posterior) for <span class="math inline">\(\mu\)</span> given all other parameters in the model is</p>
<p><span class="math display">\[\begin{align}
[\mu | \cdot] &amp; \propto \prod_{i=1^N} [y_i | \mu, \beta, \sigma^2 ] [\mu] [\beta] [\sigma^2]  \\
&amp; \propto \prod_{i=1}^N [y_i | \mu, \beta, \sigma^2 ] [\mu] \\
&amp; \propto \prod_{i=1}^N \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \left\{ -\frac{1}{2 \sigma^2}  \left(y_i - \left(\mu + x_i \beta\right)\right)^2 \right\} \frac{1}{\sqrt{2 \pi \sigma^2_\mu}}  \exp \left\{ -\frac{1}{2 \sigma_\mu^2}  \left(\mu - \mu_\mu\right)^2 \right\} \\
&amp; \propto \prod_{i=1}^N \exp \left\{ -\frac{1}{2 \sigma^2}  \left(\mu^2 - 2 \mu \left(y_i - x_i\beta\right)\right) \right\} \exp \left\{ -\frac{1}{2 \sigma_\mu^2}  \left(\mu^2 - 2 \mu \mu_\mu\right) \right\} \\
&amp; \propto \exp \left\{ -\frac{1}{2}  \left(\mu^2 \left(\frac{N}{\sigma^2} + \frac{1}{\sigma^2_\mu}\right) - 2 \mu \left(\frac{ \sum_{i=1}^N y_i - x_i\beta }{\sigma^2} + \frac{\mu_\mu}{\sigma^2_\mu}\right)\right) \right\} 
\end{align}\]</span></p>
<p>which is a normal distribution with mean <span class="math inline">\(a_\mu^{-1}b_\mu\)</span> and variance <span class="math inline">\(a_\mu^{-1}\)</span> where</p>
<p><span class="math display">\[\begin{align}
a_\mu &amp; = \frac{N}{\sigma^2} + \frac{1}{\sigma^2_\mu} \\
b_\mu &amp; = \frac{ \sum_{i=1}^N y_i - x_i\beta }{\sigma^2} + \frac{\mu_\mu}{\sigma^2_\mu}
\end{align}\]</span></p>
</div>
<div id="full-conditional-distribution-for-beta" class="section level3">
<h3><span class="header-section-number">12.4.2</span> Full conditional distribution for <span class="math inline">\(\beta\)</span></h3>
<p>The marginal posterior for <span class="math inline">\(\beta\)</span> given all other parameters in the model is</p>
<p><span class="math display">\[\begin{align}
[\beta | \cdot] &amp; \propto \prod_{i=1}^N [y_i | \mu, \beta, \sigma^2 ] [\beta] \\
&amp; \propto \prod_{i=1}^N \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \left\{ -\frac{1}{2 \sigma^2}  \left(y_i - \left(\mu + x_i \beta\right)\right)^2 \right\} \frac{1}{\sqrt{2 \pi \sigma^2_\beta}}  \exp \left\{ -\frac{1}{2 \sigma_\beta^2}  \left(\beta - \mu_\beta \right)^2 \right\} \\
&amp; \propto \prod_{i=1}^N \exp \left\{ -\frac{1}{2 \sigma^2}  \left(\beta^2 x_i^2 - 2 \beta \left(x_i \left( y_i - \mu \right) \right) \right) \right\} \exp \left\{ -\frac{1}{2 \sigma_\beta^2}  \left(\beta^2 - 2 \beta \mu_\beta \right) \right\} \\
&amp; \propto \exp \left\{ -\frac{1}{2}  \left(\beta^2 \left(\frac{\sum_{i=1}^N x_i^2}{\sigma^2} + \frac{1}{\sigma^2_\beta}\right) - 2 \beta \left(\frac{ \sum_{i=1}^N x_i \left( y_i - \mu \right) }{\sigma^2} + \frac{\mu_\beta}{\sigma^2_\beta}\right)\right) \right\} 
\end{align}\]</span></p>
<p>which is a normal distribution with mean <span class="math inline">\(a_\beta^{-1}b_\beta\)</span> and variance <span class="math inline">\(a_\beta^{-1}\)</span> where</p>
<p><span class="math display">\[\begin{align}
a_\beta &amp; = \frac{\sum_{i=1}^N x_i^2}{\sigma^2} + \frac{1}{\sigma^2_\beta} \\
b_\beta &amp; = \frac{ \sum_{i=1}^N x_i \left( y_i - \mu \right) }{\sigma^2} + \frac{\mu_\beta}{\sigma^2_\beta}
\end{align}\]</span></p>
</div>
<div id="full-conditional-distribution-for-sigma2" class="section level3">
<h3><span class="header-section-number">12.4.3</span> Full conditional distribution for <span class="math inline">\(\sigma^2\)</span></h3>
<p>The marginal posterior for <span class="math inline">\(\sigma^2\)</span> given all other parameters in the model is</p>
<p><span class="math display">\[\begin{align}
[\sigma^2 | \cdot] &amp; \propto \prod_{i=1}^N [y_i | \mu, \beta, \sigma^2 ] [\sigma^2] \\
&amp; \propto \prod_{i=1}^N \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \left\{ -\frac{1}{2 \sigma^2}  \left(y_i - \left(\mu + x_i \beta\right)\right)^2 \right\} \frac{\beta_0^{\alpha_0}} {\Gamma(\alpha_0)} (\sigma^2)^{-\alpha_0 - 1} \exp\left\{ - \frac{\beta_0}{\sigma^2} \right\} \\
&amp; \propto \prod_{i=1}^N \left( \sigma^2 \right)^{-\frac{1}{2}} \exp \left\{ -\frac{1}{\sigma^2}  \frac{\left(y_i - \left(\mu + x_i \beta\right)\right)^2}{2} \right\} (\sigma^2)^{-\alpha_0 - 1} \exp\left\{ - \frac{\beta_0}{\sigma^2} \right\} \\
&amp; \propto \left( \sigma^2 \right)^{-\frac{N}{2} - \alpha_0 - 1} \exp \left\{ -\frac{1}{\sigma^2}  \left( \sum_{i=1}^N \frac{1}{2} \left( y_i - \left( \mu + x_i \beta \right) \right)^2 + \beta_0 \right) \right\} 
\end{align}\]</span></p>
<p>which is distributed as <span class="math inline">\(\operatorname{inverse-gamma} \left( \alpha_0 + \frac{N}{2} , \beta_0 + \frac{1}{2} \sum_{i=1}^N \left( y_i - \left(\mu + x_i \beta \right) \right)^2 \right)\)</span>.</p>
</div>
</div>
<div id="fitting-the-model" class="section level2">
<h2><span class="header-section-number">12.5</span> Fitting the model</h2>
<p>To estimate parameters from the regression model, we will consider the <em>iris</em> dataset and let <span class="math inline">\(y\)</span> be the <em>Petal.Width</em> variable and <span class="math inline">\(x\)</span> be the <em>Petal.Length</em> variable in <em>R</em>. The data with the fitted regression line using the <em>lm</em> function is shown below.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" data-line-number="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb229-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb229-3" data-line-number="3"><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x=</span>Petal.Length, <span class="dt">y=</span>Petal.Width)) <span class="op">+</span><span class="st"> </span><span class="kw">stat_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb229-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-113-1.png" width="1536" style="display: block; margin: auto;" /></p>
<p>To start, we setup the variables and define default values for the prior constants.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" data-line-number="1">y &lt;-<span class="st"> </span>iris<span class="op">$</span>Petal.Width</a>
<a class="sourceLine" id="cb231-2" data-line-number="2">x &lt;-<span class="st"> </span>iris<span class="op">$</span>Petal.Length</a>
<a class="sourceLine" id="cb231-3" data-line-number="3"><span class="co">## these are the prior choices. </span></a>
<a class="sourceLine" id="cb231-4" data-line-number="4"><span class="co">## We will talk later about how to choose prior distributions and values later</span></a>
<a class="sourceLine" id="cb231-5" data-line-number="5">mu_mu &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb231-6" data-line-number="6">sigma2_mu &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb231-7" data-line-number="7">mu_beta &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb231-8" data-line-number="8">sigma2_beta &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb231-9" data-line-number="9">alpha_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="fl">0.01</span></a>
<a class="sourceLine" id="cb231-10" data-line-number="10">beta_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="fl">0.01</span></a></code></pre></div>
<p>Next, we define empty vectors to store the MCMC output. We will run the MCMC sampler for <span class="math inline">\(K=5000\)</span> iterations.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1">K &lt;-<span class="st"> </span><span class="dv">5000</span></a>
<a class="sourceLine" id="cb232-2" data-line-number="2">mu &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, K)</a>
<a class="sourceLine" id="cb232-3" data-line-number="3">beta &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, K)</a>
<a class="sourceLine" id="cb232-4" data-line-number="4">sigma2 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, K)</a></code></pre></div>
<p>The MCMC algorithm works by cycling through the marginal posterior distributions. The algorithm is called a Gibbs Sampler and we sample from</p>
<p><span class="math display">\[\begin{align}
\mu | \cdot &amp; \sim N(a_\mu^{-1}b_\mu, a_\mu^{-1}) \\
\beta | \cdot &amp; \sim N(a_\beta^{-1}b_\beta, a_\beta^{-1}) \\
\sigma^2 | \cdot &amp; \sim \operatorname{inverse-gamma}\left( \alpha_0 + \frac{N}{2} , \beta_0 + \frac{1}{2} \sum_{i=1}^N \left( y_i - \left(\mu + x_i \beta \right) \right)^2 \right) 
\end{align}\]</span>
in sequential order.</p>

<p>In <em>R</em>, the Gibbs sampler is</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">101</span>)</a>
<a class="sourceLine" id="cb233-2" data-line-number="2"><span class="co">## initialize </span></a>
<a class="sourceLine" id="cb233-3" data-line-number="3">mu[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, mu_mu, <span class="kw">sqrt</span>(sigma2_mu))</a>
<a class="sourceLine" id="cb233-4" data-line-number="4">beta[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, mu_beta, <span class="kw">sqrt</span>(sigma2_beta))</a>
<a class="sourceLine" id="cb233-5" data-line-number="5"><span class="co">## note that sampling from an inverse gamma is the same as </span></a>
<a class="sourceLine" id="cb233-6" data-line-number="6"><span class="co">## the inverse of a random gamma variable</span></a>
<a class="sourceLine" id="cb233-7" data-line-number="7">sigma2[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="kw">rgamma</span>(<span class="dv">1</span>, alpha_<span class="dv">0</span>, beta_<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb233-8" data-line-number="8"></a>
<a class="sourceLine" id="cb233-9" data-line-number="9"><span class="co">## calculate the sample size</span></a>
<a class="sourceLine" id="cb233-10" data-line-number="10">N &lt;-<span class="st"> </span><span class="kw">length</span>(y)</a>
<a class="sourceLine" id="cb233-11" data-line-number="11"></a>
<a class="sourceLine" id="cb233-12" data-line-number="12"><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>K) {</a>
<a class="sourceLine" id="cb233-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb233-14" data-line-number="14">  <span class="co">## sample mu</span></a>
<a class="sourceLine" id="cb233-15" data-line-number="15">  a_mu &lt;-<span class="st"> </span>N <span class="op">/</span><span class="st"> </span>sigma2[k<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>sigma2_mu</a>
<a class="sourceLine" id="cb233-16" data-line-number="16">  b_mu &lt;-<span class="st"> </span><span class="kw">sum</span>(y <span class="op">-</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>beta[k<span class="dv">-1</span>]) <span class="op">/</span><span class="st"> </span>sigma2[k<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span>mu_mu <span class="op">/</span><span class="st"> </span>sigma2_mu</a>
<a class="sourceLine" id="cb233-17" data-line-number="17">  mu[k] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, b_mu <span class="op">/</span><span class="st"> </span>a_mu, <span class="kw">sqrt</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>a_mu))</a>
<a class="sourceLine" id="cb233-18" data-line-number="18">  </a>
<a class="sourceLine" id="cb233-19" data-line-number="19">  <span class="co">## sample beta</span></a>
<a class="sourceLine" id="cb233-20" data-line-number="20">  a_beta &lt;-<span class="st"> </span><span class="kw">sum</span>(x<span class="op">^</span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>sigma2[k<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>sigma2_beta</a>
<a class="sourceLine" id="cb233-21" data-line-number="21">  b_beta &lt;-<span class="st"> </span><span class="kw">sum</span>(x<span class="op">*</span>(y <span class="op">-</span><span class="st"> </span>mu[k])) <span class="op">/</span><span class="st"> </span>sigma2[k<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span>mu_beta <span class="op">/</span><span class="st"> </span>sigma2_beta</a>
<a class="sourceLine" id="cb233-22" data-line-number="22">  beta[k] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, b_beta <span class="op">/</span><span class="st"> </span>a_beta, <span class="kw">sqrt</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>a_beta))</a>
<a class="sourceLine" id="cb233-23" data-line-number="23">  </a>
<a class="sourceLine" id="cb233-24" data-line-number="24">  <span class="co">## sample sigma2</span></a>
<a class="sourceLine" id="cb233-25" data-line-number="25">  sigma2[k] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="kw">rgamma</span>(<span class="dv">1</span>, alpha_<span class="dv">0</span> <span class="op">+</span><span class="st"> </span>N<span class="op">/</span><span class="dv">2</span>, </a>
<a class="sourceLine" id="cb233-26" data-line-number="26">                          beta_<span class="dv">0</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>((y <span class="op">-</span><span class="st"> </span>(mu[k] <span class="op">+</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>beta[k]))<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb233-27" data-line-number="27">}</a></code></pre></div>
<p>To visualize the MCMC samples, we can plot what are called trace plots</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" data-line-number="1">samples &lt;-<span class="st"> </span><span class="kw">c</span>(mu, beta, sigma2)</a>
<a class="sourceLine" id="cb234-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb234-3" data-line-number="3">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb234-4" data-line-number="4">  <span class="dt">sample =</span> <span class="dv">1</span><span class="op">:</span>K,</a>
<a class="sourceLine" id="cb234-5" data-line-number="5">  <span class="dt">params =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;mu&quot;</span>, K), <span class="kw">rep</span>(<span class="st">&quot;beta&quot;</span>, K), <span class="kw">rep</span>(<span class="st">&quot;sigma2&quot;</span>, K))),</a>
<a class="sourceLine" id="cb234-6" data-line-number="6">  <span class="dt">values =</span> samples)</a>
<a class="sourceLine" id="cb234-7" data-line-number="7"></a>
<a class="sourceLine" id="cb234-8" data-line-number="8"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>sample, <span class="dt">y=</span>values, <span class="dt">group=</span>params)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb234-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>params, <span class="dt">scales=</span><span class="st">&quot;free&quot;</span>, <span class="dt">ncol=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-117-1.png" width="1536" style="display: block; margin: auto;" /></p>
<p>The plotting window is strongly influenced by the initial condition. Instead, we can throw away the first 1000 samples (called burn-in) and examine the remaining 4000 samples for each parameter.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" data-line-number="1">burnin &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb235-2" data-line-number="2"><span class="co">## subset the samples to only post-burnin</span></a>
<a class="sourceLine" id="cb235-3" data-line-number="3">samples &lt;-<span class="st"> </span><span class="kw">cbind</span>(mu[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>burnin)], beta[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>burnin)], sigma2[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>burnin)])</a>
<a class="sourceLine" id="cb235-4" data-line-number="4"><span class="kw">colnames</span>(samples) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;sigma2&quot;</span>)</a>
<a class="sourceLine" id="cb235-5" data-line-number="5"></a>
<a class="sourceLine" id="cb235-6" data-line-number="6">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb235-7" data-line-number="7">  <span class="dt">sample =</span> (burnin<span class="op">+</span><span class="dv">1</span>)<span class="op">:</span>K,</a>
<a class="sourceLine" id="cb235-8" data-line-number="8">  <span class="dt">params =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;mu&quot;</span>, K<span class="op">-</span>burnin), <span class="kw">rep</span>(<span class="st">&quot;beta&quot;</span>, K<span class="op">-</span>burnin),</a>
<a class="sourceLine" id="cb235-9" data-line-number="9">                    <span class="kw">rep</span>(<span class="st">&quot;sigma2&quot;</span>, K<span class="op">-</span>burnin))),</a>
<a class="sourceLine" id="cb235-10" data-line-number="10">  <span class="dt">values =</span> <span class="kw">c</span>(samples))</a>
<a class="sourceLine" id="cb235-11" data-line-number="11"></a>
<a class="sourceLine" id="cb235-12" data-line-number="12"><span class="co">## fit the linear model using the MLE</span></a>
<a class="sourceLine" id="cb235-13" data-line-number="13">fit &lt;-<span class="st"> </span><span class="kw">lm</span>(y<span class="op">~</span>x)</a>
<a class="sourceLine" id="cb235-14" data-line-number="14">df_lm &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb235-15" data-line-number="15">  <span class="dt">params =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;sigma2&quot;</span>)),</a>
<a class="sourceLine" id="cb235-16" data-line-number="16">  <span class="dt">values =</span> <span class="kw">c</span>(fit<span class="op">$</span>coefficients[<span class="dv">1</span>], fit<span class="op">$</span>coefficients[<span class="dv">2</span>], <span class="kw">summary</span>(fit)<span class="op">$</span>sigma<span class="op">^</span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb235-17" data-line-number="17">  <span class="dt">row.names =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb235-18" data-line-number="18"></a>
<a class="sourceLine" id="cb235-19" data-line-number="19"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>sample, <span class="dt">y=</span>values, <span class="dt">group=</span>params)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-20" data-line-number="20"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>params, <span class="dt">scales=</span><span class="st">&quot;free&quot;</span>, <span class="dt">ncol=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">data=</span>df_lm, <span class="kw">aes</span>(<span class="dt">yintercept=</span>values, <span class="dt">group=</span>params), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-118-1.png" width="1536" style="display: block; margin: auto;" /></p>
<p>We can think of each of the <span class="math inline">\(k\)</span> iterations as a time step and can use methods from time series to examine the estimates. For example, the ACF for each parameter is</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" data-line-number="1"><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb236-2" data-line-number="2"><span class="kw">acf</span>(samples[,<span class="st">&quot;mu&quot;</span>])</a>
<a class="sourceLine" id="cb236-3" data-line-number="3"><span class="kw">pacf</span>(samples[, <span class="st">&quot;mu&quot;</span>])</a>
<a class="sourceLine" id="cb236-4" data-line-number="4"><span class="kw">acf</span>(samples[,<span class="st">&quot;beta&quot;</span>])</a>
<a class="sourceLine" id="cb236-5" data-line-number="5"><span class="kw">pacf</span>(samples[, <span class="st">&quot;beta&quot;</span>])</a>
<a class="sourceLine" id="cb236-6" data-line-number="6"><span class="kw">acf</span>(samples[,<span class="st">&quot;sigma2&quot;</span>])</a>
<a class="sourceLine" id="cb236-7" data-line-number="7"><span class="kw">pacf</span>(samples[, <span class="st">&quot;sigma2&quot;</span>])</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-119-1.png" width="1536" style="display: block; margin: auto;" /></p>
<p>We can also ask what is the effective sample size from our estimates (the equivalent sample size of uncorrelated samples)</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" data-line-number="1"><span class="kw">library</span>(coda)</a>
<a class="sourceLine" id="cb237-2" data-line-number="2"><span class="kw">effectiveSize</span>(samples)</a></code></pre></div>
<pre><code>##     mu   beta sigma2 
##  449.7  427.7 4000.0</code></pre>
<p>Because the samples of <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(\sigma^2\)</span> obtained from the Gibbs sampler are from probability distributions, we can calculate any quantity of interest directly. For example, the estimate for the mean of the parameters is simply the mean of the MCMC samples</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" data-line-number="1"><span class="kw">colMeans</span>(samples)</a>
<a class="sourceLine" id="cb239-2" data-line-number="2"><span class="kw">apply</span>(samples, <span class="dv">2</span>, sd)</a>
<a class="sourceLine" id="cb239-3" data-line-number="3"><span class="kw">apply</span>(samples, <span class="dv">2</span>, quantile, <span class="dt">prob=</span><span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</a></code></pre></div>
<pre><code>##       mu     beta   sigma2 
## -0.36411  0.41601  0.04331 
##       mu     beta   sigma2 
## 0.040486 0.009816 0.005055 
##            mu   beta  sigma2
## 2.5%  -0.4438 0.3972 0.03459
## 97.5% -0.2859 0.4357 0.05456</code></pre>
<p>and we can compare these estimates to those from the MLE</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" data-line-number="1"><span class="kw">summary</span>(fit)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -0.565 -0.124 -0.019  0.133  0.643 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -0.36308    0.03976   -9.13  4.7e-16 ***
## x            0.41576    0.00958   43.39  &lt; 2e-16 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.206 on 148 degrees of freedom
## Multiple R-squared:  0.927,  Adjusted R-squared:  0.927 
## F-statistic: 1.88e+03 on 1 and 148 DF,  p-value: &lt;2e-16</code></pre>
<p>and the 95% credible interval for each parameter is simply the 2.5% and 97.5% quantiles of the samples.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb243-1" data-line-number="1"><span class="kw">apply</span>(samples, <span class="dv">2</span>, quantile, <span class="dt">prob=</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</a></code></pre></div>
<pre><code>##            mu   beta  sigma2
## 2.5%  -0.4438 0.3972 0.03459
## 97.5% -0.2859 0.4357 0.05456</code></pre>
<p>We can compare these to the esimates from the MLE</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb245-1" data-line-number="1"><span class="kw">confint</span>(fit)</a></code></pre></div>
<pre><code>##               2.5 %  97.5 %
## (Intercept) -0.4417 -0.2845
## x            0.3968  0.4347</code></pre>
<p>We can also plot the posterior distribution</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb247-1" data-line-number="1">n_pred &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb247-2" data-line-number="2">x_pred &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(iris<span class="op">$</span>Petal.Length), <span class="kw">max</span>(iris<span class="op">$</span>Petal.Length), <span class="dt">length.out =</span> n_pred)</a>
<a class="sourceLine" id="cb247-3" data-line-number="3">y_hat &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>n_pred, <span class="cf">function</span>(i) { samples[, <span class="st">&quot;mu&quot;</span>] <span class="op">+</span><span class="st"> </span>x_pred[i] <span class="op">*</span><span class="st"> </span>samples[, <span class="st">&quot;beta&quot;</span>] }))</a>
<a class="sourceLine" id="cb247-4" data-line-number="4"></a>
<a class="sourceLine" id="cb247-5" data-line-number="5">df_mcmc &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb247-6" data-line-number="6">  <span class="dt">x         =</span> x_pred,</a>
<a class="sourceLine" id="cb247-7" data-line-number="7">  <span class="dt">y_hat     =</span> <span class="kw">c</span>(y_hat),</a>
<a class="sourceLine" id="cb247-8" data-line-number="8">  <span class="dt">iteration =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(y_hat), <span class="dt">each =</span> <span class="kw">nrow</span>(y_hat))</a>
<a class="sourceLine" id="cb247-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb247-10" data-line-number="10"></a>
<a class="sourceLine" id="cb247-11" data-line-number="11"><span class="cf">if</span> (<span class="op">!</span><span class="kw">file.exists</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;images&quot;</span>, <span class="st">&quot;posterior-linear-regression.png&quot;</span>))) {</a>
<a class="sourceLine" id="cb247-12" data-line-number="12"></a>
<a class="sourceLine" id="cb247-13" data-line-number="13">    <span class="kw">png</span>(<span class="dt">file =</span> here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;images&quot;</span>, <span class="st">&quot;posterior-linear-regression.png&quot;</span>), </a>
<a class="sourceLine" id="cb247-14" data-line-number="14">        <span class="dt">width =</span> <span class="dv">16</span>, <span class="dt">height =</span> <span class="dv">9</span>, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>, <span class="dt">res =</span> <span class="dv">400</span>)</a>
<a class="sourceLine" id="cb247-15" data-line-number="15">    <span class="kw">print</span>(</a>
<a class="sourceLine" id="cb247-16" data-line-number="16">        <span class="kw">ggplot</span>(<span class="dt">data =</span> iris, <span class="kw">aes</span>(<span class="dt">x =</span> Petal.Length, <span class="dt">y =</span> Petal.Width)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb247-17" data-line-number="17"><span class="st">            </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb247-18" data-line-number="18"><span class="st">            </span><span class="kw">geom_line</span>(<span class="dt">data =</span> df_mcmc,</a>
<a class="sourceLine" id="cb247-19" data-line-number="19">                      <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y_hat, <span class="dt">group =</span> iteration), </a>
<a class="sourceLine" id="cb247-20" data-line-number="20">                      <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.05</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb247-21" data-line-number="21"><span class="st">            </span><span class="kw">ggtitle</span>(<span class="st">&quot;Posterior Distribution of mean response&quot;</span>)</a>
<a class="sourceLine" id="cb247-22" data-line-number="22">    )</a>
<a class="sourceLine" id="cb247-23" data-line-number="23">    <span class="kw">dev.off</span>()</a>
<a class="sourceLine" id="cb247-24" data-line-number="24">} </a></code></pre></div>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" data-line-number="1">knitr<span class="op">::</span><span class="kw">include_graphics</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;images&quot;</span>, <span class="st">&quot;posterior-linear-regression.png&quot;</span>))</a></code></pre></div>
<p><img src="images/posterior-linear-regression.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Posterior predictive distribution</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" data-line-number="1">n_pred &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb249-2" data-line-number="2">x_pred &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(iris<span class="op">$</span>Petal.Length), <span class="kw">max</span>(iris<span class="op">$</span>Petal.Length), <span class="dt">length.out =</span> n_pred)</a>
<a class="sourceLine" id="cb249-3" data-line-number="3">y_tilde &lt;-<span class="st"> </span><span class="kw">t</span>(samples[, <span class="st">&quot;mu&quot;</span>] <span class="op">+</span><span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>n_pred, <span class="cf">function</span>(i) { x_pred[i] <span class="op">*</span><span class="st"> </span>samples[, <span class="st">&quot;beta&quot;</span>] <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(samples[, <span class="st">&quot;sigma2&quot;</span>]), <span class="dv">0</span>, <span class="kw">sqrt</span>(samples[, <span class="st">&quot;sigma2&quot;</span>]))}))</a>
<a class="sourceLine" id="cb249-4" data-line-number="4"></a>
<a class="sourceLine" id="cb249-5" data-line-number="5">df_mcmc &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb249-6" data-line-number="6">  <span class="dt">x        =</span> x_pred,</a>
<a class="sourceLine" id="cb249-7" data-line-number="7">  <span class="dt">y_tilde  =</span> <span class="kw">apply</span>(y_tilde, <span class="dv">1</span>, mean),</a>
<a class="sourceLine" id="cb249-8" data-line-number="8">  <span class="dt">lower_95 =</span> <span class="kw">apply</span>(y_tilde, <span class="dv">1</span>, quantile, <span class="dt">prob =</span> <span class="fl">0.025</span>),</a>
<a class="sourceLine" id="cb249-9" data-line-number="9">  <span class="dt">upper_95 =</span> <span class="kw">apply</span>(y_tilde, <span class="dv">1</span>, quantile, <span class="dt">prob =</span> <span class="fl">0.975</span>)</a>
<a class="sourceLine" id="cb249-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb249-11" data-line-number="11"><span class="kw">ggplot</span>(<span class="dt">data =</span> iris, <span class="kw">aes</span>(<span class="dt">x =</span> Petal.Length, <span class="dt">y =</span> Petal.Width)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb249-12" data-line-number="12"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb249-13" data-line-number="13"><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">data =</span> df_mcmc, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y_tilde), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb249-14" data-line-number="14"><span class="st">    </span><span class="kw">geom_ribbon</span>(<span class="dt">data =</span> df_mcmc, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">ymin =</span> lower_<span class="dv">95</span>, <span class="dt">ymax =</span> upper_<span class="dv">95</span>),</a>
<a class="sourceLine" id="cb249-15" data-line-number="15">                <span class="dt">fill =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.25</span>, <span class="dt">inherit.aes =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb249-16" data-line-number="16"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Posterior predictive distribution&quot;</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-127-1.png" width="1536" style="display: block; margin: auto;" /></p>
<div id="general-recommendations-for-writing-mcmc-software" class="section level3">
<h3><span class="header-section-number">12.5.1</span> General recommendations for writing MCMC software</h3>
<ul>
<li>Have the first dimension of each object be the number of MCMC samples</li>
<li>Start with simple models and build sequentially to the complex model of interest
<ul>
<li>Example: For spatio-temporal models, first start with linear regression, then add spatial component, then add spatio-temporal model</li>
</ul></li>
<li>Find a workflow that works
<ol style="list-style-type: decimal">
<li>State the model</li>
<li>Calculate the full conditional distributions</li>
<li>Write the MCMC using a template</li>
</ol></li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="day-11.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="day-13.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["STAT-5413.pdf", "STAT-5413.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
