<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Day 7 | Notes for STAT 5413 - Spatial Statistics</title>
  <meta name="description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Day 7 | Notes for STAT 5413 - Spatial Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Day 7 | Notes for STAT 5413 - Spatial Statistics" />
  
  <meta name="twitter:description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  

<meta name="author" content="John Tipton" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="day-6.html"/>
<link rel="next" href="day-8.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.10/datatables.js"></script>
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.19/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.9.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.49.4/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.49.4/plotly-latest.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">STAT 5413 Spatial Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="day-1.html"><a href="day-1.html"><i class="fa fa-check"></i><b>1</b> Day 1</a><ul>
<li class="chapter" data-level="1.1" data-path="day-1.html"><a href="day-1.html#notation"><i class="fa fa-check"></i><b>1.1</b> Notation</a></li>
<li class="chapter" data-level="1.2" data-path="day-1.html"><a href="day-1.html#probability-distributions"><i class="fa fa-check"></i><b>1.2</b> Probability Distributions</a><ul>
<li class="chapter" data-level="1.2.1" data-path="day-1.html"><a href="day-1.html#example-linear-regression"><i class="fa fa-check"></i><b>1.2.1</b> Example: linear regression</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="day-1.html"><a href="day-1.html#hierarchical-modeling"><i class="fa fa-check"></i><b>1.3</b> Hierarchical modeling</a><ul>
<li class="chapter" data-level="1.3.1" data-path="day-1.html"><a href="day-1.html#bayesian-hierarchical-models-bhms"><i class="fa fa-check"></i><b>1.3.1</b> Bayesian Hierarchical models (BHMs)</a></li>
<li class="chapter" data-level="1.3.2" data-path="day-1.html"><a href="day-1.html#empirical-hierarchical-models-ehms"><i class="fa fa-check"></i><b>1.3.2</b> Empirical Hierarchical models (EHMs)</a></li>
<li class="chapter" data-level="1.3.3" data-path="day-1.html"><a href="day-1.html#data-model"><i class="fa fa-check"></i><b>1.3.3</b> Data Model</a></li>
<li class="chapter" data-level="1.3.4" data-path="day-1.html"><a href="day-1.html#process-model"><i class="fa fa-check"></i><b>1.3.4</b> Process Model</a></li>
<li class="chapter" data-level="1.3.5" data-path="day-1.html"><a href="day-1.html#parameter-prior-model-bmhs-only"><i class="fa fa-check"></i><b>1.3.5</b> Parameter (Prior) Model (BMHs only)</a></li>
<li class="chapter" data-level="1.3.6" data-path="day-1.html"><a href="day-1.html#posterior-distribution"><i class="fa fa-check"></i><b>1.3.6</b> Posterior Distribution</a></li>
<li class="chapter" data-level="1.3.7" data-path="day-1.html"><a href="day-1.html#scientifically-motivated-statistical-modeling"><i class="fa fa-check"></i><b>1.3.7</b> Scientifically Motivated Statistical Modeling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="day-2.html"><a href="day-2.html"><i class="fa fa-check"></i><b>2</b> Day 2</a><ul>
<li class="chapter" data-level="2.1" data-path="day-2.html"><a href="day-2.html#spatial-data"><i class="fa fa-check"></i><b>2.1</b> Spatial Data</a></li>
<li class="chapter" data-level="2.2" data-path="day-2.html"><a href="day-2.html#types-of-spatial-data"><i class="fa fa-check"></i><b>2.2</b> Types of spatial data</a><ul>
<li class="chapter" data-level="2.2.1" data-path="day-2.html"><a href="day-2.html#geostatistical-data"><i class="fa fa-check"></i><b>2.2.1</b> Geostatistical data</a></li>
<li class="chapter" data-level="2.2.2" data-path="day-2.html"><a href="day-2.html#areal-data"><i class="fa fa-check"></i><b>2.2.2</b> Areal data</a></li>
<li class="chapter" data-level="2.2.3" data-path="day-2.html"><a href="day-2.html#point-process-data"><i class="fa fa-check"></i><b>2.2.3</b> Point process data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="day-3.html"><a href="day-3.html"><i class="fa fa-check"></i><b>3</b> Day 3</a><ul>
<li class="chapter" data-level="3.1" data-path="day-3.html"><a href="day-3.html#anouncements"><i class="fa fa-check"></i><b>3.1</b> Anouncements</a></li>
<li class="chapter" data-level="3.2" data-path="day-3.html"><a href="day-3.html#files-for-spatial-data"><i class="fa fa-check"></i><b>3.2</b> Files for spatial data</a></li>
<li class="chapter" data-level="3.3" data-path="day-3.html"><a href="day-3.html#textbook-package"><i class="fa fa-check"></i><b>3.3</b> Textbook package</a></li>
<li class="chapter" data-level="3.4" data-path="day-3.html"><a href="day-3.html#spatial-visualization"><i class="fa fa-check"></i><b>3.4</b> Spatial Visualization</a><ul>
<li class="chapter" data-level="3.4.1" data-path="day-3.html"><a href="day-3.html#spatial-visualization-using-fields"><i class="fa fa-check"></i><b>3.4.1</b> Spatial visualization using <em>fields</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="day-4.html"><a href="day-4.html"><i class="fa fa-check"></i><b>4</b> Day 4</a><ul>
<li class="chapter" data-level="4.1" data-path="day-4.html"><a href="day-4.html#announcements"><i class="fa fa-check"></i><b>4.1</b> Announcements</a></li>
<li class="chapter" data-level="4.2" data-path="day-4.html"><a href="day-4.html#visualization-continued"><i class="fa fa-check"></i><b>4.2</b> Visualization (continued)</a><ul>
<li class="chapter" data-level="4.2.1" data-path="day-4.html"><a href="day-4.html#spatial-visualization-using-fields-1"><i class="fa fa-check"></i><b>4.2.1</b> Spatial visualization using <em>fields</em></a></li>
<li class="chapter" data-level="4.2.2" data-path="day-4.html"><a href="day-4.html#in-class-activity"><i class="fa fa-check"></i><b>4.2.2</b> In Class Activity:</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="day-4.html"><a href="day-4.html#interactive-visualization-interactive-with-html-format-only"><i class="fa fa-check"></i><b>4.3</b> Interactive visualization (Interactive with HTML format only)</a><ul>
<li class="chapter" data-level="4.3.1" data-path="day-4.html"><a href="day-4.html#interactive-display-of-data"><i class="fa fa-check"></i><b>4.3.1</b> Interactive display of data</a></li>
<li class="chapter" data-level="4.3.2" data-path="day-4.html"><a href="day-4.html#animations"><i class="fa fa-check"></i><b>4.3.2</b> Animations</a></li>
<li class="chapter" data-level="4.3.3" data-path="day-4.html"><a href="day-4.html#interactive-plotting-using-plotly"><i class="fa fa-check"></i><b>4.3.3</b> Interactive plotting using <em>plotly</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="day-5.html"><a href="day-5.html"><i class="fa fa-check"></i><b>5</b> Day 5</a><ul>
<li class="chapter" data-level="5.1" data-path="day-5.html"><a href="day-5.html#announcements-1"><i class="fa fa-check"></i><b>5.1</b> Announcements</a></li>
<li class="chapter" data-level="5.2" data-path="day-5.html"><a href="day-5.html#spatial-means-and-covariances"><i class="fa fa-check"></i><b>5.2</b> Spatial means and covariances</a><ul>
<li class="chapter" data-level="5.2.1" data-path="day-5.html"><a href="day-5.html#gaussian-processes"><i class="fa fa-check"></i><b>5.2.1</b> Gaussian processes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="day-6.html"><a href="day-6.html"><i class="fa fa-check"></i><b>6</b> Day 6</a><ul>
<li class="chapter" data-level="6.1" data-path="day-6.html"><a href="day-6.html#announcements-2"><i class="fa fa-check"></i><b>6.1</b> Announcements</a></li>
<li class="chapter" data-level="6.2" data-path="day-6.html"><a href="day-6.html#gaussian-process-assumptions"><i class="fa fa-check"></i><b>6.2</b> Gaussian process assumptions</a></li>
<li class="chapter" data-level="6.3" data-path="day-6.html"><a href="day-6.html#recall-hierachical-modeling"><i class="fa fa-check"></i><b>6.3</b> Recall Hierachical modeling</a><ul>
<li class="chapter" data-level="6.3.1" data-path="day-6.html"><a href="day-6.html#data-model-1"><i class="fa fa-check"></i><b>6.3.1</b> Data Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="day-7.html"><a href="day-7.html"><i class="fa fa-check"></i><b>7</b> Day 7</a><ul>
<li class="chapter" data-level="7.1" data-path="day-7.html"><a href="day-7.html#common-isotropic-correlation-functions"><i class="fa fa-check"></i><b>7.1</b> Common isotropic correlation functions</a></li>
<li class="chapter" data-level="7.2" data-path="day-7.html"><a href="day-7.html#covariograms-and-semivariograms"><i class="fa fa-check"></i><b>7.2</b> Covariograms and semivariograms</a><ul>
<li class="chapter" data-level="7.2.1" data-path="day-7.html"><a href="day-7.html#semivariograms-and-variograms"><i class="fa fa-check"></i><b>7.2.1</b> Semivariograms and variograms</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="day-7.html"><a href="day-7.html#estimation-of-the-spatial-process"><i class="fa fa-check"></i><b>7.3</b> Estimation of the spatial process</a><ul>
<li class="chapter" data-level="7.3.1" data-path="day-7.html"><a href="day-7.html#estimation-of-the-spatial-process-using-variograms"><i class="fa fa-check"></i><b>7.3.1</b> Estimation of the spatial process using variograms</a></li>
<li class="chapter" data-level="7.3.2" data-path="day-7.html"><a href="day-7.html#maximum-likelihood"><i class="fa fa-check"></i><b>7.3.2</b> Maximum Likelihood</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="day-7.html"><a href="day-7.html#maximum-likelihood-1"><i class="fa fa-check"></i><b>7.4</b> Maximum likelihood</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="day-8.html"><a href="day-8.html"><i class="fa fa-check"></i><b>8</b> Day 8</a><ul>
<li class="chapter" data-level="8.1" data-path="day-8.html"><a href="day-8.html#announcements-3"><i class="fa fa-check"></i><b>8.1</b> Announcements</a></li>
<li class="chapter" data-level="8.2" data-path="day-8.html"><a href="day-8.html#asymptotic-properties-of-the-mle"><i class="fa fa-check"></i><b>8.2</b> Asymptotic properties of the MLE</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="day-9.html"><a href="day-9.html"><i class="fa fa-check"></i><b>9</b> Day 9</a><ul>
<li class="chapter" data-level="9.1" data-path="day-9.html"><a href="day-9.html#announcements-4"><i class="fa fa-check"></i><b>9.1</b> Announcements</a></li>
<li class="chapter" data-level="9.2" data-path="day-9.html"><a href="day-9.html#asymptotic-properties-of-the-mle-1"><i class="fa fa-check"></i><b>9.2</b> Asymptotic properties of the MLE</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="day-10.html"><a href="day-10.html"><i class="fa fa-check"></i><b>10</b> Day 10</a></li>
<li class="chapter" data-level="11" data-path="day-11.html"><a href="day-11.html"><i class="fa fa-check"></i><b>11</b> Day 11</a></li>
<li class="chapter" data-level="12" data-path="day-12.html"><a href="day-12.html"><i class="fa fa-check"></i><b>12</b> Day 12</a></li>
<li class="chapter" data-level="13" data-path="day-13.html"><a href="day-13.html"><i class="fa fa-check"></i><b>13</b> Day 13</a></li>
<li class="chapter" data-level="14" data-path="day-14.html"><a href="day-14.html"><i class="fa fa-check"></i><b>14</b> Day 14</a></li>
<li class="chapter" data-level="15" data-path="day-15.html"><a href="day-15.html"><i class="fa fa-check"></i><b>15</b> Day 15</a></li>
<li class="chapter" data-level="16" data-path="day-16.html"><a href="day-16.html"><i class="fa fa-check"></i><b>16</b> Day 16</a></li>
<li class="chapter" data-level="17" data-path="day-17.html"><a href="day-17.html"><i class="fa fa-check"></i><b>17</b> Day 17</a></li>
<li class="chapter" data-level="18" data-path="day-18.html"><a href="day-18.html"><i class="fa fa-check"></i><b>18</b> Day 18</a></li>
<li class="chapter" data-level="19" data-path="day-19.html"><a href="day-19.html"><i class="fa fa-check"></i><b>19</b> Day 19</a></li>
<li class="chapter" data-level="20" data-path="day-20.html"><a href="day-20.html"><i class="fa fa-check"></i><b>20</b> Day 20</a></li>
<li class="chapter" data-level="21" data-path="day-21.html"><a href="day-21.html"><i class="fa fa-check"></i><b>21</b> Day 21</a></li>
<li class="chapter" data-level="22" data-path="day-22.html"><a href="day-22.html"><i class="fa fa-check"></i><b>22</b> Day 22</a></li>
<li class="chapter" data-level="23" data-path="day-23.html"><a href="day-23.html"><i class="fa fa-check"></i><b>23</b> Day 23</a></li>
<li class="chapter" data-level="24" data-path="day-24.html"><a href="day-24.html"><i class="fa fa-check"></i><b>24</b> Day 24</a></li>
<li class="chapter" data-level="25" data-path="day-25.html"><a href="day-25.html"><i class="fa fa-check"></i><b>25</b> Day 25</a></li>
<li class="chapter" data-level="26" data-path="day-26.html"><a href="day-26.html"><i class="fa fa-check"></i><b>26</b> Day 26</a></li>
<li class="chapter" data-level="27" data-path="day-27.html"><a href="day-27.html"><i class="fa fa-check"></i><b>27</b> Day 27</a></li>
<li class="chapter" data-level="28" data-path="day-28.html"><a href="day-28.html"><i class="fa fa-check"></i><b>28</b> Day 28</a></li>
<li class="chapter" data-level="29" data-path="day-29.html"><a href="day-29.html"><i class="fa fa-check"></i><b>29</b> Day 29</a></li>
<li class="chapter" data-level="30" data-path="day-30.html"><a href="day-30.html"><i class="fa fa-check"></i><b>30</b> Day 30</a></li>
<li class="chapter" data-level="31" data-path="day-31.html"><a href="day-31.html"><i class="fa fa-check"></i><b>31</b> Day 31</a></li>
<li class="chapter" data-level="32" data-path="day-32.html"><a href="day-32.html"><i class="fa fa-check"></i><b>32</b> Day 32</a></li>
<li class="chapter" data-level="33" data-path="day-33.html"><a href="day-33.html"><i class="fa fa-check"></i><b>33</b> Day 33</a></li>
<li class="chapter" data-level="34" data-path="day-34.html"><a href="day-34.html"><i class="fa fa-check"></i><b>34</b> Day 34</a></li>
<li class="chapter" data-level="35" data-path="day-35.html"><a href="day-35.html"><i class="fa fa-check"></i><b>35</b> Day 35</a></li>
<li class="chapter" data-level="36" data-path="day-36.html"><a href="day-36.html"><i class="fa fa-check"></i><b>36</b> Day 36</a></li>
<li class="chapter" data-level="37" data-path="day-37.html"><a href="day-37.html"><i class="fa fa-check"></i><b>37</b> Day 37</a></li>
<li class="chapter" data-level="38" data-path="day-38.html"><a href="day-38.html"><i class="fa fa-check"></i><b>38</b> Day 38</a></li>
<li class="chapter" data-level="39" data-path="day-39.html"><a href="day-39.html"><i class="fa fa-check"></i><b>39</b> Day 39</a></li>
<li class="chapter" data-level="40" data-path="day-40.html"><a href="day-40.html"><i class="fa fa-check"></i><b>40</b> Day 40</a></li>
<li class="chapter" data-level="41" data-path="day-41.html"><a href="day-41.html"><i class="fa fa-check"></i><b>41</b> Day 41</a></li>
<li class="chapter" data-level="42" data-path="day-42.html"><a href="day-42.html"><i class="fa fa-check"></i><b>42</b> Day 42</a></li>
<li class="chapter" data-level="43" data-path="day-43.html"><a href="day-43.html"><i class="fa fa-check"></i><b>43</b> Day 43</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes for STAT 5413 - Spatial Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="day-7" class="section level1">
<h1><span class="header-section-number">7</span> Day 7</h1>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb121-2" data-line-number="2"><span class="kw">library</span>(fields)</a>
<a class="sourceLine" id="cb121-3" data-line-number="3"><span class="kw">library</span>(mvnfast)</a>
<a class="sourceLine" id="cb121-4" data-line-number="4"><span class="kw">library</span>(gstat)</a>
<a class="sourceLine" id="cb121-5" data-line-number="5"><span class="kw">library</span>(sp)</a>
<a class="sourceLine" id="cb121-6" data-line-number="6"><span class="kw">library</span>(MCMCpack)</a></code></pre></div>
<div id="common-isotropic-correlation-functions" class="section level2">
<h2><span class="header-section-number">7.1</span> Common isotropic correlation functions</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Tobler%27s_first_law_of_geography">Tobler’s law of geography</a>
<ul>
<li>“Everything is related to everything else, but near things are more related than distant things”</li>
<li>These functions follow Tobler’s law in that the function decays with distance</li>
<li>These functions are proven to be symmetric and positive definite, thus are valid correlation functions</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1"><span class="co">## make a function to plot the correlation functions</span></a>
<a class="sourceLine" id="cb122-2" data-line-number="2">plot_corr_function &lt;-<span class="st"> </span><span class="cf">function</span>(corr_fun, <span class="co">## notice that this input is a function</span></a>
<a class="sourceLine" id="cb122-3" data-line-number="3">                               <span class="dt">d =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">length.out =</span> <span class="dv">1000</span>),</a>
<a class="sourceLine" id="cb122-4" data-line-number="4">                               <span class="dt">phi =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb122-5" data-line-number="5">                               <span class="dt">title =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb122-6" data-line-number="6">                               ...) {</a>
<a class="sourceLine" id="cb122-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb122-8" data-line-number="8">    C_h &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="kw">length</span>(d), <span class="kw">length</span>(phi))</a>
<a class="sourceLine" id="cb122-9" data-line-number="9">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(phi)) {</a>
<a class="sourceLine" id="cb122-10" data-line-number="10">        C_h[, i] &lt;-<span class="st"> </span><span class="kw">corr_fun</span>(d, phi[i], ...)</a>
<a class="sourceLine" id="cb122-11" data-line-number="11">    }</a>
<a class="sourceLine" id="cb122-12" data-line-number="12">    </a>
<a class="sourceLine" id="cb122-13" data-line-number="13">    <span class="kw">print</span>(</a>
<a class="sourceLine" id="cb122-14" data-line-number="14">        <span class="kw">data.frame</span>(<span class="dt">d =</span> d, <span class="dt">C_h =</span> <span class="kw">c</span>(C_h), <span class="dt">phi =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(phi, <span class="dt">each =</span> <span class="kw">length</span>(d)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb122-15" data-line-number="15"><span class="st">            </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> d, <span class="dt">y =</span> C_h, <span class="dt">group =</span> phi, <span class="dt">color =</span> phi)) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-16" data-line-number="16"><span class="st">            </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb122-17" data-line-number="17"><span class="st">            </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-18" data-line-number="18"><span class="st">            </span><span class="kw">ggtitle</span>(title)</a>
<a class="sourceLine" id="cb122-19" data-line-number="19">    )</a>
<a class="sourceLine" id="cb122-20" data-line-number="20">}</a></code></pre></div>
<div id="exponential-correlation-function" class="section level4">
<h4><span class="header-section-number">7.1.0.1</span> Exponential correlation function</h4>
<p><span class="math display">\[\begin{align*}
C(d) &amp; = e^{- \frac{d}{\phi} }
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\phi\)</span> is the <strong>spatial range</strong> parameter (called the <strong>length-scale</strong> in Gaussian process literature). Note that this function is <strong>not differentiable</strong> at 0.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1">exponential_cor &lt;-<span class="st"> </span><span class="cf">function</span> (d, phi, ...) {</a>
<a class="sourceLine" id="cb123-2" data-line-number="2">    <span class="kw">return</span>(<span class="kw">exp</span>( <span class="op">-</span><span class="st"> </span>d <span class="op">/</span><span class="st"> </span>phi))</a>
<a class="sourceLine" id="cb123-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb123-4" data-line-number="4"></a>
<a class="sourceLine" id="cb123-5" data-line-number="5"><span class="kw">plot_corr_function</span>(exponential_cor, <span class="dt">title =</span> <span class="st">&quot;Exponential correlation function&quot;</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<p>Sometimes this is parameterized using the inverse spatial range <span class="math inline">\(\theta = \frac{1}{\phi}\)</span></p>
<p><span class="math display">\[\begin{align*}
C(d) &amp; = e^{- d\theta}
\end{align*}\]</span></p>
</div>
<div id="squared-exponential-gaussian-correlation-functions" class="section level4">
<h4><span class="header-section-number">7.1.0.2</span> Squared exponential (Gaussian) correlation functions</h4>
<p><span class="math display">\[\begin{align*}
C(d) &amp; = e^{- (\frac{d}{\phi})^2 }
\end{align*}\]</span></p>
<p>Notice that this function <strong>is differentiable</strong> at 0.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1">gaussian_cor &lt;-<span class="st"> </span><span class="cf">function</span> (d, phi, ...) {</a>
<a class="sourceLine" id="cb124-2" data-line-number="2">    <span class="kw">return</span>(<span class="kw">exp</span>( <span class="op">-</span><span class="st"> </span>(d <span class="op">/</span><span class="st"> </span>phi)<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb124-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb124-4" data-line-number="4"></a>
<a class="sourceLine" id="cb124-5" data-line-number="5"><span class="kw">plot_corr_function</span>(gaussian_cor, </a>
<a class="sourceLine" id="cb124-6" data-line-number="6">                   <span class="dt">title =</span> <span class="st">&quot;Gaussian (squared exponential) correlation function&quot;</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
</div>
<div id="powered-exponential-correlation-functions" class="section level4">
<h4><span class="header-section-number">7.1.0.3</span> Powered exponential correlation functions</h4>
<p><span class="math display">\[\begin{align*}
C(d) &amp; = e^{- (\frac{d}{\phi})^k }
\end{align*}\]</span></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">powered_exp_cor &lt;-<span class="st"> </span><span class="cf">function</span> (d, phi, k, ...) {</a>
<a class="sourceLine" id="cb125-2" data-line-number="2">    <span class="kw">return</span>(<span class="kw">exp</span>( <span class="op">-</span><span class="st"> </span>(d <span class="op">/</span><span class="st"> </span>phi)<span class="op">^</span>k))</a>
<a class="sourceLine" id="cb125-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb125-4" data-line-number="4"></a>
<a class="sourceLine" id="cb125-5" data-line-number="5"><span class="kw">plot_corr_function</span>(powered_exp_cor, <span class="dt">k =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb125-6" data-line-number="6">                   <span class="dt">title =</span> <span class="st">&quot;Powered exponential correlation function, k = 1&quot;</span>)</a>
<a class="sourceLine" id="cb125-7" data-line-number="7"><span class="kw">plot_corr_function</span>(powered_exp_cor, <span class="dt">k =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb125-8" data-line-number="8">                   <span class="dt">title =</span> <span class="st">&quot;Powered exponential correlation function, k = 2&quot;</span>)</a>
<a class="sourceLine" id="cb125-9" data-line-number="9"><span class="kw">plot_corr_function</span>(powered_exp_cor, <span class="dt">k =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb125-10" data-line-number="10">                   <span class="dt">title =</span> <span class="st">&quot;Powered exponential correlation function, k = 3&quot;</span>)</a>
<a class="sourceLine" id="cb125-11" data-line-number="11"><span class="kw">plot_corr_function</span>(powered_exp_cor, <span class="dt">k =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb125-12" data-line-number="12">                   <span class="dt">title =</span> <span class="st">&quot;Powered exponential correlation function, k = 4&quot;</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-64-1.png" width="24%" /><img src="STAT-5413_files/figure-html/unnamed-chunk-64-2.png" width="24%" /><img src="STAT-5413_files/figure-html/unnamed-chunk-64-3.png" width="24%" /><img src="STAT-5413_files/figure-html/unnamed-chunk-64-4.png" width="24%" /></p>
<p>For future classes (basis representations) <a href="https://distill.pub/2019/visual-exploration-gaussian-processes/">Visual exploration of Gaussian Processes</a></p>
</div>
<div id="matern-correlation-functions" class="section level4">
<h4><span class="header-section-number">7.1.0.4</span> Matern correlation functions</h4>
<p><span class="math display">\[\begin{align*}
C(d) &amp; = \frac{2^{1 - \nu}}{\Gamma(\nu)} \left( \sqrt{2 \nu} \frac{d}{\phi} \right)^\nu K_\nu \left( \sqrt{2 \nu} \frac{d}{\phi} \right)
\end{align*}\]</span></p>
<ul>
<li><span class="math inline">\(\Gamma(\cdot)\)</span> is the gamma function</li>
<li><span class="math inline">\(K_\nu(\cdot)\)</span> is the modified Bessel function of the second kind</li>
<li><span class="math inline">\(\phi\)</span> is the range parameter</li>
<li><span class="math inline">\(\nu\)</span> is the smoothness parameter</li>
</ul>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="co">## Use the Matern fucnction from the fields library</span></a>
<a class="sourceLine" id="cb126-2" data-line-number="2"><span class="kw">plot_corr_function</span>(Matern, <span class="dt">range =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="dt">smoothness =</span> <span class="fl">0.15</span>, </a>
<a class="sourceLine" id="cb126-3" data-line-number="3">                   <span class="dt">title =</span> <span class="st">&quot;Matern correlation function, smoothness = 0.15&quot;</span>)</a>
<a class="sourceLine" id="cb126-4" data-line-number="4"><span class="kw">plot_corr_function</span>(Matern, <span class="dt">range =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="dt">smoothness =</span> <span class="fl">0.5</span>, </a>
<a class="sourceLine" id="cb126-5" data-line-number="5">                   <span class="dt">title =</span> <span class="st">&quot;Matern correlation function, smoothness = 0.5&quot;</span>)</a>
<a class="sourceLine" id="cb126-6" data-line-number="6"><span class="kw">plot_corr_function</span>(Matern, <span class="dt">range =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="dt">smoothness =</span> <span class="dv">5</span>, </a>
<a class="sourceLine" id="cb126-7" data-line-number="7">                   <span class="dt">title =</span> <span class="st">&quot;Matern correlation function, smoothness = 5&quot;</span>)</a>
<a class="sourceLine" id="cb126-8" data-line-number="8"><span class="kw">plot_corr_function</span>(Matern, <span class="dt">range =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="dt">smoothness =</span> <span class="dv">50</span>, </a>
<a class="sourceLine" id="cb126-9" data-line-number="9">                   <span class="dt">title =</span> <span class="st">&quot;Matern correlation function, smoothness = 50&quot;</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-65-1.png" width="24%" /><img src="STAT-5413_files/figure-html/unnamed-chunk-65-2.png" width="24%" /><img src="STAT-5413_files/figure-html/unnamed-chunk-65-3.png" width="24%" /><img src="STAT-5413_files/figure-html/unnamed-chunk-65-4.png" width="24%" /></p>
<ul>
<li>Special Cases</li>
</ul>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(\nu = \frac{1}{2} \Rightarrow C(d) = e^{- \frac{d}{\phi} }\)</span> is the exponential correlation function</li>
<li><span class="math inline">\(\nu = \frac{3}{2} \Rightarrow C(d) = \left(1 - \frac{\sqrt{3}d}{\phi} \right) e^{- \frac{\sqrt{3}d}{\phi} }\)</span></li>
<li><span class="math inline">\(\nu = \frac{5}{2} \Rightarrow C(d) = \left(1 - \frac{\sqrt{5}d}{\phi} + \frac{5 d^2}{3 \phi^2} \right) e^{- \frac{\sqrt{5}d}{\phi} }\)</span></li>
<li><span class="math inline">\(\nu \rightarrow \infty \Rightarrow C(d) = e^{- \frac{1}{2} \left( \frac{d}{\phi} \right)^2 }\)</span> is the Gaussian correlation function</li>
</ol>
<ul>
<li><p>Note: these functions are valid in <span class="math inline">\(\mathcal{R}^2\)</span>. There are generalizations of the functions to other geometries (spheres, stream networks, etc.) and higher dimensions (<span class="math inline">\(\mathcal{R}^d\)</span>).</p></li>
<li><p>The Gaussian process with a Matern correlation function with parameter <span class="math inline">\(\nu\)</span> is <span class="math inline">\(\lceil \nu \rceil\)</span>-1 times differentiable in the mean-square sense</p></li>
</ul>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">d &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">length =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb127-2" data-line-number="2">nu &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dv">3</span><span class="op">/</span><span class="dv">2</span>, <span class="dv">5</span><span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb127-3" data-line-number="3">C_h &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb127-4" data-line-number="4">    <span class="kw">Matern</span>(d, <span class="dt">range =</span> <span class="dv">1</span>, <span class="dt">nu =</span> nu[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb127-5" data-line-number="5">    <span class="kw">Matern</span>(d, <span class="dt">range =</span> <span class="dv">1</span>, <span class="dt">nu =</span> nu[<span class="dv">2</span>]),</a>
<a class="sourceLine" id="cb127-6" data-line-number="6">    <span class="kw">Matern</span>(d, <span class="dt">range =</span> <span class="dv">1</span>, <span class="dt">nu =</span> nu[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb127-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb127-8" data-line-number="8">dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb127-9" data-line-number="9">    <span class="dt">d =</span> d, </a>
<a class="sourceLine" id="cb127-10" data-line-number="10">    <span class="dt">C_h =</span> C_h,</a>
<a class="sourceLine" id="cb127-11" data-line-number="11">    <span class="dt">nu =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(nu, <span class="dt">each =</span> <span class="kw">length</span>(d)))</a>
<a class="sourceLine" id="cb127-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb127-13" data-line-number="13"><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> d, <span class="dt">y =</span> C_h, <span class="dt">group =</span> nu, <span class="dt">color =</span> nu)) <span class="op">+</span></a>
<a class="sourceLine" id="cb127-14" data-line-number="14"><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb127-15" data-line-number="15"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Matern correlation functions&quot;</span>)</a>
<a class="sourceLine" id="cb127-16" data-line-number="16"></a>
<a class="sourceLine" id="cb127-17" data-line-number="17"><span class="co">## simulate some Gaussian processes</span></a>
<a class="sourceLine" id="cb127-18" data-line-number="18">dat<span class="op">$</span>y &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb127-19" data-line-number="19">    <span class="kw">rmvn</span>(</a>
<a class="sourceLine" id="cb127-20" data-line-number="20">        <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb127-21" data-line-number="21">        <span class="dt">mu    =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">1000</span>), </a>
<a class="sourceLine" id="cb127-22" data-line-number="22">        <span class="dt">sigma =</span> <span class="kw">Matern</span>(<span class="kw">rdist</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">length =</span> <span class="dv">1000</span>)), <span class="dt">range =</span> <span class="dv">1</span>, <span class="dt">nu =</span> nu[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb127-23" data-line-number="23">    ),</a>
<a class="sourceLine" id="cb127-24" data-line-number="24">    <span class="kw">rmvn</span>(</a>
<a class="sourceLine" id="cb127-25" data-line-number="25">        <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb127-26" data-line-number="26">        <span class="dt">mu    =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">1000</span>), </a>
<a class="sourceLine" id="cb127-27" data-line-number="27">        <span class="dt">sigma =</span> <span class="kw">Matern</span>(<span class="kw">rdist</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">length =</span> <span class="dv">1000</span>)), <span class="dt">range =</span> <span class="dv">1</span>, <span class="dt">nu =</span> nu[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb127-28" data-line-number="28">        ),</a>
<a class="sourceLine" id="cb127-29" data-line-number="29">    <span class="kw">rmvn</span>(</a>
<a class="sourceLine" id="cb127-30" data-line-number="30">        <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb127-31" data-line-number="31">        <span class="dt">mu    =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">1000</span>), </a>
<a class="sourceLine" id="cb127-32" data-line-number="32">        <span class="dt">sigma =</span> <span class="kw">Matern</span>(<span class="kw">rdist</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">length =</span> <span class="dv">1000</span>)), <span class="dt">range =</span> <span class="dv">1</span>, <span class="dt">nu =</span> nu[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb127-33" data-line-number="33">    )</a>
<a class="sourceLine" id="cb127-34" data-line-number="34">)</a>
<a class="sourceLine" id="cb127-35" data-line-number="35"><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> d, <span class="dt">y =</span> y, <span class="dt">group =</span> nu, <span class="dt">color =</span> nu)) <span class="op">+</span></a>
<a class="sourceLine" id="cb127-36" data-line-number="36"><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb127-37" data-line-number="37"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Gaussian process realizations&quot;</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-66-1.png" width="49%" /><img src="STAT-5413_files/figure-html/unnamed-chunk-66-2.png" width="49%" /></p>
</div>
</div>
<div id="covariograms-and-semivariograms" class="section level2">
<h2><span class="header-section-number">7.2</span> Covariograms and semivariograms</h2>
<ul>
<li>How do we choose a covariance function?</li>
<li>How do we fit a covariance function?</li>
<li>How do we check for <em>isotropy</em>?</li>
</ul>
<div id="semivariograms-and-variograms" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Semivariograms and variograms</h3>
<ul>
<li>The semivariogram is defined</li>
</ul>
<p><span class="math display">\[\begin{align*}
\gamma(\mathbf{s}_i, \mathbf{s}_j) &amp; \equiv \frac{1}{2} Var(y(\mathbf{s}_i) - y(\mathbf{s}_j)) \\
&amp; E\left( \left( \left( y(\mathbf{s}_i) - \mu(\mathbf{s}_i) \right) - \left( y(\mathbf{s}_j) - \mu(\mathbf{s}_j) \right) \right)^2 \right)
\end{align*}\]</span></p>
<p>If the covaraince is stationary this can be written as a function of directional spatial lags <span class="math inline">\(\mathbf{h}_{ij} = \mathbf{s}_i - \mathbf{s}_j\)</span> (e.g., <span class="math inline">\(\mathbf{h}_{ij}\)</span> is not required to equal <span class="math inline">\(\mathbf{h}_{ji}\)</span>).</p>
<p><span class="math display">\[\begin{align*}
\gamma(\mathbf{h}) &amp; \equiv \frac{1}{2} Var(y(\mathbf{s} + \mathbf{h}) - y(\mathbf{s})) \\
&amp; = \frac{1}{2} E\left( \left( \left( y(\mathbf{s} + \mathbf{h}) - \mu(\mathbf{s} + \mathbf{h}) \right) - \left( y(\mathbf{s}) - \mu(\mathbf{s}) \right) \right)^2 \right) \\
&amp; \frac{1}{2} E\left( \left( y(\mathbf{s} + \mathbf{h}) - \mu(\mathbf{s} + \mathbf{h}) \right)^2 \right) - 
E\left( \left( y(\mathbf{s} + \mathbf{h}) - \mu(\mathbf{s} + \mathbf{h}) \right) \left( y(\mathbf{s}) - \mu(\mathbf{s}) \right) \right) +
\frac{1}{2} E\left( \left( y(\mathbf{s}) - \mu(\mathbf{s}) \right) \right) \\
&amp; = C(\mathbf{0}) - C(\mathbf{h})
\end{align*}\]</span></p>
<p>This implies
<span class="math display">\[\begin{align*}
\gamma(\mathbf{h}) &amp; = C(\mathbf{0}) - C(\mathbf{h}) \\
&amp; \mbox{or} \\
C(\mathbf{h}) &amp; = C(\mathbf{0}) - \gamma(\mathbf{h}) 
\end{align*}\]</span></p>
<ul>
<li>The <strong>variogram</strong> is defined as <span class="math inline">\(2 \gamma(\mathbf{h})\)</span>.</li>
</ul>
<div id="properties-of-variograms" class="section level4">
<h4><span class="header-section-number">7.2.1.1</span> Properties of variograms</h4>
<ul>
<li><span class="math inline">\(\gamma(\mathbf{s}_i, \mathbf{s}_j) \geq 0\)</span> because it is the expectation of a square</li>
<li><span class="math inline">\(\gamma(\mathbf{s}_i, \mathbf{s}_i) = \gamma_i(0) = 0\)</span> because <span class="math inline">\(y(\mathbf{s}_1) - y(\mathbf{s}_1) = 0\)</span></li>
</ul>
<p><strong>insert theoretical variogram plot from class here that shows the curve, nugget, sill, and range</strong></p>
</div>
<div id="estimation-of-variograms" class="section level4">
<h4><span class="header-section-number">7.2.1.2</span> Estimation of variograms</h4>
<ul>
<li>It is difficult to estimate the variogram as there is no replication across space – need to pool information across space.</li>
</ul>
</div>
<div id="non-directional-variograms" class="section level4">
<h4><span class="header-section-number">7.2.1.3</span> Non-directional variograms</h4>
<p>Using the <em>meuse</em> dataset of heavy metal concntrations in the topsoil near the Meuse river near Stein, NL, we can explore the concentration of zinc (log-scale).</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;meuse&quot;</span>)</a>
<a class="sourceLine" id="cb128-2" data-line-number="2"><span class="kw">data</span>(<span class="st">&quot;meuse.grid&quot;</span>)</a>
<a class="sourceLine" id="cb128-3" data-line-number="3"><span class="kw">coordinates</span>(meuse) =<span class="st"> </span><span class="er">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb128-4" data-line-number="4"><span class="kw">bubble</span>(meuse, <span class="st">&quot;zinc&quot;</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-67-1.png" width="50%" /></p>
<p>Let’s explore the correlation in the data with respect to the log(zinc) variable</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">vg &lt;-<span class="st"> </span><span class="kw">variogram</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> meuse)</a>
<a class="sourceLine" id="cb129-2" data-line-number="2">fit_vg &lt;-<span class="st"> </span><span class="kw">fit.variogram</span>(vg, <span class="dt">model =</span> <span class="kw">vgm</span>(<span class="dv">1</span>, <span class="st">&quot;Exp&quot;</span>))</a>
<a class="sourceLine" id="cb129-3" data-line-number="3"><span class="kw">plot</span>(vg, fit_vg, <span class="dt">as.table =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
</div>
<div id="checking-for-anisotropy-directional-variograms" class="section level4">
<h4><span class="header-section-number">7.2.1.4</span> Checking for anisotropy – Directional variograms</h4>
<p>Let’s explore the directional correlation in the data with respect to the log(zinc) variable</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1">dir_variogram &lt;-<span class="st"> </span><span class="kw">variogram</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> meuse, <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">45</span>, <span class="dv">90</span>, <span class="dv">135</span>))</a>
<a class="sourceLine" id="cb130-2" data-line-number="2">fit_variogram &lt;-<span class="st"> </span><span class="kw">fit.variogram</span>(dir_variogram, <span class="dt">model =</span> <span class="kw">vgm</span>(<span class="dv">1</span>, <span class="st">&quot;Exp&quot;</span>))</a>
<a class="sourceLine" id="cb130-3" data-line-number="3"><span class="kw">plot</span>(dir_variogram, fit_variogram, <span class="dt">as.table =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<p>You can explore this variogram as a map</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1">map_variogram &lt;-<span class="st"> </span><span class="kw">variogram</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> meuse,</a>
<a class="sourceLine" id="cb131-2" data-line-number="2">                           <span class="dt">cutoff =</span> <span class="dv">1500</span>, <span class="dt">width =</span> <span class="dv">100</span>, <span class="dt">map =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb131-3" data-line-number="3"><span class="kw">plot</span>(map_variogram, <span class="dt">threshold =</span> <span class="dv">5</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<p>which appears to show some patterns in the variogram maps suggesting anisotropy. Perhaps there is a covariate that can explain this. Let’s use the square-root distance to the river</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1"><span class="kw">plot</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="kw">sqrt</span>(dist), meuse)</a>
<a class="sourceLine" id="cb132-2" data-line-number="2"><span class="kw">abline</span>(<span class="kw">lm</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="kw">sqrt</span>(dist), meuse), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
<p>Now, we can look at the directional varigrams of the residuals in the model after accounting for square-root distance to the river</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">dir_variogram &lt;-<span class="st"> </span><span class="kw">variogram</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="kw">sqrt</span>(dist), <span class="dt">data =</span> meuse, <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">45</span>, <span class="dv">90</span>, <span class="dv">135</span>))</a>
<a class="sourceLine" id="cb133-2" data-line-number="2">fit_variogram &lt;-<span class="st"> </span><span class="kw">fit.variogram</span>(dir_variogram, <span class="dt">model =</span> <span class="kw">vgm</span>(<span class="dv">1</span>, <span class="st">&quot;Exp&quot;</span>))</a>
<a class="sourceLine" id="cb133-3" data-line-number="3"><span class="kw">plot</span>(dir_variogram, fit_variogram, <span class="dt">as.table =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<p>where these variograms seem to fit the data better. You can explore this variogram as a map</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1">map_variogram &lt;-<span class="st"> </span><span class="kw">variogram</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="kw">sqrt</span>(dist), <span class="dt">data =</span> meuse,</a>
<a class="sourceLine" id="cb134-2" data-line-number="2">                           <span class="dt">cutoff =</span> <span class="dv">1500</span>, <span class="dt">width =</span> <span class="dv">100</span>, <span class="dt">map =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb134-3" data-line-number="3"><span class="kw">plot</span>(map_variogram, <span class="dt">threshold =</span> <span class="dv">5</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<p>which shows that after modeling log(zinc) as a function of the square-root distance to the river, the residuals appear isotropic left in the residuals.</p>
</div>
</div>
</div>
<div id="estimation-of-the-spatial-process" class="section level2">
<h2><span class="header-section-number">7.3</span> Estimation of the spatial process</h2>
<ul>
<li>Assume we have the model</li>
</ul>
<p><span class="math display">\[\begin{align*}
y(\mathbf{s}) &amp; = \mu(\mathbf{s}) + \eta(\mathbf{s}) + \varepsilon(\mathbf{s}) 
\end{align*}\]</span></p>
<ul>
<li><p>then, <span class="math inline">\(Cov \left( y(\mathbf{s}_i), y(\mathbf{s}_j ) \right) = \sigma^2 C(d_{ij} | \nu, \phi) + \tau^2 I\{i = j\}\)</span> where <span class="math inline">\(C(d_{ij} | \nu, \phi)\)</span> is a Matern correlation function with smoothness parameter <span class="math inline">\(\nu\)</span> and range parameter <span class="math inline">\(\phi\)</span>.</p></li>
<li><p>We observe the data <span class="math inline">\(\mathbf{y} = (y(\mathbf{s}_1), \ldots, y(\mathbf{s}_n))&#39;\)</span> at <span class="math inline">\(n\)</span> locations <span class="math inline">\(\mathbf{s}_1, \ldots, \mathbf{s}_n\)</span>.</p></li>
<li><p><span class="math inline">\(\mathbf{y} \sim N(\boldsymbol{\mu}, \boldsymbol{\Sigma}(\boldsymbol{\theta}))\)</span>.</p></li>
<li><p><span class="math inline">\(\boldsymbol{\mu} = \mathbf{X}\left( \mathbf{s} \right) \boldsymbol{\beta}\)</span> is the model for the mean process given the <span class="math inline">\(n \times p\)</span> covariate matrix <span class="math inline">\(\mathbf{X}(\mathbf{s})\)</span> and <span class="math inline">\(\boldsymbol{\Sigma}(\boldsymbol{\theta})\)</span> is the covariance matrix with parameters <span class="math inline">\(\boldsymbol{\theta} = (\tau^2, \sigma^2, \nu, \phi)&#39;\)</span>.</p></li>
<li><p>To fit the model, we need to estimate <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\boldsymbol{\theta}\)</span>.</p></li>
<li>Traditional statistical methods: use replication
<ul>
<li>With <span class="math inline">\(k = 1, \ldots, K\)</span> replications of the spatial process <span class="math inline">\(\mathbf{y}_k\)</span>, we can estimate the spatial mean as</li>
</ul>
<p><span class="math display">\[\begin{align*}
  \widehat{\boldsymbol{\mu}} = \frac{1}{K} \sum_{k=1}^K \mathbf{y}_k
  \end{align*}\]</span></p>
<p>and the spatial mean as</p>
<p><span class="math display">\[\begin{align*}
  \widehat{\boldsymbol{\Sigma}} = \frac{1}{K} \sum_{k=1}^K \left( \mathbf{y}_k - \widehat{\boldsymbol{\mu}} \right) \left( \mathbf{y}_k - \widehat{\boldsymbol{\mu}} \right)&#39;
  \end{align*}\]</span></p>
<ul>
<li>However, we don’t have replication – we only have the single observation <span class="math inline">\(\mathbf{y}\)</span>.</li>
</ul></li>
<li><p>We will explore different estimation methods using 1) variograms, 2) maximum liklihood, and 3) Bayesian methods</p></li>
</ul>
<div id="estimation-of-the-spatial-process-using-variograms" class="section level3">
<h3><span class="header-section-number">7.3.1</span> Estimation of the spatial process using variograms</h3>
<ul>
<li><p>First, fit a model to the mean to estimate <span class="math inline">\(\hat{\mu}(\mathbf{s})\)</span> (use maximum likelihood, least-squares, etc.)</p></li>
<li>Next, generate a sequence of <span class="math inline">\(B\)</span> bins based on distance and group each pair of points <span class="math inline">\((\mathbf{s}_i, \mathbf{s}_j)\)</span> into a bin
<ul>
<li>Example bins: [0, 1), [1, 2), [2, 3), </li>
</ul></li>
<li><p>Place the pair of observations <span class="math inline">\(\mathbf{s}_i\)</span> and <span class="math inline">\(\mathbf{s}_j\)</span> that are seperated by <span class="math inline">\(d_{b} \in [d_b - \epsilon, d_b + \epsilon)\)</span> into one of the <span class="math inline">\(B\)</span> bins.</p></li>
<li><p>Calculate the average of the variogram within each bin
For each of the <span class="math inline">\(k\)</span> bins that have <span class="math inline">\(m_k\)</span> points in each bin, the variogram estimate for bin <span class="math inline">\(k\)</span> centered at the bin interval <span class="math inline">\(\mathbf{h}_k\)</span> is</p></li>
</ul>
<p><span class="math display">\[\begin{align*}
\hat{\gamma}(\mathbf{h}_k) = \frac{1}{m_k} \sum_{\ell=1}^{m_k} \left( y(\mathbf{s}_{\ell_1}) - y(\mathbf{s}_{\ell_2}) \right)
\end{align*}\]</span></p>
<p>for the <span class="math inline">\(\ell\)</span>th pair of locations <span class="math inline">\(\mathbf{s}_{\ell_1}\)</span> and <span class="math inline">\(\mathbf{s}_{\ell_2}\)</span></p>
<p><strong>insert empirical variogram plot from class here</strong></p>
<ul>
<li>Can estimate the parameters “by eye” or using least squares</li>
</ul>
<p><span class="math display" id="eq:variogram">\[\begin{align*}
\hat{\boldsymbol{\theta}} &amp; = (\hat{\tau}^2, \hat{\sigma}^2, \hat{\phi}, \hat{\nu})&#39; \\
&amp; = \underset{\tau^2, \sigma^2, \phi, \nu}{\operatorname{argmax}} \sum_{b=1}^B \left( \hat{\gamma}(d_b) - \gamma(d_b)\right)^2 w_b \\
&amp; = \underset{\tau^2, \sigma^2, \phi, \nu}{\operatorname{argmax}} \sum_{b=1}^B \left( \hat{\gamma}(d_b) - \left( \sigma^2 + \tau^2 C \left( d_b | \phi, \nu \right) \right) \right)^2 w_b 
\tag{7.1}
\end{align*}\]</span></p>
<p>given the correlation function <span class="math inline">\(C \left( d_b | \phi, \nu \right)\)</span> and a set of weights <span class="math inline">\(w_b\)</span>.</p>
<div id="estimation-of-the-mean-function" class="section level4">
<h4><span class="header-section-number">7.3.1.1</span> Estimation of the mean function</h4>
<ul>
<li><p>What is the least squares estimator of the mean function?</p></li>
<li><p>Recall, if <span class="math inline">\(\mathbf{y} \sim N(\mathbf{X} \boldsymbol{\beta}, \boldsymbol{\Sigma})\)</span>, then</p>
<ul>
<li><span class="math inline">\(\hat{\boldsymbol{\beta}} = (\mathbf{X}&#39;\mathbf{X})^{-1}\mathbf{X} \mathbf{y}\)</span> is an unbiased estimator.</li>
</ul>
<p><span class="math display">\[\begin{align*}
  E(\hat{\boldsymbol{\beta}}) &amp; = (\mathbf{X}&#39;\mathbf{X})^{-1}\mathbf{X} E(\mathbf{y}) \\
  &amp; = (\mathbf{X}&#39;\mathbf{X})^{-1}\mathbf{X}\mathbf{X} \boldsymbol{\beta} \\
  &amp; = \boldsymbol{\beta} 
  \end{align*}\]</span></p>
<ul>
<li>However,</li>
</ul>
<p><span class="math display">\[\begin{align*}
  Cov(\hat{\boldsymbol{\beta}}) &amp; = (\mathbf{X}&#39;\mathbf{X})^{-1}\mathbf{X} \boldsymbol{\Sigma} \mathbf{X} (\mathbf{X}&#39;\mathbf{X})^{-1} \\
  &amp; \neq \sigma^2 (\mathbf{X}&#39;\mathbf{X})^{-1}
  \end{align*}\]</span></p>
<p>which is the least squares covariance estimate of <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span>. Thus the least squares estimate has a biased covariance estimate.</p></li>
<li><p>Given the fitted covariance matrix <span class="math inline">\(\hat{\boldsymbol{\Sigma}}\)</span> from the variogram, an updated mean function estimate is</p>
<p><span class="math display">\[\begin{align*}
  \hat{\boldsymbol{\beta}} &amp; = (\mathbf{X}&#39; \hat{\boldsymbol{\Sigma}}^{-1} \mathbf{X})^{-1} \mathbf{X}&#39; \hat{\boldsymbol{\Sigma}}^{-1} \mathbf{y}
  \end{align*}\]</span></p>
<p>and the covariance is</p>
<p><span class="math display">\[\begin{align*}
  Cov(\hat{\boldsymbol{\beta}}) &amp; = (\mathbf{X}&#39; \hat{\boldsymbol{\Sigma}}^{-1} \mathbf{X})^{-1}
  \end{align*}\]</span></p></li>
<li><p>This suggests that an iterative approach can be used to fit the model</p></li>
</ul>
<ol style="list-style-type: decimal">
<li>estimate the mean function</li>
<li>using the estimated mean function, update the covariance function</li>
<li>repeat steps 1 and 2 until convergence</li>
</ol>
<ul>
<li>Any issues? Uncertainty estimation?
<ul>
<li>How do you propogate parameter uncertainty?</li>
<li>Prediction uncertainty is likely to be too small</li>
</ul></li>
</ul>
</div>
</div>
<div id="maximum-likelihood" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Maximum Likelihood</h3>
<div id="the-likelihood" class="section level4">
<h4><span class="header-section-number">7.3.2.1</span> The likelihood</h4>
<p>To understand the benefits of Bayesian analysis, it is useful to recall the likelihood framework. Assume that our model can be simplified so that the data are <span class="math inline">\(\mathbf{y} = (y_1, \ldots, y_N)&#39;\)</span> and the parameters are <span class="math inline">\(\boldsymbol{\theta}\)</span>. Before observation, the data <span class="math inline">\(\mathbf{y}\)</span> are considered a random variable. After observation, the data <span class="math inline">\(\mathbf{y}\)</span> are considered fixed and known. The likelihood is a formal representation of how likely the data <span class="math inline">\(\mathbf{y}\)</span> are to arise given a probability distribution with parameters <span class="math inline">\(\boldsymbol{\theta}\)</span>. The likelihood function <span class="math inline">\(L(\boldsymbol{\theta} | \mathbf{y})\)</span> is defined as
<span class="math display">\[\begin{align*}
L(\boldsymbol{\theta} | \mathbf{y}) &amp; = [\mathbf{y} | \boldsymbol{\theta}],
\end{align*}\]</span>
where the function says that the likelihood of the parameter conditional on the data is is the conditional probability density of the data conditional on the parameters.</p>
<p>If one assumes the observations are conditionally independent given the parameters <span class="math inline">\(\boldsymbol{\theta}\)</span>, the likelihood can be written as
<span class="math display">\[\begin{align*}
L(\boldsymbol{\theta} | \mathbf{y}) &amp; = \prod_{i=1}^N [y_i | \boldsymbol{\theta}],
\end{align*}\]</span>
Note the distinction between the use of the term likelihood function for the left side of the equation with the use of the term likelihood in Bayesian statistics to describe the right side of the above equation. A distinction between the likelihood function and the probability distribution function is in what is considered the random variable. In the likelihood function, the data <span class="math inline">\(\mathbf{y}\)</span> is assumed known and the parameters <span class="math inline">\(\boldsymbol{\theta}\)</span> are random. For the probability distribution function, the data <span class="math inline">\(\mathbf{y}\)</span> are considered are random variable conditional on a fixed, known parameter <span class="math inline">\(\boldsymbol{\theta}\)</span>. To illustrate this difference, consider a univariate gamma probability distribution with shape parameter <span class="math inline">\(\alpha = 10\)</span> and scale parameter <span class="math inline">\(\theta=10\)</span>. If we observe a single <span class="math inline">\(y=2\)</span>, the following figure shows the density function and likelihood function, with <span class="math inline">\(\alpha\)</span> assumed fixed and known.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="kw">library</span>(latex2exp)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;latex2exp&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:plotly&#39;:
## 
##     TeX</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb138-2" data-line-number="2">alpha &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb138-3" data-line-number="3">theta &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb138-4" data-line-number="4">density_function &lt;-<span class="st"> </span><span class="cf">function</span> (x) {</a>
<a class="sourceLine" id="cb138-5" data-line-number="5">  <span class="kw">return</span>(<span class="kw">dgamma</span>(x, alpha, theta))</a>
<a class="sourceLine" id="cb138-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb138-7" data-line-number="7">likelihood_function &lt;-<span class="st"> </span><span class="cf">function</span> (x) {</a>
<a class="sourceLine" id="cb138-8" data-line-number="8">  <span class="kw">return</span>(<span class="kw">dgamma</span>(y, alpha, x))</a>
<a class="sourceLine" id="cb138-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb138-10" data-line-number="10"><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb138-11" data-line-number="11"><span class="co">## plot density function</span></a>
<a class="sourceLine" id="cb138-12" data-line-number="12"><span class="kw">curve</span>(<span class="kw">density_function</span>(x), <span class="dv">0</span>, <span class="dv">4</span>, <span class="dt">main =</span> <span class="st">&quot;Density function&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;y&quot;</span>, </a>
<a class="sourceLine" id="cb138-13" data-line-number="13">      <span class="dt">ylab=</span><span class="kw">TeX</span>(<span class="st">&quot;$</span><span class="ch">\\</span><span class="st">lbrack$y|$</span><span class="ch">\\</span><span class="st">theta$ $</span><span class="ch">\\</span><span class="st">rbrack$&quot;</span>))</a>
<a class="sourceLine" id="cb138-14" data-line-number="14"><span class="kw">text</span>(<span class="dv">1</span>, <span class="fl">0.4</span>, <span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb138-15" data-line-number="15">  <span class="st">&quot;Area = &quot;</span>, <span class="kw">round</span>(<span class="kw">integrate</span>(density_function, <span class="dv">0</span>, <span class="ot">Inf</span>)[<span class="dv">1</span>]<span class="op">$</span>value, <span class="dt">digits=</span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb138-16" data-line-number="16"><span class="kw">points</span>(<span class="dv">2</span>, <span class="kw">density_function</span>(<span class="dv">2</span>), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">pch=</span><span class="dv">16</span>)</a>
<a class="sourceLine" id="cb138-17" data-line-number="17"><span class="kw">curve</span>(<span class="kw">likelihood_function</span>(x), <span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">main =</span> <span class="st">&quot;Likelihood function&quot;</span>,</a>
<a class="sourceLine" id="cb138-18" data-line-number="18">      <span class="dt">xlab=</span><span class="kw">TeX</span>(<span class="st">&quot;$</span><span class="ch">\\</span><span class="st">theta$&quot;</span>), <span class="dt">ylab=</span><span class="kw">TeX</span>(<span class="st">&quot;$L(y|</span><span class="ch">\\</span><span class="st">theta)$&quot;</span>))</a>
<a class="sourceLine" id="cb138-19" data-line-number="19"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">0.3</span>, <span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb138-20" data-line-number="20">  <span class="st">&quot;Area = &quot;</span>, <span class="kw">round</span>(<span class="kw">integrate</span>(likelihood_function, <span class="dv">0</span>, <span class="ot">Inf</span>)[<span class="dv">1</span>]<span class="op">$</span>value, <span class="dt">digits=</span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb138-21" data-line-number="21"><span class="kw">points</span>(<span class="dv">10</span>, <span class="kw">likelihood_function</span>(<span class="dv">10</span>), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">pch=</span><span class="dv">16</span>)</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<p>Notice that the area under the curve of the density function is 1 (because it is a formal probability distribution) whereas the area under the likelihood function is not 1 (the area is 10). Hence, when performing optimization using a likelihood function, one is <strong>not</strong> optimizing a probability function. Because the likelihood is not a probability, we appeal to frequentist (rather than probabilistic) interpretations when interpreting likelihood analyses. For example, the interpretation of a 95% confidence interval is “under repeated sampling from the population, 95% of the confidence intervals will contain the true value,” in comparison to the probabilistic interpretation “the probability the interval contains the true value is 95%.” The density function and the likelihood function share a common point at <span class="math inline">\(y=2\)</span> and <span class="math inline">\(\theta=10\)</span>, (shown in red in the figure above) given the fixed value of <span class="math inline">\(\alpha\)</span>. This suggests that the likelihood and density functions are the same only when the parameter is assumed to be a fixed, known value.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1"><span class="co">## check that the density function and the likelihood function share the same point</span></a>
<a class="sourceLine" id="cb139-2" data-line-number="2"><span class="kw">all.equal</span>(<span class="kw">density_function</span>(<span class="dv">2</span>), <span class="kw">likelihood_function</span>(<span class="dv">10</span>))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Philosophically, there is a subtle difference between the density function and the likelihood function that is important to understand. In the likelihood function, we allow the parameter <span class="math inline">\(\theta\)</span> to vary; however, we do not assume that <span class="math inline">\(\theta\)</span> is a random variable. To be a random variable there must be a formal probability distribution for <span class="math inline">\(\theta\)</span>. We showed earlier that the likelihood function does not integrate to 1 so we don’t view <span class="math inline">\(\theta\)</span> as a random variable and the likelihood function is not a probability distribution for <span class="math inline">\(\theta\)</span>.</p>
</div>
</div>
</div>
<div id="maximum-likelihood-1" class="section level2">
<h2><span class="header-section-number">7.4</span> Maximum likelihood</h2>
<p>Maximum likelihood estimation has the goal of finding the set of parameters <span class="math inline">\(\hat{\boldsymbol{\theta}}\)</span> that were most likely to give rise to the data. Because the likelihood does not integrate to 1, the likelihood by itself is not infomative; only comparisons among likelihoods are meaningful because the likelihood can be shifted up or down in the y-axis by an arbitraty constant <span class="math inline">\(c\)</span>. To cancel out the unkown constant <span class="math inline">\(c\)</span>, we take ratios of the likelihoods at values <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span>, giving rise to the likelihood ratio
<span class="math display">\[\begin{align*}
\frac{L(\theta_1 | y)}{L(\theta_2 | y)} &amp; = \frac{[y|\theta_1]}{[y|\theta_2]}.
\end{align*}\]</span>
The likelihood ratio expresses the strength of evidence in favor of <span class="math inline">\(\theta_1\)</span> relative to <span class="math inline">\(\theta_2\)</span>. In general, we use the log likelihood ratio to express the strength of evidence where positive values of the log likelihood ratio give evidence in support of <span class="math inline">\(\theta_1\)</span> and negative values of the log likelihood ratio give evidence in support of <span class="math inline">\(\theta_2\)</span>, conditional on the data.</p>
<p>The maximum likelihood estimate is the value <span class="math inline">\(\hat{\theta}\)</span> such that
<span class="math display">\[\begin{align*}
\log \left( \frac{L(\hat{\theta} | y)}{L(\theta^\star | y)} \right) &amp; \geq 0
\end{align*}\]</span>
for all values of <span class="math inline">\(\theta^\star\)</span>. The following figure demonstrates this idea visually.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1"><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb141-2" data-line-number="2"><span class="kw">curve</span>(<span class="kw">likelihood_function</span>(x), <span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">main =</span> <span class="st">&quot;Likelihood function&quot;</span>,</a>
<a class="sourceLine" id="cb141-3" data-line-number="3">      <span class="dt">xlab=</span><span class="kw">TeX</span>(<span class="st">&quot;$</span><span class="ch">\\</span><span class="st">theta$&quot;</span>), <span class="dt">ylab=</span><span class="kw">TeX</span>(<span class="st">&quot;$L(y|</span><span class="ch">\\</span><span class="st">theta)$&quot;</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.02</span>, <span class="fl">0.66</span>))</a>
<a class="sourceLine" id="cb141-4" data-line-number="4"><span class="kw">segments</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="kw">likelihood_function</span>(<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb141-5" data-line-number="5"><span class="kw">arrows</span>(<span class="dv">3</span>, <span class="kw">likelihood_function</span>(<span class="dv">3</span>), <span class="dv">0</span>, <span class="kw">likelihood_function</span>(<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb141-6" data-line-number="6"><span class="kw">text</span>(<span class="fl">3.1</span>, <span class="fl">-0.02</span>, <span class="kw">TeX</span>(<span class="st">&quot;$</span><span class="ch">\\</span><span class="st">theta_1$ = 3&quot;</span>))</a>
<a class="sourceLine" id="cb141-7" data-line-number="7"><span class="kw">text</span>(<span class="fl">1.5</span>, <span class="kw">likelihood_function</span>(<span class="dv">3</span>)<span class="op">+</span><span class="st"> </span><span class="fl">.02</span>, <span class="kw">TeX</span>(<span class="st">&quot;$L(y|</span><span class="ch">\\</span><span class="st">theta_1)$&quot;</span>))</a>
<a class="sourceLine" id="cb141-8" data-line-number="8"></a>
<a class="sourceLine" id="cb141-9" data-line-number="9"><span class="kw">segments</span>(<span class="dv">6</span>, <span class="dv">0</span>, <span class="dv">6</span>, <span class="kw">likelihood_function</span>(<span class="dv">6</span>))</a>
<a class="sourceLine" id="cb141-10" data-line-number="10"><span class="kw">arrows</span>(<span class="dv">6</span>, <span class="kw">likelihood_function</span>(<span class="dv">6</span>), <span class="dv">0</span>, <span class="kw">likelihood_function</span>(<span class="dv">6</span>))</a>
<a class="sourceLine" id="cb141-11" data-line-number="11"><span class="kw">text</span>(<span class="fl">6.1</span>, <span class="fl">-0.02</span>, <span class="kw">TeX</span>(<span class="st">&quot;$</span><span class="ch">\\</span><span class="st">theta_2$ = 6&quot;</span>))</a>
<a class="sourceLine" id="cb141-12" data-line-number="12"><span class="kw">text</span>(<span class="fl">1.5</span>, <span class="kw">likelihood_function</span>(<span class="dv">6</span>) <span class="op">+</span><span class="st"> </span><span class="fl">.02</span>, <span class="kw">TeX</span>(<span class="st">&quot;$L(y|</span><span class="ch">\\</span><span class="st">theta_2)$&quot;</span>))</a>
<a class="sourceLine" id="cb141-13" data-line-number="13"></a>
<a class="sourceLine" id="cb141-14" data-line-number="14"><span class="kw">segments</span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">5</span>, <span class="kw">likelihood_function</span>(<span class="dv">5</span>), <span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb141-15" data-line-number="15"><span class="kw">text</span>(<span class="fl">5.3</span>, <span class="fl">0.66</span>, <span class="kw">TeX</span>(<span class="st">&quot;$</span><span class="ch">\\</span><span class="st">hat{</span><span class="ch">\\</span><span class="st">theta}_{MLE}$ = 5&quot;</span>))</a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<p>For example, if <span class="math inline">\(\theta_1 = 3\)</span> and <span class="math inline">\(\theta_2 = 6\)</span>, the log likelihood ratio is -0.9314718 which suggests evidence is in favor of <span class="math inline">\(\theta_2\)</span> relative to <span class="math inline">\(\theta_1\)</span>. In comparison, the log likelihood ratio of the MLE <span class="math inline">\(\hat{\theta}_{MLE}\)</span> is 0.1767844 which gives evidence in favor of <span class="math inline">\(\hat{\theta}_{MLE}\)</span>.</p>
<div id="maximum-likelihood-estimation-of-the-variogram" class="section level4">
<h4><span class="header-section-number">7.4.0.1</span> Maximum likelihood estimation of the variogram</h4>
<ul>
<li>Instead of using the variogram in <a href="day-7.html#eq:variogram">(7.1)</a>, we can use maximum liklihood.</li>
<li><p>More formal and principled estimation framework.</p></li>
<li><p>Allows for parameter uncertainty quantification.</p></li>
<li><p>Goal: estimate the parameters <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\boldsymbol{\theta} = (\tau^2, \sigma^2, \nu, \phi)&#39;\)</span>.</p></li>
<li><p>The log-likelihood to maximize is</p></li>
</ul>
<p><span class="math display">\[\begin{align*}
\log[\boldsymbol{\beta}, \boldsymbol{\theta} | \mathbf{y}] &amp; = - \frac{1}{2} \log|\boldsymbol{\Sigma}(\boldsymbol{\theta})| - \frac{1}{2} \left( \mathbf{y} - \mathbf{X} \boldsymbol{\beta} \right)&#39; \boldsymbol{\Sigma}(\boldsymbol{\theta})^{-1} \left( \mathbf{y} - \mathbf{X} \boldsymbol{\beta} \right)
\end{align*}\]</span></p>
<ul>
<li>This is a multivariate optimization and difficult to optimize directly. Instead, notice the estimate <span class="math inline">\(\hat{\boldsymbol{\beta}}(\boldsymbol{\theta}) = (\mathbf{X}&#39; \hat{\boldsymbol{\Sigma}}^{-1} \mathbf{X})^{-1} \mathbf{X}&#39; \hat{\boldsymbol{\Sigma}}^{-1} \mathbf{y}\)</span> is a known function of <span class="math inline">\(\boldsymbol{\theta}\)</span> so we can profile it out of the equation. Thus, we can instead optimize the <a href="https://www.stat.tamu.edu/~suhasini/teaching613/chapter3.pdf">profile likelihood</a></li>
</ul>
<p><span class="math display">\[\begin{align*}
\log[\boldsymbol{\theta} | \mathbf{y}]_{prof} &amp; = - \frac{1}{2} \log|\boldsymbol{\Sigma}(\boldsymbol{\theta})| - \frac{1}{2} \left( \mathbf{y} - \mathbf{X} \boldsymbol{\beta}(\boldsymbol{\theta}) \right)&#39; \boldsymbol{\Sigma}(\boldsymbol{\theta})^{-1} \left( \mathbf{y} - \mathbf{X} \boldsymbol{\beta}(\boldsymbol{\theta}) \right)
\end{align*}\]</span></p>
<p>Note this equation is now just a function of <span class="math inline">\(\boldsymbol{\theta}\)</span>.</p>
<ul>
<li>Computational complexity – both the log-likelihood and the profile log-likelihood requre the determinant and inverse of the <span class="math inline">\(n \times n\)</span> covariance matrix <span class="math inline">\(\boldsymbol{\Sigma}(\boldsymbol{\theta})\)</span> which require <span class="math inline">\(O(n^3)\)</span> time</li>
</ul>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1"><span class="cf">if</span> (<span class="op">!</span><span class="kw">file.exists</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;matrix-inverse-timings.RData&quot;</span>))) {</a>
<a class="sourceLine" id="cb142-2" data-line-number="2">    n &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">250</span>, <span class="dv">350</span>, <span class="dv">500</span>, <span class="dv">600</span>, <span class="dv">700</span>, <span class="dv">800</span>, <span class="dv">900</span>, <span class="dv">1000</span>, <span class="dv">1250</span>, <span class="dv">1500</span>)</a>
<a class="sourceLine" id="cb142-3" data-line-number="3">    timings &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">length</span>(n))</a>
<a class="sourceLine" id="cb142-4" data-line-number="4">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(n)) {</a>
<a class="sourceLine" id="cb142-5" data-line-number="5">        Sigma      &lt;-<span class="st"> </span><span class="kw">riwish</span>(n[i]<span class="op">+</span><span class="dv">2</span>, <span class="kw">diag</span>(n[i]))</a>
<a class="sourceLine" id="cb142-6" data-line-number="6">        timings[i] &lt;-<span class="st"> </span><span class="kw">system.time</span>(<span class="kw">solve</span>(Sigma))[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb142-7" data-line-number="7">    }</a>
<a class="sourceLine" id="cb142-8" data-line-number="8">    dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">timings =</span> timings, <span class="dt">n =</span> n)</a>
<a class="sourceLine" id="cb142-9" data-line-number="9">    <span class="kw">save</span>(dat, <span class="dt">file =</span> here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;matrix-inverse-timings.RData&quot;</span>))</a>
<a class="sourceLine" id="cb142-10" data-line-number="10">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb142-11" data-line-number="11">  <span class="kw">load</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;matrix-inverse-timings.RData&quot;</span>))</a>
<a class="sourceLine" id="cb142-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb142-13" data-line-number="13"></a>
<a class="sourceLine" id="cb142-14" data-line-number="14"></a>
<a class="sourceLine" id="cb142-15" data-line-number="15"><span class="co">## fit the best cubic model to the data</span></a>
<a class="sourceLine" id="cb142-16" data-line-number="16"><span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span> (<span class="dt">x =</span> n, <span class="dt">y =</span> timings)) <span class="op">+</span></a>
<a class="sourceLine" id="cb142-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb142-18" data-line-number="18"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(x, <span class="dv">3</span>), <span class="dt">fullrange =</span> <span class="ot">TRUE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb142-19" data-line-number="19"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Time to calculate inverse&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb142-20" data-line-number="20"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;matrix size (n by n)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb142-21" data-line-number="21"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Matrix inversion time with fitted polynomial of order 3&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb142-22" data-line-number="22"><span class="st">  </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2000</span>)) </a></code></pre></div>
<p><img src="STAT-5413_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<ul>
<li>Solving the MLE for <span class="math inline">\(\boldsymbol{\theta}\)</span>
<ul>
<li>Can use standard optimization routines like <em>optim()</em></li>
<li>Can use REML to guarantee positive variance parameters
<ul>
<li><a href="https://en.wikipedia.org/wiki/Restricted_maximum_likelihood">“restricted maximum likelihood”</a></li>
<li>Induces a bias in the estimates but guarantees realistic answers (non-negative variances)</li>
</ul></li>
<li>Uncertainties can be estimated using the <a href="https://en.wikipedia.org/wiki/Fisher_information">Fisher information matrix</a>
<span class="math display">\[\begin{align*}
  \mathcal{I}(\boldsymbol{\theta})_{ij} &amp; = E \left( \left( \frac{\mathcal{d}}{\mathcal{d} \boldsymbol{\theta}_i} \log [\boldsymbol{\theta} | \mathbf{y} \right) \left( \frac{\mathcal{d}}{\mathcal{d} \boldsymbol{\theta}_j} \log [\boldsymbol{\theta} | \mathbf{y} \right) \middle| \boldsymbol{\theta} \right) \\
  &amp; = - E \left( \left( \frac{\mathcal{d}^2 }{\mathcal{d} \boldsymbol{\theta}_i \mathcal{d} \boldsymbol{\theta}_j} \log [\boldsymbol{\theta} | \mathbf{y} \right) \middle| \boldsymbol{\theta} \right)
  \end{align*}\]</span></li>
</ul></li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="day-6.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="day-8.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["STAT-5413.pdf", "STAT-5413.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
