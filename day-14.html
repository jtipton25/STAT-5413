<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter14 Day 14 | Notes for STAT 5413 - Spatial Statistics</title>
  <meta name="description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  <meta name="generator" content="bookdown 0.24.3 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter14 Day 14 | Notes for STAT 5413 - Spatial Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter14 Day 14 | Notes for STAT 5413 - Spatial Statistics" />
  
  <meta name="twitter:description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  

<meta name="author" content="John Tipton" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="day-13.html"/>
<link rel="next" href="day-15.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.19/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">STAT 5413 Spatial Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="day-1.html"><a href="day-1.html"><i class="fa fa-check"></i><b>1</b> Day 1</a><ul>
<li class="chapter" data-level="1.1" data-path="day-1.html"><a href="day-1.html#notation"><i class="fa fa-check"></i><b>1.1</b> Notation</a></li>
<li class="chapter" data-level="1.2" data-path="day-1.html"><a href="day-1.html#probability-distributions"><i class="fa fa-check"></i><b>1.2</b> Probability Distributions</a><ul>
<li class="chapter" data-level="1.2.1" data-path="day-1.html"><a href="day-1.html#example-linear-regression"><i class="fa fa-check"></i><b>1.2.1</b> Example: linear regression</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="day-1.html"><a href="day-1.html#hierarchical-modeling"><i class="fa fa-check"></i><b>1.3</b> Hierarchical modeling</a><ul>
<li class="chapter" data-level="1.3.1" data-path="day-1.html"><a href="day-1.html#bayesian-hierarchical-models-bhms"><i class="fa fa-check"></i><b>1.3.1</b> Bayesian Hierarchical models (BHMs)</a></li>
<li class="chapter" data-level="1.3.2" data-path="day-1.html"><a href="day-1.html#empirical-hierarchical-models-ehms"><i class="fa fa-check"></i><b>1.3.2</b> Empirical Hierarchical models (EHMs)</a></li>
<li class="chapter" data-level="1.3.3" data-path="day-1.html"><a href="day-1.html#data-model"><i class="fa fa-check"></i><b>1.3.3</b> Data Model</a></li>
<li class="chapter" data-level="1.3.4" data-path="day-1.html"><a href="day-1.html#process-model"><i class="fa fa-check"></i><b>1.3.4</b> Process Model</a></li>
<li class="chapter" data-level="1.3.5" data-path="day-1.html"><a href="day-1.html#parameter-prior-model-bmhs-only"><i class="fa fa-check"></i><b>1.3.5</b> Parameter (Prior) Model (BMHs only)</a></li>
<li class="chapter" data-level="1.3.6" data-path="day-1.html"><a href="day-1.html#posterior-distribution"><i class="fa fa-check"></i><b>1.3.6</b> Posterior Distribution</a></li>
<li class="chapter" data-level="1.3.7" data-path="day-1.html"><a href="day-1.html#scientifically-motivated-statistical-modeling"><i class="fa fa-check"></i><b>1.3.7</b> Scientifically Motivated Statistical Modeling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="day-2.html"><a href="day-2.html"><i class="fa fa-check"></i><b>2</b> Day 2</a><ul>
<li class="chapter" data-level="2.1" data-path="day-2.html"><a href="day-2.html#spatial-data"><i class="fa fa-check"></i><b>2.1</b> Spatial Data</a></li>
<li class="chapter" data-level="2.2" data-path="day-2.html"><a href="day-2.html#types-of-spatial-data"><i class="fa fa-check"></i><b>2.2</b> Types of spatial data</a><ul>
<li class="chapter" data-level="2.2.1" data-path="day-2.html"><a href="day-2.html#geostatistical-data"><i class="fa fa-check"></i><b>2.2.1</b> Geostatistical data</a></li>
<li class="chapter" data-level="2.2.2" data-path="day-2.html"><a href="day-2.html#areal-data"><i class="fa fa-check"></i><b>2.2.2</b> Areal data</a></li>
<li class="chapter" data-level="2.2.3" data-path="day-2.html"><a href="day-2.html#point-process-data"><i class="fa fa-check"></i><b>2.2.3</b> Point process data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="day-3.html"><a href="day-3.html"><i class="fa fa-check"></i><b>3</b> Day 3</a><ul>
<li class="chapter" data-level="3.1" data-path="day-3.html"><a href="day-3.html#anouncements"><i class="fa fa-check"></i><b>3.1</b> Anouncements</a></li>
<li class="chapter" data-level="3.2" data-path="day-3.html"><a href="day-3.html#files-for-spatial-data"><i class="fa fa-check"></i><b>3.2</b> Files for spatial data</a></li>
<li class="chapter" data-level="3.3" data-path="day-3.html"><a href="day-3.html#textbook-package"><i class="fa fa-check"></i><b>3.3</b> Textbook package</a></li>
<li class="chapter" data-level="3.4" data-path="day-3.html"><a href="day-3.html#spatial-visualization"><i class="fa fa-check"></i><b>3.4</b> Spatial Visualization</a><ul>
<li class="chapter" data-level="3.4.1" data-path="day-3.html"><a href="day-3.html#spatial-visualization-using-fields"><i class="fa fa-check"></i><b>3.4.1</b> Spatial visualization using <em>fields</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="day-4.html"><a href="day-4.html"><i class="fa fa-check"></i><b>4</b> Day 4</a><ul>
<li class="chapter" data-level="4.1" data-path="day-4.html"><a href="day-4.html#announcements"><i class="fa fa-check"></i><b>4.1</b> Announcements</a></li>
<li class="chapter" data-level="4.2" data-path="day-4.html"><a href="day-4.html#visualization-continued"><i class="fa fa-check"></i><b>4.2</b> Visualization (continued)</a><ul>
<li class="chapter" data-level="4.2.1" data-path="day-4.html"><a href="day-4.html#spatial-visualization-using-fields-1"><i class="fa fa-check"></i><b>4.2.1</b> Spatial visualization using <em>fields</em></a></li>
<li class="chapter" data-level="4.2.2" data-path="day-4.html"><a href="day-4.html#in-class-activity"><i class="fa fa-check"></i><b>4.2.2</b> In Class Activity:</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="day-4.html"><a href="day-4.html#interactive-visualization-interactive-with-html-format-only"><i class="fa fa-check"></i><b>4.3</b> Interactive visualization (Interactive with HTML format only)</a><ul>
<li class="chapter" data-level="4.3.1" data-path="day-4.html"><a href="day-4.html#interactive-display-of-data"><i class="fa fa-check"></i><b>4.3.1</b> Interactive display of data</a></li>
<li class="chapter" data-level="4.3.2" data-path="day-4.html"><a href="day-4.html#animations"><i class="fa fa-check"></i><b>4.3.2</b> Animations</a></li>
<li class="chapter" data-level="4.3.3" data-path="day-4.html"><a href="day-4.html#interactive-plotting-using-plotly"><i class="fa fa-check"></i><b>4.3.3</b> Interactive plotting using <em>plotly</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="day-5.html"><a href="day-5.html"><i class="fa fa-check"></i><b>5</b> Day 5</a><ul>
<li class="chapter" data-level="5.1" data-path="day-5.html"><a href="day-5.html#announcements-1"><i class="fa fa-check"></i><b>5.1</b> Announcements</a></li>
<li class="chapter" data-level="5.2" data-path="day-5.html"><a href="day-5.html#spatial-means-and-covariances"><i class="fa fa-check"></i><b>5.2</b> Spatial means and covariances</a><ul>
<li class="chapter" data-level="5.2.1" data-path="day-5.html"><a href="day-5.html#gaussian-processes"><i class="fa fa-check"></i><b>5.2.1</b> Gaussian processes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="day-6.html"><a href="day-6.html"><i class="fa fa-check"></i><b>6</b> Day 6</a><ul>
<li class="chapter" data-level="6.1" data-path="day-6.html"><a href="day-6.html#announcements-2"><i class="fa fa-check"></i><b>6.1</b> Announcements</a></li>
<li class="chapter" data-level="6.2" data-path="day-6.html"><a href="day-6.html#gaussian-process-assumptions"><i class="fa fa-check"></i><b>6.2</b> Gaussian process assumptions</a></li>
<li class="chapter" data-level="6.3" data-path="day-6.html"><a href="day-6.html#recall-hierachical-modeling"><i class="fa fa-check"></i><b>6.3</b> Recall Hierachical modeling</a><ul>
<li class="chapter" data-level="6.3.1" data-path="day-6.html"><a href="day-6.html#data-model-1"><i class="fa fa-check"></i><b>6.3.1</b> Data Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="day-7.html"><a href="day-7.html"><i class="fa fa-check"></i><b>7</b> Day 7</a><ul>
<li class="chapter" data-level="7.1" data-path="day-7.html"><a href="day-7.html#common-isotropic-correlation-functions"><i class="fa fa-check"></i><b>7.1</b> Common isotropic correlation functions</a></li>
<li class="chapter" data-level="7.2" data-path="day-7.html"><a href="day-7.html#covariograms-and-semivariograms"><i class="fa fa-check"></i><b>7.2</b> Covariograms and semivariograms</a><ul>
<li class="chapter" data-level="7.2.1" data-path="day-7.html"><a href="day-7.html#semivariograms-and-variograms"><i class="fa fa-check"></i><b>7.2.1</b> Semivariograms and variograms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="day-8.html"><a href="day-8.html"><i class="fa fa-check"></i><b>8</b> Day 8</a><ul>
<li class="chapter" data-level="8.1" data-path="day-8.html"><a href="day-8.html#announcements-3"><i class="fa fa-check"></i><b>8.1</b> Announcements</a></li>
<li class="chapter" data-level="8.2" data-path="day-8.html"><a href="day-8.html#estimation-of-the-spatial-process"><i class="fa fa-check"></i><b>8.2</b> Estimation of the spatial process</a><ul>
<li class="chapter" data-level="8.2.1" data-path="day-8.html"><a href="day-8.html#estimation-of-the-spatial-process-using-variograms"><i class="fa fa-check"></i><b>8.2.1</b> Estimation of the spatial process using variograms</a></li>
<li class="chapter" data-level="8.2.2" data-path="day-8.html"><a href="day-8.html#maximum-likelihood"><i class="fa fa-check"></i><b>8.2.2</b> Maximum Likelihood</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="day-8.html"><a href="day-8.html#maximum-likelihood-1"><i class="fa fa-check"></i><b>8.3</b> Maximum likelihood</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="day-9.html"><a href="day-9.html"><i class="fa fa-check"></i><b>9</b> Day 9</a><ul>
<li class="chapter" data-level="9.1" data-path="day-9.html"><a href="day-9.html#announcements-4"><i class="fa fa-check"></i><b>9.1</b> Announcements</a></li>
<li class="chapter" data-level="9.2" data-path="day-9.html"><a href="day-9.html#asymptotic-properties-of-the-mle"><i class="fa fa-check"></i><b>9.2</b> Asymptotic properties of the MLE</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="day-10.html"><a href="day-10.html"><i class="fa fa-check"></i><b>10</b> Day 10</a><ul>
<li class="chapter" data-level="10.1" data-path="day-10.html"><a href="day-10.html#announcements-5"><i class="fa fa-check"></i><b>10.1</b> Announcements</a></li>
<li class="chapter" data-level="10.2" data-path="day-10.html"><a href="day-10.html#asymptotic-properties-of-the-mle-1"><i class="fa fa-check"></i><b>10.2</b> Asymptotic properties of the MLE</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="day-11.html"><a href="day-11.html"><i class="fa fa-check"></i><b>11</b> Day 11</a><ul>
<li class="chapter" data-level="11.1" data-path="day-11.html"><a href="day-11.html#announcements-6"><i class="fa fa-check"></i><b>11.1</b> Announcements</a></li>
<li class="chapter" data-level="11.2" data-path="day-11.html"><a href="day-11.html#example-spatial-analysis"><i class="fa fa-check"></i><b>11.2</b> Example spatial analysis</a></li>
<li class="chapter" data-level="11.3" data-path="day-11.html"><a href="day-11.html#spatial-model-fitting"><i class="fa fa-check"></i><b>11.3</b> Spatial model fitting</a><ul>
<li class="chapter" data-level="11.3.1" data-path="day-11.html"><a href="day-11.html#fit-the-maximum-likelihood-estimate-using-the-geor-package"><i class="fa fa-check"></i><b>11.3.1</b> Fit the maximum likelihood estimate using the <em>geoR</em> package</a></li>
<li class="chapter" data-level="11.3.2" data-path="day-11.html"><a href="day-11.html#fitting-a-spatial-model-using-the-nlme-package"><i class="fa fa-check"></i><b>11.3.2</b> Fitting a spatial model using the <em>nlme</em> package</a></li>
<li class="chapter" data-level="11.3.3" data-path="day-11.html"><a href="day-11.html#model-fitting-with-autokrige-function"><i class="fa fa-check"></i><b>11.3.3</b> model fitting with <em>autokrige</em> function</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="day-11.html"><a href="day-11.html#kriging"><i class="fa fa-check"></i><b>11.4</b> Kriging</a><ul>
<li class="chapter" data-level="11.4.1" data-path="day-11.html"><a href="day-11.html#kriging-equations-with-mean-mu-0"><i class="fa fa-check"></i><b>11.4.1</b> Kriging Equations with mean <span class="math inline">\(\mu = 0\)</span></a></li>
<li class="chapter" data-level="11.4.2" data-path="day-11.html"><a href="day-11.html#kriging-equations-with-unknown-mean"><i class="fa fa-check"></i><b>11.4.2</b> Kriging Equations with unknown mean</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="day-12.html"><a href="day-12.html"><i class="fa fa-check"></i><b>12</b> Day 12</a><ul>
<li class="chapter" data-level="12.1" data-path="day-12.html"><a href="day-12.html#announcements-7"><i class="fa fa-check"></i><b>12.1</b> Announcements</a></li>
<li class="chapter" data-level="12.2" data-path="day-12.html"><a href="day-12.html#introduction-to-mcmc"><i class="fa fa-check"></i><b>12.2</b> Introduction to MCMC</a></li>
<li class="chapter" data-level="12.3" data-path="day-12.html"><a href="day-12.html#example-simple-linear-regression"><i class="fa fa-check"></i><b>12.3</b> Example: Simple linear regression</a></li>
<li class="chapter" data-level="12.4" data-path="day-12.html"><a href="day-12.html#the-posterior-distribution"><i class="fa fa-check"></i><b>12.4</b> The posterior distribution</a><ul>
<li class="chapter" data-level="12.4.1" data-path="day-12.html"><a href="day-12.html#full-conditional-distribution-of-mu"><i class="fa fa-check"></i><b>12.4.1</b> Full conditional distribution of <span class="math inline">\(\mu\)</span></a></li>
<li class="chapter" data-level="12.4.2" data-path="day-12.html"><a href="day-12.html#full-conditional-distribution-for-beta"><i class="fa fa-check"></i><b>12.4.2</b> Full conditional distribution for <span class="math inline">\(\beta\)</span></a></li>
<li class="chapter" data-level="12.4.3" data-path="day-12.html"><a href="day-12.html#full-conditional-distribution-for-sigma2"><i class="fa fa-check"></i><b>12.4.3</b> Full conditional distribution for <span class="math inline">\(\sigma^2\)</span></a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="day-12.html"><a href="day-12.html#fitting-the-model"><i class="fa fa-check"></i><b>12.5</b> Fitting the model</a><ul>
<li class="chapter" data-level="12.5.1" data-path="day-12.html"><a href="day-12.html#general-recommendations-for-writing-mcmc-software"><i class="fa fa-check"></i><b>12.5.1</b> General recommendations for writing MCMC software</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="day-13.html"><a href="day-13.html"><i class="fa fa-check"></i><b>13</b> Day 13</a><ul>
<li class="chapter" data-level="13.1" data-path="day-13.html"><a href="day-13.html#announcements-8"><i class="fa fa-check"></i><b>13.1</b> Announcements</a></li>
<li class="chapter" data-level="13.2" data-path="day-13.html"><a href="day-13.html#the-metropolis-algorithm"><i class="fa fa-check"></i><b>13.2</b> The Metropolis Algorithm</a></li>
<li class="chapter" data-level="13.3" data-path="day-13.html"><a href="day-13.html#the-proposal-distribution"><i class="fa fa-check"></i><b>13.3</b> The proposal distribution</a></li>
<li class="chapter" data-level="13.4" data-path="day-13.html"><a href="day-13.html#the-metropolis-update"><i class="fa fa-check"></i><b>13.4</b> The Metropolis update</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="day-14.html"><a href="day-14.html"><i class="fa fa-check"></i><b>14</b> Day 14</a><ul>
<li class="chapter" data-level="14.1" data-path="day-14.html"><a href="day-14.html#announcements-9"><i class="fa fa-check"></i><b>14.1</b> Announcements</a></li>
<li class="chapter" data-level="14.2" data-path="day-14.html"><a href="day-14.html#the-metropolis-hastings-algorithm"><i class="fa fa-check"></i><b>14.2</b> The Metropolis-Hastings Algorithm</a></li>
<li class="chapter" data-level="14.3" data-path="day-14.html"><a href="day-14.html#the-metropolis-hastings-algorithm-1"><i class="fa fa-check"></i><b>14.3</b> The Metropolis-Hastings algorithm</a></li>
<li class="chapter" data-level="14.4" data-path="day-14.html"><a href="day-14.html#example-1"><i class="fa fa-check"></i><b>14.4</b> Example</a></li>
<li class="chapter" data-level="14.5" data-path="day-14.html"><a href="day-14.html#posterior"><i class="fa fa-check"></i><b>14.5</b> Posterior</a></li>
<li class="chapter" data-level="14.6" data-path="day-14.html"><a href="day-14.html#conditional-posterior-for-phi"><i class="fa fa-check"></i><b>14.6</b> Conditional posterior for <span class="math inline">\(\phi\)</span></a></li>
<li class="chapter" data-level="14.7" data-path="day-14.html"><a href="day-14.html#conditional-posterior-for-sigma2"><i class="fa fa-check"></i><b>14.7</b> Conditional posterior for <span class="math inline">\(\sigma^2\)</span></a></li>
<li class="chapter" data-level="14.8" data-path="day-14.html"><a href="day-14.html#mcmc-using-a-symmetric-proposal-metropolis"><i class="fa fa-check"></i><b>14.8</b> MCMC using a symmetric proposal (Metropolis)</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="day-15.html"><a href="day-15.html"><i class="fa fa-check"></i><b>15</b> Day 15</a><ul>
<li class="chapter" data-level="15.1" data-path="day-15.html"><a href="day-15.html#announcements-10"><i class="fa fa-check"></i><b>15.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="day-16.html"><a href="day-16.html"><i class="fa fa-check"></i><b>16</b> Day 16</a><ul>
<li class="chapter" data-level="16.1" data-path="day-16.html"><a href="day-16.html#announcements-11"><i class="fa fa-check"></i><b>16.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="day-17.html"><a href="day-17.html"><i class="fa fa-check"></i><b>17</b> Day 17</a><ul>
<li class="chapter" data-level="17.1" data-path="day-17.html"><a href="day-17.html#announcements-12"><i class="fa fa-check"></i><b>17.1</b> Announcements</a></li>
<li class="chapter" data-level="17.2" data-path="day-17.html"><a href="day-17.html#gaussian-process-representations"><i class="fa fa-check"></i><b>17.2</b> Gaussian process representations</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="day-18.html"><a href="day-18.html"><i class="fa fa-check"></i><b>18</b> Day 18</a><ul>
<li class="chapter" data-level="18.1" data-path="day-18.html"><a href="day-18.html#announcements-13"><i class="fa fa-check"></i><b>18.1</b> Announcements</a></li>
<li class="chapter" data-level="18.2" data-path="day-18.html"><a href="day-18.html#gaussian-process-representations-continued"><i class="fa fa-check"></i><b>18.2</b> Gaussian process representations continued</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="day-19.html"><a href="day-19.html"><i class="fa fa-check"></i><b>19</b> Day 19</a><ul>
<li class="chapter" data-level="19.1" data-path="day-19.html"><a href="day-19.html#announcements-14"><i class="fa fa-check"></i><b>19.1</b> Announcements</a></li>
<li class="chapter" data-level="19.2" data-path="day-19.html"><a href="day-19.html#stochastic-integration"><i class="fa fa-check"></i><b>19.2</b> Stochastic Integration</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes for STAT 5413 - Spatial Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="day-14" class="section level1">
<h1><span class="header-section-number">Chapter14</span> Day 14</h1>
<div id="announcements-9" class="section level2">
<h2><span class="header-section-number">14.1</span> Announcements</h2>
</div>
<div id="the-metropolis-hastings-algorithm" class="section level2">
<h2><span class="header-section-number">14.2</span> The Metropolis-Hastings Algorithm</h2>
<!-- Set some knitr options -->
<p>Last time, we discussed the Metropolis algorithm for sampling from a distribution where the conditional posterior distribution is not known in an analytic form. The Metropolis algorithm assumes the proposal distribution is symmetric. The <a href="https://en.wikipedia.org/wiki/Metropolis%E2%80%93Hastings_algorithm">Metropolis-Hastings algorithm</a> allows for asymmetric proposal distributions. A good intuition for how the Metropolis Hastings algorithm works is presented by Chib and Greenberg in <a href="http://www.ics.uci.edu/~johnsong/papers/Chib%20and%20Greenberg%20-%20Understanding%20the%20Metropolis-Hastings%20Algorithm.pdf">Understanding the Metropolis-Hastings Algorithm</a>.</p>
<p>This begs the question: Why would one want to use an asymmetric proposal distribution? There are many reasons, but the most compelling and most common is to guarantee that the proposed value of the parameter is in the support of the parameter space. For example, a variance parameter must be positive and a symmetric normal proposal could generate negative proposals that must be rejected with probability 1. This can result in inefficient MCMC samplers that have very low acceptance rates and therefor exhibit poor mixing. Instead, we can use an asymmetric proposal that guarantees a positive proposal and should lead to higer acceptance rates.</p>
</div>
<div id="the-metropolis-hastings-algorithm-1" class="section level2">
<h2><span class="header-section-number">14.3</span> The Metropolis-Hastings algorithm</h2>
<p>Recall for a symmetric proposal, the Metropolis ratio is
<span class="math display">\[\begin{align*}
a &amp; = \frac{[\mathbf{y} | \theta^{\star}] [\theta^{\star}] } { [\mathbf{y} | \theta^{(k-1)}] [\theta^{(k-1)}] }.
\end{align*}\]</span></p>
<p>Given an asymmetric proposal <span class="math inline">\([\theta^{\star}|\theta^{(k-1)}]\)</span>, the Metropolis-Hastings ratio is
<span class="math display">\[\begin{align*}
a &amp; = \frac{[\mathbf{y} | \theta^{\star}] [\theta^{\star}] } { [\mathbf{y} | \theta^{(k-1)}] [\theta^{(k-1)}] } \frac{[\theta^{(k-1)} | \theta^{\star}]} {[\theta^{\star} | \theta^{(k-1)}]},
\end{align*}\]</span>
where <span class="math inline">\(\frac{[\theta^{(k-1)} | \theta^{\star}]} {[\theta^{\star} | \theta^{(k-1)}]}\)</span> is a correction factor that accounts for the asymmetric proposal. The Metropolis algorithm can be shown to be a special case of the Metropolis-Hastings algorithm by noting that <span class="math inline">\(\frac{[\theta^{(k-1)} | \theta^{\star}]} {[\theta^{\star} | \theta^{(k-1)}]} = 1\)</span> when the proposal is symmetric.</p>
</div>
<div id="example-1" class="section level2">
<h2><span class="header-section-number">14.4</span> Example</h2>
<p>Let’s consider an AR(1) model
<span class="math display">\[\begin{align*}
y_t &amp; = \phi y_{t-1} + \varepsilon_t
\end{align*}\]</span>
where <span class="math inline">\(\varepsilon_t \stackrel{iid} \sim \operatorname{N}(0, \sigma^2)\)</span> and both <span class="math inline">\(\phi\)</span> and <span class="math inline">\(\sigma^2\)</span> are unknown.</p>
<p>Simulated data are shown below.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="day-14.html#cb270-1"></a>N &lt;-<span class="st"> </span><span class="dv">500</span></span>
<span id="cb270-2"><a href="day-14.html#cb270-2"></a>phi_sim &lt;-<span class="st"> </span><span class="fl">0.99</span></span>
<span id="cb270-3"><a href="day-14.html#cb270-3"></a>sigma2_sim &lt;-<span class="st"> </span><span class="fl">1.2</span></span>
<span id="cb270-4"><a href="day-14.html#cb270-4"></a>y &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, N)</span>
<span id="cb270-5"><a href="day-14.html#cb270-5"></a><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>N) {</span>
<span id="cb270-6"><a href="day-14.html#cb270-6"></a>  y[t] &lt;-<span class="st"> </span>phi_sim <span class="op">*</span><span class="st"> </span>y[t<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="kw">sqrt</span>(sigma2_sim))</span>
<span id="cb270-7"><a href="day-14.html#cb270-7"></a>}</span>
<span id="cb270-8"><a href="day-14.html#cb270-8"></a><span class="kw">plot</span>(y, <span class="dt">type=</span><span class="st">&#39;l&#39;</span>, <span class="dt">xlab=</span><span class="st">&quot;time&quot;</span>, <span class="dt">main=</span><span class="st">&quot;simulated AR(1) data&quot;</span>)</span></code></pre></div>
<p><img src="14-day-14_files/figure-html/unnamed-chunk-2-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>To complete the model, we must assign prior distributions for <span class="math inline">\(\phi\)</span> and <span class="math inline">\(\sigma^2\)</span>. A simple choice of prior for <span class="math inline">\(\phi\)</span> is Uniform(-1, 1) prior and for <span class="math inline">\(\sigma^2\)</span> we assign a half-Cauchy prior where</p>
<p><span class="math display">\[\begin{align*}
\sigma^2 &amp; \sim \operatorname{Cauchy^+}(s^2)
\end{align*}\]</span>
with <span class="math inline">\(s^2\)</span>=25 where the half-Cauchy has the pdf
<span class="math display">\[\begin{align*}
[\sigma^2] = \frac{2 * I(\sigma^2 &gt; 0)}{\pi s (1 + \frac{\sigma^2}{s^2})}.
\end{align*}\]</span></p>
</div>
<div id="posterior" class="section level2">
<h2><span class="header-section-number">14.5</span> Posterior</h2>
<p>The posterior distribution is
<span class="math display">\[\begin{align*}
[\phi, \sigma^2 | \mathbf{y}] &amp; = \prod_{t=1}^N [y_t | y_{t-1}, \phi, \sigma^2] [\phi] [\sigma^2] 
\end{align*}\]</span></p>
</div>
<div id="conditional-posterior-for-phi" class="section level2">
<h2><span class="header-section-number">14.6</span> Conditional posterior for <span class="math inline">\(\phi\)</span></h2>
<p>The conditional posterior for <span class="math inline">\(\phi\)</span> is
<span class="math display">\[\begin{align*}
[\phi | \cdot] &amp; \propto \prod_{t=1^N} [y_t | y_{t-1}, \phi, \sigma^2] [\phi] \\
&amp; \propto \prod_{t=1^N} N(y_t | \phi y_{t-1}, \sigma^2 ) I(-1 &lt; \phi &lt; 1)
\end{align*}\]</span>}
which has no known analytic distribution so we will sample using Metropolis-Hastings.</p>
</div>
<div id="conditional-posterior-for-sigma2" class="section level2">
<h2><span class="header-section-number">14.7</span> Conditional posterior for <span class="math inline">\(\sigma^2\)</span></h2>
<p>The conditional posterior for <span class="math inline">\(\phi\)</span> is
<span class="math display">\[\begin{align*}
[\phi | \cdot] &amp; \propto \prod_{t=1^N} [y_t | y_{t-1}, \phi, \sigma^2] [\sigma^2] \\
&amp; \propto \prod_{t=1^N} N(y_t | \phi y_{t-1}, \sigma^2 ) \operatorname{Cauchy^+}(\sigma^2 | s^2)
\end{align*}\]</span>
which has no known analytic distribution so we will sample using Metropolis-Hastings.</p>
</div>
<div id="mcmc-using-a-symmetric-proposal-metropolis" class="section level2">
<h2><span class="header-section-number">14.8</span> MCMC using a symmetric proposal (Metropolis)</h2>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="day-14.html#cb271-1"></a><span class="kw">library</span>(LaplacesDemon)</span>
<span id="cb271-2"><a href="day-14.html#cb271-2"></a>K &lt;-<span class="st"> </span><span class="dv">5000</span></span>
<span id="cb271-3"><a href="day-14.html#cb271-3"></a>phi &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, N)</span>
<span id="cb271-4"><a href="day-14.html#cb271-4"></a>sigma2 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, N)</span>
<span id="cb271-5"><a href="day-14.html#cb271-5"></a></span>
<span id="cb271-6"><a href="day-14.html#cb271-6"></a><span class="co">## initialize phi and sigma2</span></span>
<span id="cb271-7"><a href="day-14.html#cb271-7"></a>phi[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">1</span>)</span>
<span id="cb271-8"><a href="day-14.html#cb271-8"></a>sigma2[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb271-9"><a href="day-14.html#cb271-9"></a></span>
<span id="cb271-10"><a href="day-14.html#cb271-10"></a><span class="co">## set the tuning parameters</span></span>
<span id="cb271-11"><a href="day-14.html#cb271-11"></a>phi_tune &lt;-<span class="st"> </span><span class="fl">0.0095</span></span>
<span id="cb271-12"><a href="day-14.html#cb271-12"></a>accept_phi &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb271-13"><a href="day-14.html#cb271-13"></a>sigma2_tune &lt;-<span class="st"> </span><span class="fl">0.125</span></span>
<span id="cb271-14"><a href="day-14.html#cb271-14"></a>accept_sigma2 &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb271-15"><a href="day-14.html#cb271-15"></a></span>
<span id="cb271-16"><a href="day-14.html#cb271-16"></a><span class="co">##</span></span>
<span id="cb271-17"><a href="day-14.html#cb271-17"></a><span class="co">## MCMC loop</span></span>
<span id="cb271-18"><a href="day-14.html#cb271-18"></a><span class="co">##</span></span>
<span id="cb271-19"><a href="day-14.html#cb271-19"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>K) {</span>
<span id="cb271-20"><a href="day-14.html#cb271-20"></a>  <span class="co">## sample phi</span></span>
<span id="cb271-21"><a href="day-14.html#cb271-21"></a>  phi_star &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, phi[k<span class="dv">-1</span>], phi_tune)</span>
<span id="cb271-22"><a href="day-14.html#cb271-22"></a>  <span class="co">## check to make sure phi_star is reasonable, if not, we reject and move on</span></span>
<span id="cb271-23"><a href="day-14.html#cb271-23"></a>  <span class="cf">if</span> (phi_star <span class="op">&gt;</span><span class="st"> </span><span class="dv">-1</span> <span class="op">&amp;</span><span class="st"> </span>phi_star <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb271-24"><a href="day-14.html#cb271-24"></a>    mh1 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dnorm</span>(y[<span class="dv">2</span><span class="op">:</span>N], phi_star <span class="op">*</span><span class="st"> </span>y[<span class="dv">1</span><span class="op">:</span>(N<span class="dv">-1</span>)], <span class="kw">sqrt</span>(sigma2[k<span class="dv">-1</span>]), <span class="dt">log=</span><span class="ot">TRUE</span>))</span>
<span id="cb271-25"><a href="day-14.html#cb271-25"></a>    mh2 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dnorm</span>(y[<span class="dv">2</span><span class="op">:</span>N], phi[k<span class="dv">-1</span>] <span class="op">*</span><span class="st"> </span>y[<span class="dv">1</span><span class="op">:</span>(N<span class="dv">-1</span>)], <span class="kw">sqrt</span>(sigma2[k<span class="dv">-1</span>]), <span class="dt">log=</span><span class="ot">TRUE</span>))</span>
<span id="cb271-26"><a href="day-14.html#cb271-26"></a>    a &lt;-<span class="st"> </span><span class="kw">exp</span>(mh1<span class="op">-</span>mh2)</span>
<span id="cb271-27"><a href="day-14.html#cb271-27"></a>    <span class="cf">if</span> (<span class="kw">runif</span>(<span class="dv">1</span>) <span class="op">&lt;</span><span class="st"> </span>a) {</span>
<span id="cb271-28"><a href="day-14.html#cb271-28"></a>      <span class="co">## accept the proposed value</span></span>
<span id="cb271-29"><a href="day-14.html#cb271-29"></a>      phi[k] &lt;-<span class="st"> </span>phi_star</span>
<span id="cb271-30"><a href="day-14.html#cb271-30"></a>      accept_phi &lt;-<span class="st"> </span>accept_phi <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>K</span>
<span id="cb271-31"><a href="day-14.html#cb271-31"></a>    } <span class="cf">else</span> {</span>
<span id="cb271-32"><a href="day-14.html#cb271-32"></a>      phi[k] &lt;-<span class="st"> </span>phi[k<span class="dv">-1</span>]</span>
<span id="cb271-33"><a href="day-14.html#cb271-33"></a>    }</span>
<span id="cb271-34"><a href="day-14.html#cb271-34"></a>  } <span class="cf">else</span> {</span>
<span id="cb271-35"><a href="day-14.html#cb271-35"></a>    <span class="co">## phi_star was outside the support, keep at the previous value</span></span>
<span id="cb271-36"><a href="day-14.html#cb271-36"></a>    phi[k] &lt;-<span class="st"> </span>phi[k<span class="dv">-1</span>]</span>
<span id="cb271-37"><a href="day-14.html#cb271-37"></a>  }</span>
<span id="cb271-38"><a href="day-14.html#cb271-38"></a></span>
<span id="cb271-39"><a href="day-14.html#cb271-39"></a>  <span class="co">## sample sigma2</span></span>
<span id="cb271-40"><a href="day-14.html#cb271-40"></a>  sigma2_star &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, sigma2[k<span class="dv">-1</span>], sigma2_tune)</span>
<span id="cb271-41"><a href="day-14.html#cb271-41"></a>  <span class="co">## check to make sure sigma2_star is reasonable, if not, we reject and move on</span></span>
<span id="cb271-42"><a href="day-14.html#cb271-42"></a>  <span class="cf">if</span> (sigma2_star <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb271-43"><a href="day-14.html#cb271-43"></a>    mh1 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dnorm</span>(y[<span class="dv">2</span><span class="op">:</span>N], phi[k] <span class="op">*</span><span class="st"> </span>y[<span class="dv">1</span><span class="op">:</span>(N<span class="dv">-1</span>)], <span class="kw">sqrt</span>(sigma2_star), <span class="dt">log=</span><span class="ot">TRUE</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb271-44"><a href="day-14.html#cb271-44"></a><span class="st">      </span><span class="kw">dhalfcauchy</span>(sigma2_star, <span class="kw">sqrt</span>(<span class="dv">25</span>), <span class="dt">log=</span><span class="ot">TRUE</span>)</span>
<span id="cb271-45"><a href="day-14.html#cb271-45"></a>    mh2 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dnorm</span>(y[<span class="dv">2</span><span class="op">:</span>N], phi[k] <span class="op">*</span><span class="st"> </span>y[<span class="dv">1</span><span class="op">:</span>(N<span class="dv">-1</span>)], <span class="kw">sqrt</span>(sigma2[k<span class="dv">-1</span>]), <span class="dt">log=</span><span class="ot">TRUE</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb271-46"><a href="day-14.html#cb271-46"></a><span class="st">      </span><span class="kw">dhalfcauchy</span>(sigma2[k<span class="dv">-1</span>], <span class="kw">sqrt</span>(<span class="dv">25</span>), <span class="dt">log=</span><span class="ot">TRUE</span>)</span>
<span id="cb271-47"><a href="day-14.html#cb271-47"></a>    a &lt;-<span class="st"> </span><span class="kw">exp</span>(mh1<span class="op">-</span>mh2)</span>
<span id="cb271-48"><a href="day-14.html#cb271-48"></a>    <span class="cf">if</span> (<span class="kw">runif</span>(<span class="dv">1</span>) <span class="op">&lt;</span><span class="st"> </span>a) {</span>
<span id="cb271-49"><a href="day-14.html#cb271-49"></a>      <span class="co">## accept the proposed value</span></span>
<span id="cb271-50"><a href="day-14.html#cb271-50"></a>      sigma2[k] &lt;-sigma2_star</span>
<span id="cb271-51"><a href="day-14.html#cb271-51"></a>      accept_sigma2 &lt;-<span class="st"> </span>accept_sigma2 <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>K</span>
<span id="cb271-52"><a href="day-14.html#cb271-52"></a>    } <span class="cf">else</span> {</span>
<span id="cb271-53"><a href="day-14.html#cb271-53"></a>      sigma2[k] &lt;-<span class="st"> </span>sigma2[k<span class="dv">-1</span>]</span>
<span id="cb271-54"><a href="day-14.html#cb271-54"></a>    }</span>
<span id="cb271-55"><a href="day-14.html#cb271-55"></a>  } <span class="cf">else</span> {</span>
<span id="cb271-56"><a href="day-14.html#cb271-56"></a>    <span class="co">## sigma2_star was outside the support, keep at the previous value</span></span>
<span id="cb271-57"><a href="day-14.html#cb271-57"></a>    sigma2[k] &lt;-<span class="st"> </span>sigma2[k<span class="dv">-1</span>]</span>
<span id="cb271-58"><a href="day-14.html#cb271-58"></a>  }</span>
<span id="cb271-59"><a href="day-14.html#cb271-59"></a>}</span></code></pre></div>
<p>The trace plots showing the parameter estimates, post burn-in, are below. From these, we see that the MCMC model is estimating the parameters reasonably.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="day-14.html#cb272-1"></a>burnin &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb272-2"><a href="day-14.html#cb272-2"></a>samples &lt;-<span class="st"> </span><span class="kw">cbind</span>(phi[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>burnin)], sigma2[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>burnin)])</span>
<span id="cb272-3"><a href="day-14.html#cb272-3"></a><span class="kw">colnames</span>(samples) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;phi&quot;</span>, <span class="st">&quot;sigma2&quot;</span>)</span>
<span id="cb272-4"><a href="day-14.html#cb272-4"></a></span>
<span id="cb272-5"><a href="day-14.html#cb272-5"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb272-6"><a href="day-14.html#cb272-6"></a><span class="kw">plot</span>(samples[, <span class="st">&quot;phi&quot;</span>], <span class="dt">type=</span><span class="st">&#39;l&#39;</span>,</span>
<span id="cb272-7"><a href="day-14.html#cb272-7"></a>     <span class="dt">main=</span><span class="kw">paste0</span>(<span class="st">&quot;Trace plot for phi, acceptance=&quot;</span>, <span class="kw">round</span>(accept_phi, <span class="dt">digits=</span><span class="dv">2</span>)))</span>
<span id="cb272-8"><a href="day-14.html#cb272-8"></a><span class="kw">abline</span>(<span class="dt">h=</span>phi_sim, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb272-9"><a href="day-14.html#cb272-9"></a><span class="kw">plot</span>(samples[, <span class="st">&quot;sigma2&quot;</span>], <span class="dt">type=</span><span class="st">&#39;l&#39;</span>,</span>
<span id="cb272-10"><a href="day-14.html#cb272-10"></a>     <span class="dt">main=</span><span class="kw">paste0</span>(<span class="st">&quot;Trace plot for sigma2, acceptance=&quot;</span>, <span class="kw">round</span>(accept_sigma2, <span class="dt">digits=</span><span class="dv">2</span>)))</span>
<span id="cb272-11"><a href="day-14.html#cb272-11"></a><span class="kw">abline</span>(<span class="dt">h=</span>sigma2_sim, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="14-day-14_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="day-14.html#cb273-1"></a><span class="kw">library</span>(coda)</span>
<span id="cb273-2"><a href="day-14.html#cb273-2"></a><span class="kw">effectiveSize</span>(samples)</span></code></pre></div>
<pre><code>##      phi   sigma2 
## 883.5439 839.2284</code></pre>
<p>In the model above, we used <strong>symmetric</strong> proposals and threw out parameter values that were outside the allowable range. Because <span class="math inline">\(\phi\)</span> has a true value close to the limit of allowable values, the Metropolis algorithm could be very inefficient. To improve efficiency, let’s rewrite the algorithm using truncated normal proposals (which are <strong>asymmetric</strong>).</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="day-14.html#cb275-1"></a><span class="kw">library</span>(LaplacesDemon)</span>
<span id="cb275-2"><a href="day-14.html#cb275-2"></a><span class="kw">library</span>(truncnorm)</span>
<span id="cb275-3"><a href="day-14.html#cb275-3"></a>K &lt;-<span class="st"> </span><span class="dv">25000</span></span>
<span id="cb275-4"><a href="day-14.html#cb275-4"></a>phi &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, N)</span>
<span id="cb275-5"><a href="day-14.html#cb275-5"></a>sigma2 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, N)</span>
<span id="cb275-6"><a href="day-14.html#cb275-6"></a></span>
<span id="cb275-7"><a href="day-14.html#cb275-7"></a><span class="co">## initialize phi and sigma2</span></span>
<span id="cb275-8"><a href="day-14.html#cb275-8"></a>phi[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">-1</span>, <span class="dv">1</span>)</span>
<span id="cb275-9"><a href="day-14.html#cb275-9"></a>sigma2[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb275-10"><a href="day-14.html#cb275-10"></a></span>
<span id="cb275-11"><a href="day-14.html#cb275-11"></a><span class="co">## set the tuning parameters</span></span>
<span id="cb275-12"><a href="day-14.html#cb275-12"></a>phi_tune &lt;-<span class="st"> </span><span class="fl">0.0175</span></span>
<span id="cb275-13"><a href="day-14.html#cb275-13"></a>accept_phi &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb275-14"><a href="day-14.html#cb275-14"></a>sigma2_tune &lt;-<span class="st"> </span><span class="fl">0.175</span></span>
<span id="cb275-15"><a href="day-14.html#cb275-15"></a>accept_sigma2 &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb275-16"><a href="day-14.html#cb275-16"></a></span>
<span id="cb275-17"><a href="day-14.html#cb275-17"></a><span class="co">##</span></span>
<span id="cb275-18"><a href="day-14.html#cb275-18"></a><span class="co">## MCMC loop</span></span>
<span id="cb275-19"><a href="day-14.html#cb275-19"></a><span class="co">##</span></span>
<span id="cb275-20"><a href="day-14.html#cb275-20"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span>K) {</span>
<span id="cb275-21"><a href="day-14.html#cb275-21"></a>  <span class="co">## sample phi</span></span>
<span id="cb275-22"><a href="day-14.html#cb275-22"></a>  <span class="co">## use truncated normal proposal</span></span>
<span id="cb275-23"><a href="day-14.html#cb275-23"></a>  phi_star &lt;-<span class="st"> </span><span class="kw">rtruncnorm</span>(<span class="dv">1</span>, <span class="dt">a=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">b=</span><span class="dv">1</span>, phi[k<span class="dv">-1</span>], phi_tune)</span>
<span id="cb275-24"><a href="day-14.html#cb275-24"></a>  <span class="co">## No need to check if phi_star is between -1 and 1 </span></span>
<span id="cb275-25"><a href="day-14.html#cb275-25"></a>  mh1 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dnorm</span>(y[<span class="dv">2</span><span class="op">:</span>N], phi_star <span class="op">*</span><span class="st"> </span>y[<span class="dv">1</span><span class="op">:</span>(N<span class="dv">-1</span>)], <span class="kw">sqrt</span>(sigma2[k<span class="dv">-1</span>]), <span class="dt">log=</span><span class="ot">TRUE</span>)) <span class="op">+</span></span>
<span id="cb275-26"><a href="day-14.html#cb275-26"></a><span class="st">    </span><span class="kw">log</span>(<span class="kw">dtruncnorm</span>(phi[k<span class="dv">-1</span>], <span class="dt">a=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">b=</span><span class="dv">1</span>, phi_star, phi_tune))</span>
<span id="cb275-27"><a href="day-14.html#cb275-27"></a>  mh2 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dnorm</span>(y[<span class="dv">2</span><span class="op">:</span>N], phi[k<span class="dv">-1</span>] <span class="op">*</span><span class="st"> </span>y[<span class="dv">1</span><span class="op">:</span>(N<span class="dv">-1</span>)], <span class="kw">sqrt</span>(sigma2[k<span class="dv">-1</span>]), <span class="dt">log=</span><span class="ot">TRUE</span>)) <span class="op">+</span></span>
<span id="cb275-28"><a href="day-14.html#cb275-28"></a><span class="st">    </span><span class="kw">log</span>(<span class="kw">dtruncnorm</span>(phi_star, <span class="dt">a=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">b=</span><span class="dv">1</span>, phi[k<span class="dv">-1</span>], phi_tune))</span>
<span id="cb275-29"><a href="day-14.html#cb275-29"></a>  a &lt;-<span class="st"> </span><span class="kw">exp</span>(mh1<span class="op">-</span>mh2)</span>
<span id="cb275-30"><a href="day-14.html#cb275-30"></a>  <span class="cf">if</span> (<span class="kw">runif</span>(<span class="dv">1</span>) <span class="op">&lt;</span><span class="st"> </span>a) {</span>
<span id="cb275-31"><a href="day-14.html#cb275-31"></a>    <span class="co">## accept the proposed value</span></span>
<span id="cb275-32"><a href="day-14.html#cb275-32"></a>    phi[k] &lt;-<span class="st"> </span>phi_star</span>
<span id="cb275-33"><a href="day-14.html#cb275-33"></a>    accept_phi &lt;-<span class="st"> </span>accept_phi <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>K</span>
<span id="cb275-34"><a href="day-14.html#cb275-34"></a>  } <span class="cf">else</span> {</span>
<span id="cb275-35"><a href="day-14.html#cb275-35"></a>    phi[k] &lt;-<span class="st"> </span>phi[k<span class="dv">-1</span>]</span>
<span id="cb275-36"><a href="day-14.html#cb275-36"></a>  }</span>
<span id="cb275-37"><a href="day-14.html#cb275-37"></a></span>
<span id="cb275-38"><a href="day-14.html#cb275-38"></a>  <span class="co">## sample sigma2</span></span>
<span id="cb275-39"><a href="day-14.html#cb275-39"></a>  sigma2_star &lt;-<span class="st"> </span><span class="kw">rtruncnorm</span>(<span class="dv">1</span>, <span class="dt">a=</span><span class="dv">0</span>, <span class="dt">b=</span><span class="ot">Inf</span>, sigma2[k<span class="dv">-1</span>], sigma2_tune)</span>
<span id="cb275-40"><a href="day-14.html#cb275-40"></a>  <span class="co">## No need to check to make sure sigma2_star is positive</span></span>
<span id="cb275-41"><a href="day-14.html#cb275-41"></a>  mh1 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dnorm</span>(y[<span class="dv">2</span><span class="op">:</span>N], phi[k] <span class="op">*</span><span class="st"> </span>y[<span class="dv">1</span><span class="op">:</span>(N<span class="dv">-1</span>)], <span class="kw">sqrt</span>(sigma2_star), <span class="dt">log=</span><span class="ot">TRUE</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb275-42"><a href="day-14.html#cb275-42"></a><span class="st">    </span><span class="kw">dhalfcauchy</span>(sigma2_star, <span class="kw">sqrt</span>(<span class="dv">25</span>), <span class="dt">log=</span><span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb275-43"><a href="day-14.html#cb275-43"></a><span class="st">    </span><span class="kw">log</span>(<span class="kw">dtruncnorm</span>(sigma2[k<span class="dv">-1</span>], <span class="dt">a=</span><span class="dv">0</span>, <span class="dt">b=</span><span class="ot">Inf</span>, sigma2_star, sigma2_tune))</span>
<span id="cb275-44"><a href="day-14.html#cb275-44"></a>  mh2 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dnorm</span>(y[<span class="dv">2</span><span class="op">:</span>N], phi[k] <span class="op">*</span><span class="st"> </span>y[<span class="dv">1</span><span class="op">:</span>(N<span class="dv">-1</span>)], <span class="kw">sqrt</span>(sigma2[k<span class="dv">-1</span>]), <span class="dt">log=</span><span class="ot">TRUE</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb275-45"><a href="day-14.html#cb275-45"></a><span class="st">    </span><span class="kw">dhalfcauchy</span>(sigma2[k<span class="dv">-1</span>], <span class="kw">sqrt</span>(<span class="dv">25</span>), <span class="dt">log=</span><span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb275-46"><a href="day-14.html#cb275-46"></a><span class="st">    </span><span class="kw">log</span>(<span class="kw">dtruncnorm</span>(sigma2_star, <span class="dt">a=</span><span class="dv">0</span>, <span class="dt">b=</span><span class="ot">Inf</span>, sigma2[k<span class="dv">-1</span>], sigma2_tune))</span>
<span id="cb275-47"><a href="day-14.html#cb275-47"></a>  a &lt;-<span class="st"> </span><span class="kw">exp</span>(mh1<span class="op">-</span>mh2)</span>
<span id="cb275-48"><a href="day-14.html#cb275-48"></a>  <span class="cf">if</span> (<span class="kw">runif</span>(<span class="dv">1</span>) <span class="op">&lt;</span><span class="st"> </span>a) {</span>
<span id="cb275-49"><a href="day-14.html#cb275-49"></a>    <span class="co">## accept the proposed value</span></span>
<span id="cb275-50"><a href="day-14.html#cb275-50"></a>    sigma2[k] &lt;-sigma2_star</span>
<span id="cb275-51"><a href="day-14.html#cb275-51"></a>    accept_sigma2 &lt;-<span class="st"> </span>accept_sigma2 <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>K</span>
<span id="cb275-52"><a href="day-14.html#cb275-52"></a>  } <span class="cf">else</span> {</span>
<span id="cb275-53"><a href="day-14.html#cb275-53"></a>    sigma2[k] &lt;-<span class="st"> </span>sigma2[k<span class="dv">-1</span>]</span>
<span id="cb275-54"><a href="day-14.html#cb275-54"></a>  }</span>
<span id="cb275-55"><a href="day-14.html#cb275-55"></a>}</span></code></pre></div>
<p>The trace plots below show the increased efficiency in the acceptance rate at the same tuning parameter value and show better effective sample size.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="day-14.html#cb276-1"></a>burnin &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb276-2"><a href="day-14.html#cb276-2"></a>samples &lt;-<span class="st"> </span><span class="kw">cbind</span>(phi[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>burnin)], sigma2[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>burnin)])</span>
<span id="cb276-3"><a href="day-14.html#cb276-3"></a><span class="kw">colnames</span>(samples) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;phi&quot;</span>, <span class="st">&quot;sigma2&quot;</span>)</span>
<span id="cb276-4"><a href="day-14.html#cb276-4"></a></span>
<span id="cb276-5"><a href="day-14.html#cb276-5"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb276-6"><a href="day-14.html#cb276-6"></a><span class="kw">plot</span>(samples[, <span class="st">&quot;phi&quot;</span>], <span class="dt">type=</span><span class="st">&#39;l&#39;</span>,</span>
<span id="cb276-7"><a href="day-14.html#cb276-7"></a>     <span class="dt">main=</span><span class="kw">paste0</span>(<span class="st">&quot;Trace plot for phi, acceptance=&quot;</span>, <span class="kw">round</span>(accept_phi, <span class="dt">digits=</span><span class="dv">2</span>)))</span>
<span id="cb276-8"><a href="day-14.html#cb276-8"></a><span class="kw">abline</span>(<span class="dt">h=</span>phi_sim, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb276-9"><a href="day-14.html#cb276-9"></a><span class="kw">plot</span>(samples[, <span class="st">&quot;sigma2&quot;</span>], <span class="dt">type=</span><span class="st">&#39;l&#39;</span>,</span>
<span id="cb276-10"><a href="day-14.html#cb276-10"></a>     <span class="dt">main=</span><span class="kw">paste0</span>(<span class="st">&quot;Trace plot for sigma2, acceptance=&quot;</span>, <span class="kw">round</span>(accept_sigma2, <span class="dt">digits=</span><span class="dv">2</span>)))</span>
<span id="cb276-11"><a href="day-14.html#cb276-11"></a><span class="kw">abline</span>(<span class="dt">h=</span>sigma2_sim, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="14-day-14_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="day-14.html#cb277-1"></a><span class="kw">hist</span>(samples[,<span class="st">&quot;phi&quot;</span>], <span class="dt">breaks=</span><span class="dv">100</span>)</span>
<span id="cb277-2"><a href="day-14.html#cb277-2"></a><span class="kw">abline</span>(<span class="dt">v=</span>phi_sim, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb277-3"><a href="day-14.html#cb277-3"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="kw">mean</span>(samples[, <span class="st">&quot;phi&quot;</span>]), <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb277-4"><a href="day-14.html#cb277-4"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="kw">quantile</span>(samples[, <span class="st">&quot;phi&quot;</span>], <span class="dt">prob=</span><span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)), <span class="dt">col=</span><span class="st">&quot;green&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb277-5"><a href="day-14.html#cb277-5"></a></span>
<span id="cb277-6"><a href="day-14.html#cb277-6"></a><span class="kw">hist</span>(samples[,<span class="st">&quot;sigma2&quot;</span>], <span class="dt">breaks=</span><span class="dv">100</span>)</span>
<span id="cb277-7"><a href="day-14.html#cb277-7"></a><span class="kw">abline</span>(<span class="dt">v=</span>sigma2_sim, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb277-8"><a href="day-14.html#cb277-8"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="kw">mean</span>(samples[, <span class="st">&quot;sigma2&quot;</span>]), <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb277-9"><a href="day-14.html#cb277-9"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="kw">quantile</span>(samples[, <span class="st">&quot;sigma2&quot;</span>], <span class="dt">prob=</span><span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)), <span class="dt">col=</span><span class="st">&quot;green&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb277-10"><a href="day-14.html#cb277-10"></a><span class="kw">library</span>(coda)</span>
<span id="cb277-11"><a href="day-14.html#cb277-11"></a><span class="kw">effectiveSize</span>(samples)</span></code></pre></div>
<pre><code>##      phi   sigma2 
## 5869.855 5463.560</code></pre>
<p><img src="14-day-14_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;" /><img src="14-day-14_files/figure-html/unnamed-chunk-8-2.png" width="480" style="display: block; margin: auto;" /></p>

</div>
</div>

<script type="text/javascript">
$(document).ready(function() {
  $folds = $(".fold-solution");
  $folds.wrapInner("<div class=\"fold-solution-blck\">"); // wrap a div container around content
  $folds.prepend("<button class=\"fold-solution-btn\">Show Solution</button>");  // add a button
  $(".fold-solution-blck").toggle();  // fold all blocks
  $(".fold-solution-btn").on("click", function() {  // add onClick event
    $(this).text($(this).text() === "Hide Solution" ? "Show Solution" : "Hide Solution");  // if the text equals "Fold", change it to "Unfold"or else to "Fold" 
    $(this).next(".fold-solution-blck").toggle("linear");  // "swing" is the default easing function. This can be further customized in its speed or the overall animation itself.
  })
});
</script>





<script type="text/javascript">
$(document).ready(function() {
  $folds = $(".fold-proof");
  $folds.wrapInner("<div class=\"fold-proof-blck\">"); // wrap a div container around content
  $folds.prepend("<button class=\"fold-proof-btn\">Show Proof</button>");  // add a button
  $(".fold-proof-blck").toggle();  // fold all blocks
  $(".fold-proof-btn").on("click", function() {  // add onClick event
    $(this).text($(this).text() === "Hide Proof" ? "Show Proof" : "Hide Proof");  // if the text equals "Fold", change it to "Unfold"or else to "Fold" 
    $(this).next(".fold-proof-blck").toggle("linear");  // "swing" is the default easing function. This can be further customized in its speed or the overall animation itself.
  })
});
</script>
            </section>

          </div>
        </div>
      </div>
<a href="day-13.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="day-15.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["STAT-5413.pdf", "STAT-5413.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
