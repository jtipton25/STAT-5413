<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter8 Day 8 | Notes for STAT 5413 - Spatial Statistics</title>
  <meta name="description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  <meta name="generator" content="bookdown 0.24.3 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter8 Day 8 | Notes for STAT 5413 - Spatial Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter8 Day 8 | Notes for STAT 5413 - Spatial Statistics" />
  
  <meta name="twitter:description" content="These are the lecture notes for STAT 5413 Spatial Statistics" />
  

<meta name="author" content="John Tipton" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="day-7.html"/>
<link rel="next" href="day-9.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.19/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">STAT 5413 Spatial Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="day-1.html"><a href="day-1.html"><i class="fa fa-check"></i><b>1</b> Day 1</a><ul>
<li class="chapter" data-level="1.1" data-path="day-1.html"><a href="day-1.html#notation"><i class="fa fa-check"></i><b>1.1</b> Notation</a></li>
<li class="chapter" data-level="1.2" data-path="day-1.html"><a href="day-1.html#probability-distributions"><i class="fa fa-check"></i><b>1.2</b> Probability Distributions</a><ul>
<li class="chapter" data-level="1.2.1" data-path="day-1.html"><a href="day-1.html#example-linear-regression"><i class="fa fa-check"></i><b>1.2.1</b> Example: linear regression</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="day-1.html"><a href="day-1.html#hierarchical-modeling"><i class="fa fa-check"></i><b>1.3</b> Hierarchical modeling</a><ul>
<li class="chapter" data-level="1.3.1" data-path="day-1.html"><a href="day-1.html#bayesian-hierarchical-models-bhms"><i class="fa fa-check"></i><b>1.3.1</b> Bayesian Hierarchical models (BHMs)</a></li>
<li class="chapter" data-level="1.3.2" data-path="day-1.html"><a href="day-1.html#empirical-hierarchical-models-ehms"><i class="fa fa-check"></i><b>1.3.2</b> Empirical Hierarchical models (EHMs)</a></li>
<li class="chapter" data-level="1.3.3" data-path="day-1.html"><a href="day-1.html#data-model"><i class="fa fa-check"></i><b>1.3.3</b> Data Model</a></li>
<li class="chapter" data-level="1.3.4" data-path="day-1.html"><a href="day-1.html#process-model"><i class="fa fa-check"></i><b>1.3.4</b> Process Model</a></li>
<li class="chapter" data-level="1.3.5" data-path="day-1.html"><a href="day-1.html#parameter-prior-model-bmhs-only"><i class="fa fa-check"></i><b>1.3.5</b> Parameter (Prior) Model (BMHs only)</a></li>
<li class="chapter" data-level="1.3.6" data-path="day-1.html"><a href="day-1.html#posterior-distribution"><i class="fa fa-check"></i><b>1.3.6</b> Posterior Distribution</a></li>
<li class="chapter" data-level="1.3.7" data-path="day-1.html"><a href="day-1.html#scientifically-motivated-statistical-modeling"><i class="fa fa-check"></i><b>1.3.7</b> Scientifically Motivated Statistical Modeling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="day-2.html"><a href="day-2.html"><i class="fa fa-check"></i><b>2</b> Day 2</a><ul>
<li class="chapter" data-level="2.1" data-path="day-2.html"><a href="day-2.html#spatial-data"><i class="fa fa-check"></i><b>2.1</b> Spatial Data</a></li>
<li class="chapter" data-level="2.2" data-path="day-2.html"><a href="day-2.html#types-of-spatial-data"><i class="fa fa-check"></i><b>2.2</b> Types of spatial data</a><ul>
<li class="chapter" data-level="2.2.1" data-path="day-2.html"><a href="day-2.html#geostatistical-data"><i class="fa fa-check"></i><b>2.2.1</b> Geostatistical data</a></li>
<li class="chapter" data-level="2.2.2" data-path="day-2.html"><a href="day-2.html#areal-data"><i class="fa fa-check"></i><b>2.2.2</b> Areal data</a></li>
<li class="chapter" data-level="2.2.3" data-path="day-2.html"><a href="day-2.html#point-process-data"><i class="fa fa-check"></i><b>2.2.3</b> Point process data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="day-3.html"><a href="day-3.html"><i class="fa fa-check"></i><b>3</b> Day 3</a><ul>
<li class="chapter" data-level="3.1" data-path="day-3.html"><a href="day-3.html#anouncements"><i class="fa fa-check"></i><b>3.1</b> Anouncements</a></li>
<li class="chapter" data-level="3.2" data-path="day-3.html"><a href="day-3.html#files-for-spatial-data"><i class="fa fa-check"></i><b>3.2</b> Files for spatial data</a></li>
<li class="chapter" data-level="3.3" data-path="day-3.html"><a href="day-3.html#textbook-package"><i class="fa fa-check"></i><b>3.3</b> Textbook package</a></li>
<li class="chapter" data-level="3.4" data-path="day-3.html"><a href="day-3.html#spatial-visualization"><i class="fa fa-check"></i><b>3.4</b> Spatial Visualization</a><ul>
<li class="chapter" data-level="3.4.1" data-path="day-3.html"><a href="day-3.html#spatial-visualization-using-fields"><i class="fa fa-check"></i><b>3.4.1</b> Spatial visualization using <em>fields</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="day-4.html"><a href="day-4.html"><i class="fa fa-check"></i><b>4</b> Day 4</a><ul>
<li class="chapter" data-level="4.1" data-path="day-4.html"><a href="day-4.html#announcements"><i class="fa fa-check"></i><b>4.1</b> Announcements</a></li>
<li class="chapter" data-level="4.2" data-path="day-4.html"><a href="day-4.html#visualization-continued"><i class="fa fa-check"></i><b>4.2</b> Visualization (continued)</a><ul>
<li class="chapter" data-level="4.2.1" data-path="day-4.html"><a href="day-4.html#spatial-visualization-using-fields-1"><i class="fa fa-check"></i><b>4.2.1</b> Spatial visualization using <em>fields</em></a></li>
<li class="chapter" data-level="4.2.2" data-path="day-4.html"><a href="day-4.html#in-class-activity"><i class="fa fa-check"></i><b>4.2.2</b> In Class Activity:</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="day-4.html"><a href="day-4.html#interactive-visualization-interactive-with-html-format-only"><i class="fa fa-check"></i><b>4.3</b> Interactive visualization (Interactive with HTML format only)</a><ul>
<li class="chapter" data-level="4.3.1" data-path="day-4.html"><a href="day-4.html#interactive-display-of-data"><i class="fa fa-check"></i><b>4.3.1</b> Interactive display of data</a></li>
<li class="chapter" data-level="4.3.2" data-path="day-4.html"><a href="day-4.html#animations"><i class="fa fa-check"></i><b>4.3.2</b> Animations</a></li>
<li class="chapter" data-level="4.3.3" data-path="day-4.html"><a href="day-4.html#interactive-plotting-using-plotly"><i class="fa fa-check"></i><b>4.3.3</b> Interactive plotting using <em>plotly</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="day-5.html"><a href="day-5.html"><i class="fa fa-check"></i><b>5</b> Day 5</a><ul>
<li class="chapter" data-level="5.1" data-path="day-5.html"><a href="day-5.html#announcements-1"><i class="fa fa-check"></i><b>5.1</b> Announcements</a></li>
<li class="chapter" data-level="5.2" data-path="day-5.html"><a href="day-5.html#spatial-means-and-covariances"><i class="fa fa-check"></i><b>5.2</b> Spatial means and covariances</a><ul>
<li class="chapter" data-level="5.2.1" data-path="day-5.html"><a href="day-5.html#gaussian-processes"><i class="fa fa-check"></i><b>5.2.1</b> Gaussian processes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="day-6.html"><a href="day-6.html"><i class="fa fa-check"></i><b>6</b> Day 6</a><ul>
<li class="chapter" data-level="6.1" data-path="day-6.html"><a href="day-6.html#announcements-2"><i class="fa fa-check"></i><b>6.1</b> Announcements</a></li>
<li class="chapter" data-level="6.2" data-path="day-6.html"><a href="day-6.html#gaussian-process-assumptions"><i class="fa fa-check"></i><b>6.2</b> Gaussian process assumptions</a></li>
<li class="chapter" data-level="6.3" data-path="day-6.html"><a href="day-6.html#recall-hierachical-modeling"><i class="fa fa-check"></i><b>6.3</b> Recall Hierachical modeling</a><ul>
<li class="chapter" data-level="6.3.1" data-path="day-6.html"><a href="day-6.html#data-model-1"><i class="fa fa-check"></i><b>6.3.1</b> Data Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="day-7.html"><a href="day-7.html"><i class="fa fa-check"></i><b>7</b> Day 7</a><ul>
<li class="chapter" data-level="7.1" data-path="day-7.html"><a href="day-7.html#common-isotropic-correlation-functions"><i class="fa fa-check"></i><b>7.1</b> Common isotropic correlation functions</a></li>
<li class="chapter" data-level="7.2" data-path="day-7.html"><a href="day-7.html#covariograms-and-semivariograms"><i class="fa fa-check"></i><b>7.2</b> Covariograms and semivariograms</a><ul>
<li class="chapter" data-level="7.2.1" data-path="day-7.html"><a href="day-7.html#semivariograms-and-variograms"><i class="fa fa-check"></i><b>7.2.1</b> Semivariograms and variograms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="day-8.html"><a href="day-8.html"><i class="fa fa-check"></i><b>8</b> Day 8</a><ul>
<li class="chapter" data-level="8.1" data-path="day-8.html"><a href="day-8.html#announcements-3"><i class="fa fa-check"></i><b>8.1</b> Announcements</a></li>
<li class="chapter" data-level="8.2" data-path="day-8.html"><a href="day-8.html#estimation-of-the-spatial-process"><i class="fa fa-check"></i><b>8.2</b> Estimation of the spatial process</a><ul>
<li class="chapter" data-level="8.2.1" data-path="day-8.html"><a href="day-8.html#estimation-of-the-spatial-process-using-variograms"><i class="fa fa-check"></i><b>8.2.1</b> Estimation of the spatial process using variograms</a></li>
<li class="chapter" data-level="8.2.2" data-path="day-8.html"><a href="day-8.html#maximum-likelihood"><i class="fa fa-check"></i><b>8.2.2</b> Maximum Likelihood</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="day-8.html"><a href="day-8.html#maximum-likelihood-1"><i class="fa fa-check"></i><b>8.3</b> Maximum likelihood</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="day-9.html"><a href="day-9.html"><i class="fa fa-check"></i><b>9</b> Day 9</a><ul>
<li class="chapter" data-level="9.1" data-path="day-9.html"><a href="day-9.html#announcements-4"><i class="fa fa-check"></i><b>9.1</b> Announcements</a></li>
<li class="chapter" data-level="9.2" data-path="day-9.html"><a href="day-9.html#asymptotic-properties-of-the-mle"><i class="fa fa-check"></i><b>9.2</b> Asymptotic properties of the MLE</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="day-10.html"><a href="day-10.html"><i class="fa fa-check"></i><b>10</b> Day 10</a><ul>
<li class="chapter" data-level="10.1" data-path="day-10.html"><a href="day-10.html#announcements-5"><i class="fa fa-check"></i><b>10.1</b> Announcements</a></li>
<li class="chapter" data-level="10.2" data-path="day-10.html"><a href="day-10.html#asymptotic-properties-of-the-mle-1"><i class="fa fa-check"></i><b>10.2</b> Asymptotic properties of the MLE</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="day-11.html"><a href="day-11.html"><i class="fa fa-check"></i><b>11</b> Day 11</a><ul>
<li class="chapter" data-level="11.1" data-path="day-11.html"><a href="day-11.html#announcements-6"><i class="fa fa-check"></i><b>11.1</b> Announcements</a></li>
<li class="chapter" data-level="11.2" data-path="day-11.html"><a href="day-11.html#example-spatial-analysis"><i class="fa fa-check"></i><b>11.2</b> Example spatial analysis</a></li>
<li class="chapter" data-level="11.3" data-path="day-11.html"><a href="day-11.html#spatial-model-fitting"><i class="fa fa-check"></i><b>11.3</b> Spatial model fitting</a><ul>
<li class="chapter" data-level="11.3.1" data-path="day-11.html"><a href="day-11.html#fit-the-maximum-likelihood-estimate-using-the-geor-package"><i class="fa fa-check"></i><b>11.3.1</b> Fit the maximum likelihood estimate using the <em>geoR</em> package</a></li>
<li class="chapter" data-level="11.3.2" data-path="day-11.html"><a href="day-11.html#fitting-a-spatial-model-using-the-nlme-package"><i class="fa fa-check"></i><b>11.3.2</b> Fitting a spatial model using the <em>nlme</em> package</a></li>
<li class="chapter" data-level="11.3.3" data-path="day-11.html"><a href="day-11.html#model-fitting-with-autokrige-function"><i class="fa fa-check"></i><b>11.3.3</b> model fitting with <em>autokrige</em> function</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="day-11.html"><a href="day-11.html#kriging"><i class="fa fa-check"></i><b>11.4</b> Kriging</a><ul>
<li class="chapter" data-level="11.4.1" data-path="day-11.html"><a href="day-11.html#kriging-equations-with-mean-mu-0"><i class="fa fa-check"></i><b>11.4.1</b> Kriging Equations with mean <span class="math inline">\(\mu = 0\)</span></a></li>
<li class="chapter" data-level="11.4.2" data-path="day-11.html"><a href="day-11.html#kriging-equations-with-unknown-mean"><i class="fa fa-check"></i><b>11.4.2</b> Kriging Equations with unknown mean</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="day-12.html"><a href="day-12.html"><i class="fa fa-check"></i><b>12</b> Day 12</a><ul>
<li class="chapter" data-level="12.1" data-path="day-12.html"><a href="day-12.html#announcements-7"><i class="fa fa-check"></i><b>12.1</b> Announcements</a></li>
<li class="chapter" data-level="12.2" data-path="day-12.html"><a href="day-12.html#introduction-to-mcmc"><i class="fa fa-check"></i><b>12.2</b> Introduction to MCMC</a></li>
<li class="chapter" data-level="12.3" data-path="day-12.html"><a href="day-12.html#example-simple-linear-regression"><i class="fa fa-check"></i><b>12.3</b> Example: Simple linear regression</a></li>
<li class="chapter" data-level="12.4" data-path="day-12.html"><a href="day-12.html#the-posterior-distribution"><i class="fa fa-check"></i><b>12.4</b> The posterior distribution</a><ul>
<li class="chapter" data-level="12.4.1" data-path="day-12.html"><a href="day-12.html#full-conditional-distribution-of-mu"><i class="fa fa-check"></i><b>12.4.1</b> Full conditional distribution of <span class="math inline">\(\mu\)</span></a></li>
<li class="chapter" data-level="12.4.2" data-path="day-12.html"><a href="day-12.html#full-conditional-distribution-for-beta"><i class="fa fa-check"></i><b>12.4.2</b> Full conditional distribution for <span class="math inline">\(\beta\)</span></a></li>
<li class="chapter" data-level="12.4.3" data-path="day-12.html"><a href="day-12.html#full-conditional-distribution-for-sigma2"><i class="fa fa-check"></i><b>12.4.3</b> Full conditional distribution for <span class="math inline">\(\sigma^2\)</span></a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="day-12.html"><a href="day-12.html#fitting-the-model"><i class="fa fa-check"></i><b>12.5</b> Fitting the model</a><ul>
<li class="chapter" data-level="12.5.1" data-path="day-12.html"><a href="day-12.html#general-recommendations-for-writing-mcmc-software"><i class="fa fa-check"></i><b>12.5.1</b> General recommendations for writing MCMC software</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="day-13.html"><a href="day-13.html"><i class="fa fa-check"></i><b>13</b> Day 13</a><ul>
<li class="chapter" data-level="13.1" data-path="day-13.html"><a href="day-13.html#announcements-8"><i class="fa fa-check"></i><b>13.1</b> Announcements</a></li>
<li class="chapter" data-level="13.2" data-path="day-13.html"><a href="day-13.html#the-metropolis-algorithm"><i class="fa fa-check"></i><b>13.2</b> The Metropolis Algorithm</a></li>
<li class="chapter" data-level="13.3" data-path="day-13.html"><a href="day-13.html#the-proposal-distribution"><i class="fa fa-check"></i><b>13.3</b> The proposal distribution</a></li>
<li class="chapter" data-level="13.4" data-path="day-13.html"><a href="day-13.html#the-metropolis-update"><i class="fa fa-check"></i><b>13.4</b> The Metropolis update</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="day-14.html"><a href="day-14.html"><i class="fa fa-check"></i><b>14</b> Day 14</a><ul>
<li class="chapter" data-level="14.1" data-path="day-14.html"><a href="day-14.html#announcements-9"><i class="fa fa-check"></i><b>14.1</b> Announcements</a></li>
<li class="chapter" data-level="14.2" data-path="day-14.html"><a href="day-14.html#the-metropolis-hastings-algorithm"><i class="fa fa-check"></i><b>14.2</b> The Metropolis-Hastings Algorithm</a></li>
<li class="chapter" data-level="14.3" data-path="day-14.html"><a href="day-14.html#the-metropolis-hastings-algorithm-1"><i class="fa fa-check"></i><b>14.3</b> The Metropolis-Hastings algorithm</a></li>
<li class="chapter" data-level="14.4" data-path="day-14.html"><a href="day-14.html#example-1"><i class="fa fa-check"></i><b>14.4</b> Example</a></li>
<li class="chapter" data-level="14.5" data-path="day-14.html"><a href="day-14.html#posterior"><i class="fa fa-check"></i><b>14.5</b> Posterior</a></li>
<li class="chapter" data-level="14.6" data-path="day-14.html"><a href="day-14.html#conditional-posterior-for-phi"><i class="fa fa-check"></i><b>14.6</b> Conditional posterior for <span class="math inline">\(\phi\)</span></a></li>
<li class="chapter" data-level="14.7" data-path="day-14.html"><a href="day-14.html#conditional-posterior-for-sigma2"><i class="fa fa-check"></i><b>14.7</b> Conditional posterior for <span class="math inline">\(\sigma^2\)</span></a></li>
<li class="chapter" data-level="14.8" data-path="day-14.html"><a href="day-14.html#mcmc-using-a-symmetric-proposal-metropolis"><i class="fa fa-check"></i><b>14.8</b> MCMC using a symmetric proposal (Metropolis)</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="day-15.html"><a href="day-15.html"><i class="fa fa-check"></i><b>15</b> Day 15</a><ul>
<li class="chapter" data-level="15.1" data-path="day-15.html"><a href="day-15.html#announcements-10"><i class="fa fa-check"></i><b>15.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="day-16.html"><a href="day-16.html"><i class="fa fa-check"></i><b>16</b> Day 16</a><ul>
<li class="chapter" data-level="16.1" data-path="day-16.html"><a href="day-16.html#announcements-11"><i class="fa fa-check"></i><b>16.1</b> Announcements</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="day-17.html"><a href="day-17.html"><i class="fa fa-check"></i><b>17</b> Day 17</a><ul>
<li class="chapter" data-level="17.1" data-path="day-17.html"><a href="day-17.html#announcements-12"><i class="fa fa-check"></i><b>17.1</b> Announcements</a></li>
<li class="chapter" data-level="17.2" data-path="day-17.html"><a href="day-17.html#gaussian-process-representations"><i class="fa fa-check"></i><b>17.2</b> Gaussian process representations</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="day-18.html"><a href="day-18.html"><i class="fa fa-check"></i><b>18</b> Day 18</a><ul>
<li class="chapter" data-level="18.1" data-path="day-18.html"><a href="day-18.html#announcements-13"><i class="fa fa-check"></i><b>18.1</b> Announcements</a></li>
<li class="chapter" data-level="18.2" data-path="day-18.html"><a href="day-18.html#gaussian-process-representations-continued"><i class="fa fa-check"></i><b>18.2</b> Gaussian process representations continued</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="day-19.html"><a href="day-19.html"><i class="fa fa-check"></i><b>19</b> Day 19</a><ul>
<li class="chapter" data-level="19.1" data-path="day-19.html"><a href="day-19.html#announcements-14"><i class="fa fa-check"></i><b>19.1</b> Announcements</a></li>
<li class="chapter" data-level="19.2" data-path="day-19.html"><a href="day-19.html#stochastic-integration"><i class="fa fa-check"></i><b>19.2</b> Stochastic Integration</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes for STAT 5413 - Spatial Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="day-8" class="section level1">
<h1><span class="header-section-number">Chapter8</span> Day 8</h1>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="day-8.html#cb140-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb140-2"><a href="day-8.html#cb140-2"></a><span class="kw">library</span>(fields)</span>
<span id="cb140-3"><a href="day-8.html#cb140-3"></a><span class="kw">library</span>(mvnfast)</span>
<span id="cb140-4"><a href="day-8.html#cb140-4"></a><span class="kw">library</span>(gstat)</span>
<span id="cb140-5"><a href="day-8.html#cb140-5"></a><span class="kw">library</span>(sp)</span>
<span id="cb140-6"><a href="day-8.html#cb140-6"></a><span class="kw">library</span>(MCMCpack)</span></code></pre></div>
<div id="announcements-3" class="section level2">
<h2><span class="header-section-number">8.1</span> Announcements</h2>
<ul>
<li>Finish the last of Day 7 notes…</li>
</ul>
</div>
<div id="estimation-of-the-spatial-process" class="section level2">
<h2><span class="header-section-number">8.2</span> Estimation of the spatial process</h2>
<ul>
<li>Assume we have the model</li>
</ul>
<p><span class="math display">\[\begin{align*}
y(\mathbf{s}) &amp; = \mu(\mathbf{s}) + \eta(\mathbf{s}) + \varepsilon(\mathbf{s}) 
\end{align*}\]</span></p>
<ul>
<li><p>then, <span class="math inline">\(Cov \left( y(\mathbf{s}_i), y(\mathbf{s}_j ) \right) = \sigma^2 C(d_{ij} | \nu, \phi) + \tau^2 I\{i = j\}\)</span> where <span class="math inline">\(C(d_{ij} | \nu, \phi)\)</span> is a Matern correlation function with smoothness parameter <span class="math inline">\(\nu\)</span> and range parameter <span class="math inline">\(\phi\)</span>.</p></li>
<li><p>We observe the data <span class="math inline">\(\mathbf{y} = (y(\mathbf{s}_1), \ldots, y(\mathbf{s}_n))&#39;\)</span> at <span class="math inline">\(n\)</span> locations <span class="math inline">\(\mathbf{s}_1, \ldots, \mathbf{s}_n\)</span>.</p></li>
<li><p><span class="math inline">\(\mathbf{y} \sim N(\boldsymbol{\mu}, \boldsymbol{\Sigma}(\boldsymbol{\theta}))\)</span>.</p></li>
<li><p><span class="math inline">\(\boldsymbol{\mu} = \mathbf{X}\left( \mathbf{s} \right) \boldsymbol{\beta}\)</span> is the model for the mean process given the <span class="math inline">\(n \times p\)</span> covariate matrix <span class="math inline">\(\mathbf{X}(\mathbf{s})\)</span> and <span class="math inline">\(\boldsymbol{\Sigma}(\boldsymbol{\theta})\)</span> is the covariance matrix with parameters <span class="math inline">\(\boldsymbol{\theta} = (\tau^2, \sigma^2, \nu, \phi)&#39;\)</span>.</p></li>
<li><p>To fit the model, we need to estimate <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\boldsymbol{\theta}\)</span>.</p></li>
<li><p>Traditional statistical methods: use replication</p>
<ul>
<li>With <span class="math inline">\(k = 1, \ldots, K\)</span> replications of the spatial process <span class="math inline">\(\mathbf{y}_k\)</span>, we can estimate the spatial mean as</li>
</ul>
<p><span class="math display">\[\begin{align*}
  \widehat{\boldsymbol{\mu}} = \frac{1}{K} \sum_{k=1}^K \mathbf{y}_k
  \end{align*}\]</span></p>
<p>and the spatial mean as</p>
<p><span class="math display">\[\begin{align*}
  \widehat{\boldsymbol{\Sigma}} = \frac{1}{K} \sum_{k=1}^K \left( \mathbf{y}_k - \widehat{\boldsymbol{\mu}} \right) \left( \mathbf{y}_k - \widehat{\boldsymbol{\mu}} \right)&#39;
  \end{align*}\]</span></p>
<ul>
<li>However, we don’t have replication – we only have the single observation <span class="math inline">\(\mathbf{y}\)</span>.</li>
</ul></li>
<li><p>We will explore different estimation methods using 1) variograms, 2) maximum liklihood, and 3) Bayesian methods</p></li>
</ul>
<div id="estimation-of-the-spatial-process-using-variograms" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Estimation of the spatial process using variograms</h3>
<ul>
<li><p>First, fit a model to the mean to estimate <span class="math inline">\(\hat{\mu}(\mathbf{s})\)</span> (use maximum likelihood, least-squares, etc.)</p></li>
<li><p>Next, generate a sequence of <span class="math inline">\(B\)</span> bins based on distance and group each pair of points <span class="math inline">\((\mathbf{s}_i, \mathbf{s}_j)\)</span> into a bin</p>
<ul>
<li>Example bins: [0, 1), [1, 2), [2, 3), </li>
</ul></li>
<li><p>Place the pair of observations <span class="math inline">\(\mathbf{s}_i\)</span> and <span class="math inline">\(\mathbf{s}_j\)</span> that are seperated by <span class="math inline">\(d_{b} \in [d_b - \epsilon, d_b + \epsilon)\)</span> into one of the <span class="math inline">\(B\)</span> bins.</p></li>
<li><p>Calculate the average of the variogram within each bin
For each of the <span class="math inline">\(k\)</span> bins that have <span class="math inline">\(m_k\)</span> points in each bin, the variogram estimate for bin <span class="math inline">\(k\)</span> centered at the bin interval <span class="math inline">\(\mathbf{h}_k\)</span> is</p></li>
</ul>
<p><span class="math display">\[\begin{align*}
\hat{\gamma}(\mathbf{h}_k) = \frac{1}{m_k} \sum_{\ell=1}^{m_k} \left( y(\mathbf{s}_{\ell_1}) - y(\mathbf{s}_{\ell_2}) \right)^2
\end{align*}\]</span></p>
<p>for the <span class="math inline">\(\ell\)</span>th pair of locations <span class="math inline">\(\mathbf{s}_{\ell_1}\)</span> and <span class="math inline">\(\mathbf{s}_{\ell_2}\)</span></p>
<p><strong>insert empirical variogram plot from class here</strong></p>
<ul>
<li>Can estimate the parameters “by eye” or using least squares</li>
</ul>
<p><span class="math display" id="eq:variogram">\[\begin{align*}
\hat{\boldsymbol{\theta}} &amp; = (\hat{\tau}^2, \hat{\sigma}^2, \hat{\phi}, \hat{\nu})&#39; \\
&amp; = \underset{\tau^2, \sigma^2, \phi, \nu}{\operatorname{argmax}} \sum_{b=1}^B \left( \hat{\gamma}(d_b) - \gamma(d_b)\right)^2 w_b \\
&amp; = \underset{\tau^2, \sigma^2, \phi, \nu}{\operatorname{argmax}} \sum_{b=1}^B \left( \hat{\gamma}(d_b) - \left( \sigma^2 + \tau^2 C \left( d_b | \phi, \nu \right) \right) \right)^2 w_b 
\tag{8.1}
\end{align*}\]</span></p>
<p>given the correlation function <span class="math inline">\(C \left( d_b | \phi, \nu \right)\)</span> and a set of weights <span class="math inline">\(w_b\)</span>.</p>
<div id="estimation-of-the-mean-function" class="section level4">
<h4><span class="header-section-number">8.2.1.1</span> Estimation of the mean function</h4>
<ul>
<li><p>What is the least squares estimator of the mean function?</p></li>
<li><p>Recall, if <span class="math inline">\(\mathbf{y} \sim N(\mathbf{X} \boldsymbol{\beta}, \boldsymbol{\Sigma})\)</span>, then</p>
<ul>
<li><span class="math inline">\(\hat{\boldsymbol{\beta}} = (\mathbf{X}&#39;\mathbf{X})^{-1}\mathbf{X} \mathbf{y}\)</span> is an unbiased estimator.</li>
</ul>
<p><span class="math display">\[\begin{align*}
  E(\hat{\boldsymbol{\beta}}) &amp; = (\mathbf{X}&#39;\mathbf{X})^{-1}\mathbf{X} E(\mathbf{y}) \\
  &amp; = (\mathbf{X}&#39;\mathbf{X})^{-1}\mathbf{X}\mathbf{X} \boldsymbol{\beta} \\
  &amp; = \boldsymbol{\beta} 
  \end{align*}\]</span></p>
<ul>
<li>However,</li>
</ul>
<p><span class="math display">\[\begin{align*}
  Cov(\hat{\boldsymbol{\beta}}) &amp; = (\mathbf{X}&#39;\mathbf{X})^{-1}\mathbf{X} \boldsymbol{\Sigma} \mathbf{X} (\mathbf{X}&#39;\mathbf{X})^{-1} \\
  &amp; \neq \sigma^2 (\mathbf{X}&#39;\mathbf{X})^{-1}
  \end{align*}\]</span></p>
<p>which is the least squares covariance estimate of <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span>. Thus the least squares estimate has a biased covariance estimate.</p></li>
<li><p>Given the fitted covariance matrix <span class="math inline">\(\hat{\boldsymbol{\Sigma}}\)</span> from the variogram, an updated mean function estimate is</p>
<p><span class="math display">\[\begin{align*}
  \hat{\boldsymbol{\beta}} &amp; = (\mathbf{X}&#39; \hat{\boldsymbol{\Sigma}}^{-1} \mathbf{X})^{-1} \mathbf{X}&#39; \hat{\boldsymbol{\Sigma}}^{-1} \mathbf{y}
  \end{align*}\]</span></p>
<p>and the covariance is</p>
<p><span class="math display">\[\begin{align*}
  Cov(\hat{\boldsymbol{\beta}}) &amp; = (\mathbf{X}&#39; \hat{\boldsymbol{\Sigma}}^{-1} \mathbf{X})^{-1}
  \end{align*}\]</span></p></li>
<li><p>This suggests that an iterative approach can be used to fit the model</p></li>
</ul>
<ol style="list-style-type: decimal">
<li>estimate the mean function</li>
<li>using the estimated mean function, update the covariance function</li>
<li>repeat steps 1 and 2 until convergence</li>
</ol>
<ul>
<li>Any issues? Uncertainty estimation?
<ul>
<li>How do you propogate parameter uncertainty?</li>
<li>Prediction uncertainty is likely to be too small</li>
</ul></li>
</ul>
</div>
</div>
<div id="maximum-likelihood" class="section level3">
<h3><span class="header-section-number">8.2.2</span> Maximum Likelihood</h3>
<div id="the-likelihood" class="section level4">
<h4><span class="header-section-number">8.2.2.1</span> The likelihood</h4>
<p>To understand the benefits of Bayesian analysis, it is useful to recall the likelihood framework. Assume that our model can be simplified so that the data are <span class="math inline">\(\mathbf{y} = (y_1, \ldots, y_N)&#39;\)</span> and the parameters are <span class="math inline">\(\boldsymbol{\theta}\)</span>. Before observation, the data <span class="math inline">\(\mathbf{y}\)</span> are considered a random variable. After observation, the data <span class="math inline">\(\mathbf{y}\)</span> are considered fixed and known. The likelihood is a formal representation of how likely the data <span class="math inline">\(\mathbf{y}\)</span> are to arise given a probability distribution with parameters <span class="math inline">\(\boldsymbol{\theta}\)</span>. The likelihood function <span class="math inline">\(L(\boldsymbol{\theta} | \mathbf{y})\)</span> is defined as
<span class="math display">\[\begin{align*}
L(\boldsymbol{\theta} | \mathbf{y}) &amp; = [\mathbf{y} | \boldsymbol{\theta}],
\end{align*}\]</span>
where the function says that the likelihood of the parameter conditional on the data is is the conditional probability density of the data conditional on the parameters.</p>
<p>If one assumes the observations are conditionally independent given the parameters <span class="math inline">\(\boldsymbol{\theta}\)</span>, the likelihood can be written as
<span class="math display">\[\begin{align*}
L(\boldsymbol{\theta} | \mathbf{y}) &amp; = \prod_{i=1}^N [y_i | \boldsymbol{\theta}],
\end{align*}\]</span>
Note the distinction between the use of the term likelihood function for the left side of the equation with the use of the term likelihood in Bayesian statistics to describe the right side of the above equation. A distinction between the likelihood function and the probability distribution function is in what is considered the random variable. In the likelihood function, the data <span class="math inline">\(\mathbf{y}\)</span> is assumed known and the parameters <span class="math inline">\(\boldsymbol{\theta}\)</span> are random. For the probability distribution function, the data <span class="math inline">\(\mathbf{y}\)</span> are considered are random variable conditional on a fixed, known parameter <span class="math inline">\(\boldsymbol{\theta}\)</span>. To illustrate this difference, consider a univariate gamma probability distribution with shape parameter <span class="math inline">\(\alpha = 10\)</span> and scale parameter <span class="math inline">\(\theta=10\)</span>. If we observe a single <span class="math inline">\(y=2\)</span>, the following figure shows the density function and likelihood function, with <span class="math inline">\(\alpha\)</span> assumed fixed and known.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="day-8.html#cb141-1"></a><span class="kw">library</span>(latex2exp)</span>
<span id="cb141-2"><a href="day-8.html#cb141-2"></a>y &lt;-<span class="st"> </span><span class="dv">2</span></span>
<span id="cb141-3"><a href="day-8.html#cb141-3"></a>alpha &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb141-4"><a href="day-8.html#cb141-4"></a>theta &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb141-5"><a href="day-8.html#cb141-5"></a>density_function &lt;-<span class="st"> </span><span class="cf">function</span> (x) {</span>
<span id="cb141-6"><a href="day-8.html#cb141-6"></a>  <span class="kw">return</span>(<span class="kw">dgamma</span>(x, alpha, theta))</span>
<span id="cb141-7"><a href="day-8.html#cb141-7"></a>}</span>
<span id="cb141-8"><a href="day-8.html#cb141-8"></a>likelihood_function &lt;-<span class="st"> </span><span class="cf">function</span> (x) {</span>
<span id="cb141-9"><a href="day-8.html#cb141-9"></a>  <span class="kw">return</span>(<span class="kw">dgamma</span>(y, alpha, x))</span>
<span id="cb141-10"><a href="day-8.html#cb141-10"></a>}</span>
<span id="cb141-11"><a href="day-8.html#cb141-11"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb141-12"><a href="day-8.html#cb141-12"></a><span class="co">## plot density function</span></span>
<span id="cb141-13"><a href="day-8.html#cb141-13"></a><span class="kw">curve</span>(<span class="kw">density_function</span>(x), <span class="dv">0</span>, <span class="dv">4</span>, <span class="dt">main =</span> <span class="st">&quot;Density function&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;y&quot;</span>, </span>
<span id="cb141-14"><a href="day-8.html#cb141-14"></a>      <span class="dt">ylab=</span><span class="kw">TeX</span>(<span class="st">&quot;$</span><span class="ch">\\</span><span class="st">lbrack$y|$</span><span class="ch">\\</span><span class="st">theta$ $</span><span class="ch">\\</span><span class="st">rbrack$&quot;</span>))</span>
<span id="cb141-15"><a href="day-8.html#cb141-15"></a><span class="kw">text</span>(<span class="dv">1</span>, <span class="fl">0.4</span>, <span class="kw">paste0</span>(</span>
<span id="cb141-16"><a href="day-8.html#cb141-16"></a>  <span class="st">&quot;Area = &quot;</span>, <span class="kw">round</span>(<span class="kw">integrate</span>(density_function, <span class="dv">0</span>, <span class="ot">Inf</span>)[<span class="dv">1</span>]<span class="op">$</span>value, <span class="dt">digits=</span><span class="dv">2</span>)))</span>
<span id="cb141-17"><a href="day-8.html#cb141-17"></a><span class="kw">points</span>(<span class="dv">2</span>, <span class="kw">density_function</span>(<span class="dv">2</span>), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">pch=</span><span class="dv">16</span>)</span>
<span id="cb141-18"><a href="day-8.html#cb141-18"></a><span class="kw">curve</span>(<span class="kw">likelihood_function</span>(x), <span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">main =</span> <span class="st">&quot;Likelihood function&quot;</span>,</span>
<span id="cb141-19"><a href="day-8.html#cb141-19"></a>      <span class="dt">xlab=</span><span class="kw">TeX</span>(<span class="st">&quot;$</span><span class="ch">\\</span><span class="st">theta$&quot;</span>), <span class="dt">ylab=</span><span class="kw">TeX</span>(<span class="st">&quot;$L(y|</span><span class="ch">\\</span><span class="st">theta)$&quot;</span>))</span>
<span id="cb141-20"><a href="day-8.html#cb141-20"></a><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">0.3</span>, <span class="kw">paste0</span>(</span>
<span id="cb141-21"><a href="day-8.html#cb141-21"></a>  <span class="st">&quot;Area = &quot;</span>, <span class="kw">round</span>(<span class="kw">integrate</span>(likelihood_function, <span class="dv">0</span>, <span class="ot">Inf</span>)[<span class="dv">1</span>]<span class="op">$</span>value, <span class="dt">digits=</span><span class="dv">2</span>)))</span>
<span id="cb141-22"><a href="day-8.html#cb141-22"></a><span class="kw">points</span>(<span class="dv">10</span>, <span class="kw">likelihood_function</span>(<span class="dv">10</span>), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">pch=</span><span class="dv">16</span>)</span></code></pre></div>
<p><img src="08-day-8_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Notice that the area under the curve of the density function is 1 (because it is a formal probability distribution) whereas the area under the likelihood function is not 1 (the area is 10). Hence, when performing optimization using a likelihood function, one is <strong>not</strong> optimizing a probability function. Because the likelihood is not a probability, we appeal to frequentist (rather than probabilistic) interpretations when interpreting likelihood analyses. For example, the interpretation of a 95% confidence interval is “under repeated sampling from the population, 95% of the confidence intervals will contain the true value,” in comparison to the probabilistic interpretation “the probability the interval contains the true value is 95%.” The density function and the likelihood function share a common point at <span class="math inline">\(y=2\)</span> and <span class="math inline">\(\theta=10\)</span>, (shown in red in the figure above) given the fixed value of <span class="math inline">\(\alpha\)</span>. This suggests that the likelihood and density functions are the same only when the parameter is assumed to be a fixed, known value.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="day-8.html#cb142-1"></a><span class="co">## check that the density function and the likelihood function share the same point</span></span>
<span id="cb142-2"><a href="day-8.html#cb142-2"></a><span class="kw">all.equal</span>(<span class="kw">density_function</span>(<span class="dv">2</span>), <span class="kw">likelihood_function</span>(<span class="dv">10</span>))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Philosophically, there is a subtle difference between the density function and the likelihood function that is important to understand. In the likelihood function, we allow the parameter <span class="math inline">\(\theta\)</span> to vary; however, we do not assume that <span class="math inline">\(\theta\)</span> is a random variable. To be a random variable there must be a formal probability distribution for <span class="math inline">\(\theta\)</span>. We showed earlier that the likelihood function does not integrate to 1 so we don’t view <span class="math inline">\(\theta\)</span> as a random variable and the likelihood function is not a probability distribution for <span class="math inline">\(\theta\)</span>.</p>
</div>
</div>
</div>
<div id="maximum-likelihood-1" class="section level2">
<h2><span class="header-section-number">8.3</span> Maximum likelihood</h2>
<p>Maximum likelihood estimation has the goal of finding the set of parameters <span class="math inline">\(\hat{\boldsymbol{\theta}}\)</span> that were most likely to give rise to the data. Because the likelihood does not integrate to 1, the likelihood by itself is not infomative; only comparisons among likelihoods are meaningful because the likelihood can be shifted up or down in the y-axis by an arbitraty constant <span class="math inline">\(c\)</span>. To cancel out the unkown constant <span class="math inline">\(c\)</span>, we take ratios of the likelihoods at values <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span>, giving rise to the likelihood ratio
<span class="math display">\[\begin{align*}
\frac{L(\theta_1 | y)}{L(\theta_2 | y)} &amp; = \frac{[y|\theta_1]}{[y|\theta_2]}.
\end{align*}\]</span>
The likelihood ratio expresses the strength of evidence in favor of <span class="math inline">\(\theta_1\)</span> relative to <span class="math inline">\(\theta_2\)</span>. In general, we use the log likelihood ratio to express the strength of evidence where positive values of the log likelihood ratio give evidence in support of <span class="math inline">\(\theta_1\)</span> and negative values of the log likelihood ratio give evidence in support of <span class="math inline">\(\theta_2\)</span>, conditional on the data.</p>
<p>The maximum likelihood estimate is the value <span class="math inline">\(\hat{\theta}\)</span> such that
<span class="math display">\[\begin{align*}
\log \left( \frac{L(\hat{\theta} | y)}{L(\theta^\star | y)} \right) &amp; \geq 0
\end{align*}\]</span>
for all values of <span class="math inline">\(\theta^\star\)</span>. The following figure demonstrates this idea visually.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="day-8.html#cb144-1"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="dv">1</span>))</span>
<span id="cb144-2"><a href="day-8.html#cb144-2"></a><span class="kw">curve</span>(<span class="kw">likelihood_function</span>(x), <span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">main =</span> <span class="st">&quot;Likelihood function&quot;</span>,</span>
<span id="cb144-3"><a href="day-8.html#cb144-3"></a>      <span class="dt">xlab=</span><span class="kw">TeX</span>(<span class="st">&quot;$</span><span class="ch">\\</span><span class="st">theta$&quot;</span>), <span class="dt">ylab=</span><span class="kw">TeX</span>(<span class="st">&quot;$L(y|</span><span class="ch">\\</span><span class="st">theta)$&quot;</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.02</span>, <span class="fl">0.66</span>))</span>
<span id="cb144-4"><a href="day-8.html#cb144-4"></a><span class="kw">segments</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="kw">likelihood_function</span>(<span class="dv">3</span>))</span>
<span id="cb144-5"><a href="day-8.html#cb144-5"></a><span class="kw">arrows</span>(<span class="dv">3</span>, <span class="kw">likelihood_function</span>(<span class="dv">3</span>), <span class="dv">0</span>, <span class="kw">likelihood_function</span>(<span class="dv">3</span>))</span>
<span id="cb144-6"><a href="day-8.html#cb144-6"></a><span class="kw">text</span>(<span class="fl">3.1</span>, <span class="fl">-0.02</span>, <span class="kw">TeX</span>(<span class="st">&quot;$</span><span class="ch">\\</span><span class="st">theta_1$ = 3&quot;</span>))</span>
<span id="cb144-7"><a href="day-8.html#cb144-7"></a><span class="kw">text</span>(<span class="fl">1.5</span>, <span class="kw">likelihood_function</span>(<span class="dv">3</span>)<span class="op">+</span><span class="st"> </span><span class="fl">.02</span>, <span class="kw">TeX</span>(<span class="st">&quot;$L(y|</span><span class="ch">\\</span><span class="st">theta_1)$&quot;</span>))</span>
<span id="cb144-8"><a href="day-8.html#cb144-8"></a></span>
<span id="cb144-9"><a href="day-8.html#cb144-9"></a><span class="kw">segments</span>(<span class="dv">6</span>, <span class="dv">0</span>, <span class="dv">6</span>, <span class="kw">likelihood_function</span>(<span class="dv">6</span>))</span>
<span id="cb144-10"><a href="day-8.html#cb144-10"></a><span class="kw">arrows</span>(<span class="dv">6</span>, <span class="kw">likelihood_function</span>(<span class="dv">6</span>), <span class="dv">0</span>, <span class="kw">likelihood_function</span>(<span class="dv">6</span>))</span>
<span id="cb144-11"><a href="day-8.html#cb144-11"></a><span class="kw">text</span>(<span class="fl">6.1</span>, <span class="fl">-0.02</span>, <span class="kw">TeX</span>(<span class="st">&quot;$</span><span class="ch">\\</span><span class="st">theta_2$ = 6&quot;</span>))</span>
<span id="cb144-12"><a href="day-8.html#cb144-12"></a><span class="kw">text</span>(<span class="fl">1.5</span>, <span class="kw">likelihood_function</span>(<span class="dv">6</span>) <span class="op">+</span><span class="st"> </span><span class="fl">.02</span>, <span class="kw">TeX</span>(<span class="st">&quot;$L(y|</span><span class="ch">\\</span><span class="st">theta_2)$&quot;</span>))</span>
<span id="cb144-13"><a href="day-8.html#cb144-13"></a></span>
<span id="cb144-14"><a href="day-8.html#cb144-14"></a><span class="kw">segments</span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">5</span>, <span class="kw">likelihood_function</span>(<span class="dv">5</span>), <span class="dt">lty=</span><span class="dv">2</span>)</span>
<span id="cb144-15"><a href="day-8.html#cb144-15"></a><span class="kw">text</span>(<span class="fl">5.3</span>, <span class="fl">0.66</span>, <span class="kw">TeX</span>(<span class="st">&quot;$</span><span class="ch">\\</span><span class="st">hat{</span><span class="ch">\\</span><span class="st">theta}_{MLE}$ = 5&quot;</span>))</span></code></pre></div>
<p><img src="08-day-8_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>For example, if <span class="math inline">\(\theta_1 = 3\)</span> and <span class="math inline">\(\theta_2 = 6\)</span>, the log likelihood ratio is -0.9314718 which suggests evidence is in favor of <span class="math inline">\(\theta_2\)</span> relative to <span class="math inline">\(\theta_1\)</span>. In comparison, the log likelihood ratio of the MLE <span class="math inline">\(\hat{\theta}_{MLE}\)</span> is 0.1767844 which gives evidence in favor of <span class="math inline">\(\hat{\theta}_{MLE}\)</span>.</p>
<div id="maximum-likelihood-estimation-of-the-variogram" class="section level4">
<h4><span class="header-section-number">8.3.0.1</span> Maximum likelihood estimation of the variogram</h4>
<ul>
<li><p>Instead of using the variogram in <a href="day-8.html#eq:variogram">(8.1)</a>, we can use maximum liklihood.</p></li>
<li><p>More formal and principled estimation framework.</p></li>
<li><p>Allows for parameter uncertainty quantification.</p></li>
<li><p>Goal: estimate the parameters <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\boldsymbol{\theta} = (\tau^2, \sigma^2, \nu, \phi)&#39;\)</span>.</p></li>
<li><p>The log-likelihood to maximize is</p></li>
</ul>
<p><span class="math display">\[\begin{align*}
\log[\boldsymbol{\beta}, \boldsymbol{\theta} | \mathbf{y}] &amp; = - \frac{1}{2} \log|\boldsymbol{\Sigma}(\boldsymbol{\theta})| - \frac{1}{2} \left( \mathbf{y} - \mathbf{X} \boldsymbol{\beta} \right)&#39; \boldsymbol{\Sigma}(\boldsymbol{\theta})^{-1} \left( \mathbf{y} - \mathbf{X} \boldsymbol{\beta} \right)
\end{align*}\]</span></p>
<ul>
<li>This is a multivariate optimization and difficult to optimize directly. Instead, notice the estimate <span class="math inline">\(\hat{\boldsymbol{\beta}}(\boldsymbol{\theta}) = (\mathbf{X}&#39; \hat{\boldsymbol{\Sigma}}^{-1} \mathbf{X})^{-1} \mathbf{X}&#39; \hat{\boldsymbol{\Sigma}}^{-1} \mathbf{y}\)</span> is a known function of <span class="math inline">\(\boldsymbol{\theta}\)</span> so we can profile it out of the equation. Thus, we can instead optimize the <a href="https://www.stat.tamu.edu/~suhasini/teaching613/chapter3.pdf">profile likelihood</a></li>
</ul>
<p><span class="math display">\[\begin{align*}
\log[\boldsymbol{\theta} | \mathbf{y}]_{prof} &amp; = - \frac{1}{2} \log|\boldsymbol{\Sigma}(\boldsymbol{\theta})| - \frac{1}{2} \left( \mathbf{y} - \mathbf{X} \boldsymbol{\beta}(\boldsymbol{\theta}) \right)&#39; \boldsymbol{\Sigma}(\boldsymbol{\theta})^{-1} \left( \mathbf{y} - \mathbf{X} \boldsymbol{\beta}(\boldsymbol{\theta}) \right)
\end{align*}\]</span></p>
<p>Note this equation is now just a function of <span class="math inline">\(\boldsymbol{\theta}\)</span>.</p>
<ul>
<li>Computational complexity – both the log-likelihood and the profile log-likelihood requre the determinant and inverse of the <span class="math inline">\(n \times n\)</span> covariance matrix <span class="math inline">\(\boldsymbol{\Sigma}(\boldsymbol{\theta})\)</span> which require <span class="math inline">\(O(n^3)\)</span> time</li>
</ul>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="day-8.html#cb145-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">file.exists</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;matrix-inverse-timings.RData&quot;</span>))) {</span>
<span id="cb145-2"><a href="day-8.html#cb145-2"></a>    n &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">250</span>, <span class="dv">350</span>, <span class="dv">500</span>, <span class="dv">600</span>, <span class="dv">700</span>, <span class="dv">800</span>, <span class="dv">900</span>, <span class="dv">1000</span>, <span class="dv">1250</span>, <span class="dv">1500</span>)</span>
<span id="cb145-3"><a href="day-8.html#cb145-3"></a>    timings &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">length</span>(n))</span>
<span id="cb145-4"><a href="day-8.html#cb145-4"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(n)) {</span>
<span id="cb145-5"><a href="day-8.html#cb145-5"></a>        Sigma      &lt;-<span class="st"> </span><span class="kw">riwish</span>(n[i]<span class="op">+</span><span class="dv">2</span>, <span class="kw">diag</span>(n[i]))</span>
<span id="cb145-6"><a href="day-8.html#cb145-6"></a>        timings[i] &lt;-<span class="st"> </span><span class="kw">system.time</span>(<span class="kw">solve</span>(Sigma))[<span class="dv">3</span>]</span>
<span id="cb145-7"><a href="day-8.html#cb145-7"></a>    }</span>
<span id="cb145-8"><a href="day-8.html#cb145-8"></a>    dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">timings =</span> timings, <span class="dt">n =</span> n)</span>
<span id="cb145-9"><a href="day-8.html#cb145-9"></a>    <span class="kw">save</span>(dat, <span class="dt">file =</span> here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;matrix-inverse-timings.RData&quot;</span>))</span>
<span id="cb145-10"><a href="day-8.html#cb145-10"></a>} <span class="cf">else</span> {</span>
<span id="cb145-11"><a href="day-8.html#cb145-11"></a>  <span class="kw">load</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;results&quot;</span>, <span class="st">&quot;matrix-inverse-timings.RData&quot;</span>))</span>
<span id="cb145-12"><a href="day-8.html#cb145-12"></a>}</span>
<span id="cb145-13"><a href="day-8.html#cb145-13"></a></span>
<span id="cb145-14"><a href="day-8.html#cb145-14"></a></span>
<span id="cb145-15"><a href="day-8.html#cb145-15"></a><span class="co">## fit the best cubic model to the data</span></span>
<span id="cb145-16"><a href="day-8.html#cb145-16"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span> (<span class="dt">x =</span> n, <span class="dt">y =</span> timings)) <span class="op">+</span></span>
<span id="cb145-17"><a href="day-8.html#cb145-17"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb145-18"><a href="day-8.html#cb145-18"></a><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(x, <span class="dv">3</span>), <span class="dt">fullrange =</span> <span class="ot">TRUE</span>) <span class="op">+</span></span>
<span id="cb145-19"><a href="day-8.html#cb145-19"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Time to calculate inverse&quot;</span>) <span class="op">+</span></span>
<span id="cb145-20"><a href="day-8.html#cb145-20"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;matrix size (n by n)&quot;</span>) <span class="op">+</span></span>
<span id="cb145-21"><a href="day-8.html#cb145-21"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Matrix inversion time with fitted polynomial of order 3&quot;</span>) <span class="op">+</span></span>
<span id="cb145-22"><a href="day-8.html#cb145-22"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2000</span>)) </span></code></pre></div>
<p><img src="08-day-8_files/figure-html/computational-complexity-1.png" width="672" /></p>
<ul>
<li>Solving the MLE for <span class="math inline">\(\boldsymbol{\theta}\)</span>
<ul>
<li>Can use standard optimization routines like <em>optim()</em></li>
<li>Can use REML to guarantee positive variance parameters
<ul>
<li><a href="https://en.wikipedia.org/wiki/Restricted_maximum_likelihood">“restricted maximum likelihood”</a></li>
<li>Induces a bias in the estimates but guarantees realistic answers (non-negative variances)</li>
</ul></li>
<li>Uncertainties can be estimated using the <a href="https://en.wikipedia.org/wiki/Fisher_information">Fisher information matrix</a>
<span class="math display">\[\begin{align*}
  \mathcal{I}(\boldsymbol{\theta})_{ij} &amp; = E \left( \left( \frac{{\partial d}}{{\partial d} \boldsymbol{\theta}_i} \log [\boldsymbol{\theta} | \mathbf{y} ] \right) \left( \frac{{\partial d}}{{\partial d} \boldsymbol{\theta}_j} \log [\boldsymbol{\theta} | \mathbf{y} ] \right) \middle| \boldsymbol{\theta} \right) \\
  &amp; = - E \left( \left( \frac{{\partial d}^2 }{{\partial d} \boldsymbol{\theta}_i {\partial d} \boldsymbol{\theta}_j} \log [\boldsymbol{\theta} | \mathbf{y} ]\right) \middle| \boldsymbol{\theta} \right)
  \end{align*}\]</span></li>
</ul></li>
</ul>

</div>
</div>
</div>

<script type="text/javascript">
$(document).ready(function() {
  $folds = $(".fold-solution");
  $folds.wrapInner("<div class=\"fold-solution-blck\">"); // wrap a div container around content
  $folds.prepend("<button class=\"fold-solution-btn\">Show Solution</button>");  // add a button
  $(".fold-solution-blck").toggle();  // fold all blocks
  $(".fold-solution-btn").on("click", function() {  // add onClick event
    $(this).text($(this).text() === "Hide Solution" ? "Show Solution" : "Hide Solution");  // if the text equals "Fold", change it to "Unfold"or else to "Fold" 
    $(this).next(".fold-solution-blck").toggle("linear");  // "swing" is the default easing function. This can be further customized in its speed or the overall animation itself.
  })
});
</script>





<script type="text/javascript">
$(document).ready(function() {
  $folds = $(".fold-proof");
  $folds.wrapInner("<div class=\"fold-proof-blck\">"); // wrap a div container around content
  $folds.prepend("<button class=\"fold-proof-btn\">Show Proof</button>");  // add a button
  $(".fold-proof-blck").toggle();  // fold all blocks
  $(".fold-proof-btn").on("click", function() {  // add onClick event
    $(this).text($(this).text() === "Hide Proof" ? "Show Proof" : "Hide Proof");  // if the text equals "Fold", change it to "Unfold"or else to "Fold" 
    $(this).next(".fold-proof-blck").toggle("linear");  // "swing" is the default easing function. This can be further customized in its speed or the overall animation itself.
  })
});
</script>
            </section>

          </div>
        </div>
      </div>
<a href="day-7.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="day-9.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["STAT-5413.pdf", "STAT-5413.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
